"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[194],{6721(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"orchestration/ARCHITECTURE","title":"Vaettir Architecture","description":"Overview","source":"@site/docs/orchestration/ARCHITECTURE.md","sourceDirName":"orchestration","slug":"/orchestration/ARCHITECTURE","permalink":"/docs/orchestration/ARCHITECTURE","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/orchestration/ARCHITECTURE.md","tags":[],"version":"current","frontMatter":{}}');var s=i(4848),l=i(8453);const t={},o="Vaettir Architecture",c={},d=[{value:"Overview",id:"overview",level:2},{value:"System Components",id:"system-components",level:2},{value:"Core Services",id:"core-services",level:3},{value:"Component Details",id:"component-details",level:2},{value:"1. n8n Main Server",id:"1-n8n-main-server",level:3},{value:"2. Task Runner",id:"2-task-runner",level:3},{value:"3. PostgreSQL Database",id:"3-postgresql-database",level:3},{value:"4. Redis Queue",id:"4-redis-queue",level:3},{value:"5. Traefik Reverse Proxy",id:"5-traefik-reverse-proxy",level:3},{value:"6. Proxy Services (Optional)",id:"6-proxy-services-optional",level:3},{value:"Data Flow",id:"data-flow",level:2},{value:"Workflow Execution (Standard)",id:"workflow-execution-standard",level:3},{value:"Development with Proxy Pattern",id:"development-with-proxy-pattern",level:3},{value:"Environment Modes",id:"environment-modes",level:2},{value:"Local Development",id:"local-development",level:3},{value:"Production",id:"production",level:3},{value:"Security Architecture",id:"security-architecture",level:2},{value:"Network Isolation",id:"network-isolation",level:3},{value:"Code Execution Security",id:"code-execution-security",level:3},{value:"Authentication Layers",id:"authentication-layers",level:3},{value:"Secrets Management",id:"secrets-management",level:3},{value:"Scalability Considerations",id:"scalability-considerations",level:2},{value:"Current Setup (Single Instance)",id:"current-setup-single-instance",level:3},{value:"Horizontal Scaling (Future)",id:"horizontal-scaling-future",level:3},{value:"Observability Integration",id:"observability-integration",level:2},{value:"Optional: Opik LLM Tracing",id:"optional-opik-llm-tracing",level:3},{value:"Technology Stack",id:"technology-stack",level:2},{value:"Key Design Decisions",id:"key-design-decisions",level:2},{value:"Why External Task Runners?",id:"why-external-task-runners",level:3},{value:"Why Queue Mode?",id:"why-queue-mode",level:3},{value:"Why Traefik?",id:"why-traefik",level:3},{value:"Why Proxy Pattern for Development?",id:"why-proxy-pattern-for-development",level:3},{value:"Further Reading",id:"further-reading",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"vaettir-architecture",children:"Vaettir Architecture"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Vaettir is a self-hosted n8n automation platform with enhanced capabilities for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Python/JavaScript code execution via isolated task runners"}),"\n",(0,s.jsx)(n.li,{children:"Optional LLM observability via Opik"}),"\n",(0,s.jsx)(n.li,{children:"Development proxy pattern for local service integration"}),"\n",(0,s.jsx)(n.li,{children:"Production-ready deployment with Traefik reverse proxy"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"system-components",children:"System Components"}),"\n",(0,s.jsx)(n.h3,{id:"core-services",children:"Core Services"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Production Server                         \u2502\n\u2502                   (vaettir.locki.io)                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                               \u2502\n\u2502  \u2502 Traefik  \u2502 \u2190 HTTPS (443)                                \u2502\n\u2502  \u2502 Reverse  \u2502                                               \u2502\n\u2502  \u2502  Proxy   \u2502                                               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                                               \u2502\n\u2502       \u2502                                                      \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502       \u2193                  \u2193                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502  \u2502   n8n   \u2502\u2190\u2500\u2500\u2500\u2500\u2192\u2502  Proxy   \u2502 (optional)                  \u2502\n\u2502  \u2502  Main   \u2502      \u2502 Services \u2502                              \u2502\n\u2502  \u2502 Server  \u2502      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518           \u2502                                    \u2502\n\u2502       \u2502                \u2502                                     \u2502\n\u2502       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502       \u2193                \u2193                 \u2193                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 Task    \u2502    \u2502 Postgres \u2502      \u2502  Redis   \u2502            \u2502\n\u2502  \u2502 Runner  \u2502    \u2502    DB    \u2502      \u2502  Queue   \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u2502 ngrok tunnel (dev only)\n                         \u2193\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502   Local Machine      \u2502\n              \u2502  (Development)       \u2502\n              \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n              \u2502  \u2022 ocapistaine       \u2502\n              \u2502  \u2022 Other services    \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"component-details",children:"Component Details"}),"\n",(0,s.jsx)(n.h3,{id:"1-n8n-main-server",children:"1. n8n Main Server"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Image"}),": Custom build from ",(0,s.jsx)(n.code,{children:"n8nio/n8n:latest"})," + ",(0,s.jsx)(n.code,{children:"n8n-observability"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Responsibilities"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Workflow execution orchestration"}),"\n",(0,s.jsx)(n.li,{children:"Webhook endpoints"}),"\n",(0,s.jsx)(n.li,{children:"User interface (port 5678)"}),"\n",(0,s.jsx)(n.li,{children:"API endpoints"}),"\n",(0,s.jsx)(n.li,{children:"Workflow data storage (via Postgres)"}),"\n",(0,s.jsx)(n.li,{children:"Queue management (via Redis in queue mode)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database: PostgreSQL for persistent storage"}),"\n",(0,s.jsx)(n.li,{children:"Execution mode: Queue (for scalability)"}),"\n",(0,s.jsx)(n.li,{children:"Task runners: External mode (isolated code execution)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Environment Variables"})," (key ones):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"N8N_HOST=vaettir.locki.io\nN8N_PROTOCOL=https\nDB_TYPE=postgresdb\nN8N_EXECUTION_MODE=queue\nN8N_RUNNERS_ENABLED=true\nN8N_RUNNERS_MODE=external\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-task-runner",children:"2. Task Runner"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Image"}),": ",(0,s.jsx)(n.code,{children:"n8nio/runners:latest"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Executes user-provided Python and JavaScript code in isolation"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Security Features"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Runs in separate container from n8n"}),"\n",(0,s.jsxs)(n.li,{children:["Module allow/deny lists via ",(0,s.jsx)(n.code,{children:"n8n-task-runners.json"})]}),"\n",(0,s.jsx)(n.li,{children:"Sandboxed execution environment"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Communication"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Connects to n8n via WebSocket on port 5679"}),"\n",(0,s.jsxs)(n.li,{children:["Authentication via ",(0,s.jsx)(n.code,{children:"N8N_RUNNERS_AUTH_TOKEN"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration File"}),": ",(0,s.jsx)(n.code,{children:"/etc/n8n-task-runners.json"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "task-runners": [\n    {\n      "runner-type": "python",\n      "env-overrides": {\n        "N8N_RUNNERS_STDLIB_ALLOW": "*",\n        "N8N_RUNNERS_EXTERNAL_ALLOW": "*"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-postgresql-database",children:"3. PostgreSQL Database"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Image"}),": ",(0,s.jsx)(n.code,{children:"postgres:16-alpine"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Stores"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Workflow definitions"}),"\n",(0,s.jsx)(n.li,{children:"Execution history"}),"\n",(0,s.jsx)(n.li,{children:"Credentials (encrypted)"}),"\n",(0,s.jsx)(n.li,{children:"User settings"}),"\n",(0,s.jsx)(n.li,{children:"Webhook registrations"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Persistence"}),": ",(0,s.jsx)(n.code,{children:"postgres_data"})," Docker volume"]}),"\n",(0,s.jsx)(n.h3,{id:"4-redis-queue",children:"4. Redis Queue"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Image"}),": ",(0,s.jsx)(n.code,{children:"redis:7-alpine"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Job queue for workflow executions"}),"\n",(0,s.jsx)(n.li,{children:"Enables horizontal scaling with workers"}),"\n",(0,s.jsx)(n.li,{children:"Currently used in queue mode"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Workers are currently disabled but can be enabled for multi-instance scaling."]}),"\n",(0,s.jsx)(n.h3,{id:"5-traefik-reverse-proxy",children:"5. Traefik Reverse Proxy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Profile"}),": ",(0,s.jsx)(n.code,{children:"production"})," only"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Responsibilities"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HTTPS termination (Let's Encrypt)"}),"\n",(0,s.jsx)(n.li,{children:"Routing requests to n8n"}),"\n",(0,s.jsx)(n.li,{children:"Certificate management"}),"\n",(0,s.jsx)(n.li,{children:"Access control"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Automatic HTTPS via ACME (Let's Encrypt)"}),"\n",(0,s.jsxs)(n.li,{children:["Routes ",(0,s.jsx)(n.code,{children:"vaettir.locki.io"})," \u2192 n8n:5678"]}),"\n",(0,s.jsxs)(n.li,{children:["Stores certificates in ",(0,s.jsx)(n.code,{children:"traefik_data"})," volume"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"6-proxy-services-optional",children:"6. Proxy Services (Optional)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Image"}),": Custom nginx proxy (",(0,s.jsx)(n.code,{children:"Dockerfile.proxy"}),")"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose"}),": Route n8n workflow HTTP requests to external services"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Development: Route to ngrok tunnel \u2192 local machine"}),"\n",(0,s.jsx)(n.li,{children:"Production: Route to real containerized services"}),"\n",(0,s.jsx)(n.li,{children:"Multiple services: ocapistaine, future integrations"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# n8n workflow calls: http://ocapistaine:8000\n# Proxy routes to: https://abc123.ngrok-free.app (dev)\n# or: http://ocapistaine-real:8000 (prod)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,s.jsx)(n.h3,{id:"workflow-execution-standard",children:"Workflow Execution (Standard)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"1. User/Webhook triggers workflow\n   \u2193\n2. n8n receives request\n   \u2193\n3. n8n queues execution (Redis)\n   \u2193\n4. n8n worker picks up job\n   \u2193\n5. For Code nodes:\n   - Task sent to Task Runner via WebSocket\n   - Runner executes Python/JS in sandbox\n   - Results returned to n8n\n   \u2193\n6. Workflow completes\n   \u2193\n7. Results stored in Postgres\n   \u2193\n8. Optional: Execution trace sent to Opik\n"})}),"\n",(0,s.jsx)(n.h3,{id:"development-with-proxy-pattern",children:"Development with Proxy Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'1. n8n workflow calls: http://ocapistaine:8000/moderate\n   \u2193\n2. Docker resolves "ocapistaine" to proxy service\n   \u2193\n3. Nginx proxy reads OCAPISTAINE_TARGET_URL from env\n   \u2193\n4. Proxy forwards to: https://abc123.ngrok-free.app\n   \u2193\n5. ngrok tunnel routes to: localhost:8050\n   \u2193\n6. Local ocapistaine processes request\n   \u2193\n7. Response flows back through tunnel \u2192 proxy \u2192 n8n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"environment-modes",children:"Environment Modes"}),"\n",(0,s.jsx)(n.h3,{id:"local-development",children:"Local Development"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Port 5678 exposed directly to host (",(0,s.jsx)(n.code,{children:"docker-compose.override.yml"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Traefik disabled"}),"\n",(0,s.jsx)(n.li,{children:"Debug logging enabled"}),"\n",(0,s.jsx)(n.li,{children:"Optional: Proxy services for ngrok integration"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Access"}),": ",(0,s.jsx)(n.code,{children:"http://localhost:5678"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Docker Compose"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose up -d\n# Automatically merges docker-compose.yml + docker-compose.override.yml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"production",children:"Production"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Traefik enabled via ",(0,s.jsx)(n.code,{children:"--profile production"})]}),"\n",(0,s.jsx)(n.li,{children:"Port 5678 NOT exposed (Traefik routes internally)"}),"\n",(0,s.jsx)(n.li,{children:"HTTPS with automatic certificates"}),"\n",(0,s.jsx)(n.li,{children:"Production logging level"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Access"}),": ",(0,s.jsx)(n.code,{children:"https://vaettir.locki.io"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Docker Compose"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose --profile production up -d\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-architecture",children:"Security Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"network-isolation",children:"Network Isolation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"n8n not directly exposed in production (Traefik only)"}),"\n",(0,s.jsx)(n.li,{children:"Task runner can't access host network"}),"\n",(0,s.jsx)(n.li,{children:"Database and Redis only accessible within Docker network"}),"\n",(0,s.jsx)(n.li,{children:"Secrets managed via environment variables (gitignored)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"code-execution-security",children:"Code Execution Security"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Task runner runs in separate container"}),"\n",(0,s.jsx)(n.li,{children:"Python/JS module restrictions via allow lists"}),"\n",(0,s.jsx)(n.li,{children:"Sandboxed execution environment"}),"\n",(0,s.jsx)(n.li,{children:"No direct filesystem access from code nodes"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"authentication-layers",children:"Authentication Layers"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"n8n Basic Auth"}),": Username/password for UI access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Task Runner Auth"}),": Token-based auth between n8n \u2194 runner"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Traefik"}),": Can add additional auth layers if needed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Webhook Secrets"}),": Optional webhook signature verification"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"secrets-management",children:"Secrets Management"}),"\n",(0,s.jsxs)(n.p,{children:["Sensitive values in ",(0,s.jsx)(n.code,{children:".env"})," (gitignored):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database passwords"}),"\n",(0,s.jsx)(n.li,{children:"API keys (GitHub, Facebook, Opik)"}),"\n",(0,s.jsx)(n.li,{children:"Auth tokens"}),"\n",(0,s.jsx)(n.li,{children:"Encryption keys"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Never commit"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".env"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".env.production"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"docker-compose.override.yml"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"scalability-considerations",children:"Scalability Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"current-setup-single-instance",children:"Current Setup (Single Instance)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"All executions on one n8n container"}),"\n",(0,s.jsx)(n.li,{children:"Queue mode enabled but no workers"}),"\n",(0,s.jsx)(n.li,{children:"Suitable for moderate workloads"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"horizontal-scaling-future",children:"Horizontal Scaling (Future)"}),"\n",(0,s.jsxs)(n.p,{children:["Enable workers by uncommenting in ",(0,s.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"n8n-worker:\n  image: n8nio/n8n:latest\n  command: n8n worker\n  # ... same environment as main n8n\n  deploy:\n    replicas: 3 # Scale workers independently\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Multiple workers process queue concurrently"}),"\n",(0,s.jsx)(n.li,{children:"Main n8n handles webhooks/UI only"}),"\n",(0,s.jsx)(n.li,{children:"Better resource utilization"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"observability-integration",children:"Observability Integration"}),"\n",(0,s.jsx)(n.h3,{id:"optional-opik-llm-tracing",children:"Optional: Opik LLM Tracing"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"When Enabled"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Every workflow execution traced"}),"\n",(0,s.jsx)(n.li,{children:"LLM calls monitored"}),"\n",(0,s.jsx)(n.li,{children:"Performance metrics collected"}),"\n",(0,s.jsx)(n.li,{children:"Sent to Comet Opik platform"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Architecture"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"n8n (with n8n-observability hooks)\n  \u2193 OTLP/HTTP\nOpik Cloud (comet.com)\n  \u2193\nDashboard, analytics, alerts\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"EXTERNAL_HOOK_FILES=/usr/local/lib/node_modules/n8n-observability/dist/hooks.cjs\nOTEL_EXPORTER_OTLP_ENDPOINT=https://www.comet.com/opik/api/v1/private/otel\nOTEL_EXPORTER_OTLP_HEADERS=Authorization=${OPIK_API_KEY},...\n"})}),"\n",(0,s.jsx)(n.h2,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Component"}),(0,s.jsx)(n.th,{children:"Technology"}),(0,s.jsx)(n.th,{children:"Version"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Orchestration"}),(0,s.jsx)(n.td,{children:"n8n"}),(0,s.jsx)(n.td,{children:"latest"}),(0,s.jsx)(n.td,{children:"Workflow automation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Task Execution"}),(0,s.jsx)(n.td,{children:"n8n runners"}),(0,s.jsx)(n.td,{children:"latest"}),(0,s.jsx)(n.td,{children:"Python/JS sandbox"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Database"}),(0,s.jsx)(n.td,{children:"PostgreSQL"}),(0,s.jsx)(n.td,{children:"16-alpine"}),(0,s.jsx)(n.td,{children:"Data persistence"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Queue"}),(0,s.jsx)(n.td,{children:"Redis"}),(0,s.jsx)(n.td,{children:"7-alpine"}),(0,s.jsx)(n.td,{children:"Job queue"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Reverse Proxy"}),(0,s.jsx)(n.td,{children:"Traefik"}),(0,s.jsx)(n.td,{children:"latest"}),(0,s.jsx)(n.td,{children:"HTTPS, routing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service Proxy"}),(0,s.jsx)(n.td,{children:"nginx"}),(0,s.jsx)(n.td,{children:"alpine"}),(0,s.jsx)(n.td,{children:"ngrok routing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Observability"}),(0,s.jsx)(n.td,{children:"Opik"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"LLM monitoring"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"key-design-decisions",children:"Key Design Decisions"}),"\n",(0,s.jsx)(n.h3,{id:"why-external-task-runners",children:"Why External Task Runners?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security"}),": Code execution isolated from main app"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Stability"}),": Crashes don't affect n8n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resource limits"}),": Can restrict CPU/memory per runner"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Requirement"}),": n8n v2.0+ requires this for Python"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-queue-mode",children:"Why Queue Mode?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scalability"}),": Can add workers later"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resilience"}),": Jobs survive n8n restarts"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Visibility"}),": Execution status tracked in queue"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Control"}),": Better execution ordering and priority"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-traefik",children:"Why Traefik?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automatic HTTPS"}),": Let's Encrypt integration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Docker-native"}),": Service discovery via labels"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lightweight"}),": Minimal resource footprint"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Flexible"}),": Easy to add more routes/services"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"why-proxy-pattern-for-development",children:"Why Proxy Pattern for Development?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consistency"}),": Workflows don't change between dev/prod"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Flexibility"}),": Easy to switch targets"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Speed"}),": Develop locally, test against production n8n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reusable"}),": Pattern works for any service"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/orchestration/SETUP",children:"Setup Guide"})," - Installation instructions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/orchestration/DEVELOPMENT",children:"Development Workflow"})," - Using the proxy pattern"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.n8n.io/hosting/architecture/",children:"n8n Architecture"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.n8n.io/hosting/configuration/task-runners/",children:"n8n Task Runners"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>t,x:()=>o});var r=i(6540);const s={},l=r.createContext(s);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);