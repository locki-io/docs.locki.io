"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[9464],{3378(e,s,n){n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"methods/git-cache-cheats","title":"git-cache-cheats","description":"1. Quick scenarios: Untrack / remove files from Git (but keep or delete locally)","source":"@site/docs/methods/git-cache-cheats.md","sourceDirName":"methods","slug":"/methods/git-cache-cheats","permalink":"/docs/methods/git-cache-cheats","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/methods/git-cache-cheats.md","tags":[],"version":"current","frontMatter":{}}');var r=n(4848),t=n(8453);const c={},l=void 0,o={},d=[{value:"1. Quick scenarios: Untrack / remove files from Git (but keep or delete locally)",id:"1-quick-scenarios-untrack--remove-files-from-git-but-keep-or-delete-locally",level:3},{value:"2. One-liners people use most often",id:"2-one-liners-people-use-most-often",level:3},{value:"3. New: Preview or rewind last commit <strong>before pushing</strong> (check for large files, mistakes, etc.)",id:"3-new-preview-or-rewind-last-commit-before-pushing-check-for-large-files-mistakes-etc",level:3},{value:"Bonus reminders",id:"bonus-reminders",level:3}];function a(e){const s={br:"br",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h3,{id:"1-quick-scenarios-untrack--remove-files-from-git-but-keep-or-delete-locally",children:"1. Quick scenarios: Untrack / remove files from Git (but keep or delete locally)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Untrack one file"})," (stop Git from tracking it, but ",(0,r.jsx)(s.strong,{children:"keep"})," it on disk)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git rm --cached path/to/file.txt\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u2192 Then usually: add it to ",(0,r.jsx)(s.code,{children:".gitignore"})," \u2192 ",(0,r.jsx)(s.code,{children:"git add .gitignore"})," \u2192 ",(0,r.jsx)(s.code,{children:"git commit"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Untrack a whole folder"})," (recursive)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git rm -r --cached path/to/dir/\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Apply new .gitignore rules"})," (most common fix when ignored files still appear in ",(0,r.jsx)(s.code,{children:"git status"}),")"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'git rm -r --cached .\ngit add .\ngit commit -m "Apply updated .gitignore \u2014 refresh tracked files"\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Unstage a file"})," (remove from index/staging, but keep changes locally and still track it later)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git restore --staged path/to/file.txt     # Git 2.23+\n# or older equivalent:\ngit reset HEAD path/to/file.txt\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Delete file everywhere"})," (from Git + from your disk)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git rm path/to/file.txt\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Clean up untracked files/folders"})," (dangerous \u2014 preview first!)",(0,r.jsx)(s.br,{}),"\n","Preview: ",(0,r.jsx)(s.code,{children:"git clean -n -fd"}),(0,r.jsx)(s.br,{}),"\n","Delete: ",(0,r.jsx)(s.code,{children:"git clean -fd"})," (",(0,r.jsx)(s.code,{children:"-x"})," also removes ignored files)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"2-one-liners-people-use-most-often",children:"2. One-liners people use most often"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Fix .gitignore not working"})," (ignored files still tracked):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'git rm -r --cached .\ngit add .\ngit commit -m "Refresh index \u2014 apply new .gitignore rules"\n'})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Untrack accidentally committed sensitive / generated file"})," (e.g. ",(0,r.jsx)(s.code,{children:".env"}),", ",(0,r.jsx)(s.code,{children:"node_modules/"}),", ",(0,r.jsx)(s.code,{children:"dist/"}),"):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'git rm --cached .env\necho ".env" >> .gitignore\ngit add .gitignore\ngit commit -m "Untrack .env file"\n'})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Nuke local junk + reset to remote clean state"})," (careful \u2014 destroys uncommitted work!):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git fetch\ngit reset --hard origin/main          # or your branch name\ngit clean -fdx                        # also removes ignored files\n"})}),"\n",(0,r.jsxs)(s.h3,{id:"3-new-preview-or-rewind-last-commit-before-pushing-check-for-large-files-mistakes-etc",children:["3. New: Preview or rewind last commit ",(0,r.jsx)(s.strong,{children:"before pushing"})," (check for large files, mistakes, etc.)"]}),"\n",(0,r.jsxs)(s.p,{children:["Very useful right after ",(0,r.jsx)(s.code,{children:"git commit"}),' when you realize "wait\u2026 did I really add that 400 MB dataset / build folder / video?"']}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Option A \u2014 Safest & easiest: Soft reset (keeps your files & changes, just undoes the commit)"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git reset --soft HEAD~1\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u2192 What happens:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"The last commit disappears"}),"\n",(0,r.jsxs)(s.li,{children:["All files/changes go back to ",(0,r.jsx)(s.strong,{children:"staged"})," (green in ",(0,r.jsx)(s.code,{children:"git status"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:["You can now run ",(0,r.jsx)(s.code,{children:"git status"}),", ",(0,r.jsx)(s.code,{children:"git diff --staged"}),", or even ",(0,r.jsx)(s.code,{children:"git diff"})," to inspect"]}),"\n",(0,r.jsxs)(s.li,{children:["Check large files: ",(0,r.jsx)(s.code,{children:"git diff --staged --stat"})," or look at individual files"]}),"\n",(0,r.jsxs)(s.li,{children:["Fix: ",(0,r.jsx)(s.code,{children:"git restore --staged hugefile.bin"})," (unstage bad files), add to ",(0,r.jsx)(s.code,{children:".gitignore"}),", then ",(0,r.jsx)(s.code,{children:"git commit"})," again"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Option B \u2014 Inspect without changing anything (detached HEAD mode)"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git checkout HEAD~1\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\u2192 You are now looking at the state ",(0,r.jsx)(s.strong,{children:"before"})," your last commit"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Run ",(0,r.jsx)(s.code,{children:"ls"}),", ",(0,r.jsx)(s.code,{children:"du -sh *"}),", ",(0,r.jsx)(s.code,{children:"find . -size +50M"})," to spot large files"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"git diff HEAD~1..HEAD"})," or ",(0,r.jsx)(s.code,{children:"git show HEAD"})," to see exactly what the bad commit added"]}),"\n",(0,r.jsxs)(s.li,{children:["When done: ",(0,r.jsx)(s.code,{children:"git checkout main"})," (or your branch) to go back"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Option C \u2014 Throw away the last commit completely"})," (only if you're sure \u2014 changes lost unless in reflog)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git reset --hard HEAD~1\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u2192 Use only if you're okay losing the changes forever (rare before push)"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Quick check for large files in the last commit"})," (approximate size of new/changed blobs):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git rev-list --objects --all | git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' | awk '/^blob/ {print substr($0, index($0,$3))}' | sort -nrk2 | head -n 10\n"})}),"\n",(0,r.jsxs)(s.p,{children:["(or simpler: just ",(0,r.jsx)(s.code,{children:"git diff --stat HEAD~1"})," to see changed files & approximate impact)"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Pro tip"})," \u2014 Do this ",(0,r.jsx)(s.strong,{children:"before"})," ",(0,r.jsx)(s.code,{children:"git push"}),":",(0,r.jsx)(s.br,{}),"\n","Always ",(0,r.jsx)(s.code,{children:"git log -1 --stat"})," or ",(0,r.jsx)(s.code,{children:"git show --stat"})," after committing.",(0,r.jsx)(s.br,{}),"\n","If something looks wrong \u2192 use the soft reset method above.",(0,r.jsx)(s.br,{}),"\n","Once pushed \u2192 it's much harder (needs history rewrite like ",(0,r.jsx)(s.code,{children:"git filter-repo"}),")."]}),"\n",(0,r.jsx)(s.h3,{id:"bonus-reminders",children:"Bonus reminders"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"--cached"})," = \"only touch Git's index \u2014 don't delete my actual files\""]}),"\n",(0,r.jsxs)(s.li,{children:["After ",(0,r.jsx)(s.code,{children:"git rm --cached"}),", ",(0,r.jsx)(s.strong,{children:"always commit"})," the change"]}),"\n",(0,r.jsxs)(s.li,{children:["Run ",(0,r.jsx)(s.code,{children:"git status"})," before big commands"]}),"\n",(0,r.jsxs)(s.li,{children:["If already pushed \u2192 teammates may need ",(0,r.jsx)(s.code,{children:"git fetch && git reset --hard origin/branch"})," after your fix"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Hope this version is much easier to scan and practice \u2014 let me know if you want to add screenshots/examples or tweak anything!"})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,s,n){n.d(s,{R:()=>c,x:()=>l});var i=n(6540);const r={},t=i.createContext(r);function c(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);