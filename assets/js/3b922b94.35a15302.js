"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[8482],{4560(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"app/FORSETI_AGENT","title":"Forseti 461 Agent","description":"Overview","source":"@site/docs/app/FORSETI_AGENT.md","sourceDirName":"app","slug":"/app/FORSETI_AGENT","permalink":"/docs/app/FORSETI_AGENT","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/app/FORSETI_AGENT.md","tags":[],"version":"current","frontMatter":{}}');var i=t(4848),s=t(8453);const a={},l="Forseti 461 Agent",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Features",id:"features",level:2},{value:"Feature 1: Charter Validation",id:"feature-1-charter-validation",level:3},{value:"Feature 2: Category Classification",id:"feature-2-category-classification",level:3},{value:"Feature 3: Wording Correction",id:"feature-3-wording-correction",level:3},{value:"Batch Validation (Experiments)",id:"batch-validation-experiments",level:3},{value:"Prompt Organization",id:"prompt-organization",level:2},{value:"Shared System Prompt",id:"shared-system-prompt",level:3},{value:"Feature Prompts (User Messages)",id:"feature-prompts-user-messages",level:3},{value:"Adding a New Feature",id:"adding-a-new-feature",level:2},{value:"Step 1: Define the Prompt",id:"step-1-define-the-prompt",level:3},{value:"Step 2: Create the Result Model",id:"step-2-create-the-result-model",level:3},{value:"Step 3: Implement the Feature Class",id:"step-3-implement-the-feature-class",level:3},{value:"Step 4: Register the Feature",id:"step-4-register-the-feature",level:3},{value:"Step 5: Sync to Opik",id:"step-5-sync-to-opik",level:3},{value:"Step 6: Write Tests",id:"step-6-write-tests",level:3},{value:"Step 7: Optimize with Opik (Optional)",id:"step-7-optimize-with-opik-optional",level:3},{value:"Usage",id:"usage",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Individual Features",id:"individual-features",level:3},{value:"With Tracing",id:"with-tracing",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"forseti-461-agent",children:"Forseti 461 Agent"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Forseti 461 is the charter validation agent for Audierne2026, named after the Norse god of justice. It validates citizen contributions against the community charter, classifies them into categories, and optionally suggests wording improvements."}),"\n",(0,i.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         FORSETI 461 AGENT                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                             \u2502\n\u2502  app/agents/forseti/                                                        \u2502\n\u2502  \u251c\u2500\u2500 __init__.py              Module exports                                \u2502\n\u2502  \u251c\u2500\u2500 agent.py                 ForsetiAgent class                            \u2502\n\u2502  \u251c\u2500\u2500 models.py                Pydantic models (ValidationResult, etc.)      \u2502\n\u2502  \u251c\u2500\u2500 prompts.py               Re-exports from app/prompts/                  \u2502\n\u2502  \u2514\u2500\u2500 features/                                                              \u2502\n\u2502      \u251c\u2500\u2500 __init__.py          Feature exports                               \u2502\n\u2502      \u251c\u2500\u2500 base.py              FeatureBase abstract class                    \u2502\n\u2502      \u251c\u2500\u2500 charter_validation.py                                              \u2502\n\u2502      \u251c\u2500\u2500 category_classification.py                                         \u2502\n\u2502      \u2514\u2500\u2500 wording_correction.py                                              \u2502\n\u2502                                                                             \u2502\n\u2502  app/prompts/                                                               \u2502\n\u2502  \u251c\u2500\u2500 local/forseti.py         Python prompts (fallback)                     \u2502\n\u2502  \u2514\u2500\u2500 local/forseti_charter.json   Opik-synced prompts (chat format)         \u2502\n\u2502                                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,i.jsx)(n.h3,{id:"feature-1-charter-validation",children:"Feature 1: Charter Validation"}),"\n",(0,i.jsx)(n.p,{children:"Validates contributions against the charter rules."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Class"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CharterValidationFeature"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Prompt"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti.charter_validation"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Opik Name"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti461-user-charter-validation"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Variables"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"title"}),", ",(0,i.jsx)(n.code,{children:"body"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Output"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ValidationResult"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Checks for violations:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Personal attacks or discrimination"}),"\n",(0,i.jsx)(n.li,{children:"Spam or advertising"}),"\n",(0,i.jsx)(n.li,{children:"Off-topic content (unrelated to Audierne-Esquibien)"}),"\n",(0,i.jsx)(n.li,{children:"False information"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Identifies encouraged aspects:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Concrete proposals"}),"\n",(0,i.jsx)(n.li,{children:"Constructive criticism"}),"\n",(0,i.jsx)(n.li,{children:"Questions and clarifications"}),"\n",(0,i.jsx)(n.li,{children:"Shared expertise"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"feature-2-category-classification",children:"Feature 2: Category Classification"}),"\n",(0,i.jsx)(n.p,{children:"Assigns contributions to one of 7 predefined categories."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Class"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CategoryClassificationFeature"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Prompt"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti.category_classification"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Opik Name"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti461-user-category-classification"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Variables"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"title"}),", ",(0,i.jsx)(n.code,{children:"body"}),", ",(0,i.jsx)(n.code,{children:"current_category_line"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Output"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ClassificationResult"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Categories:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"economie"})," - Commerce, tourism, port, fishing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logement"})," - Housing, urban planning"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"culture"})," - Heritage, events, associations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ecologie"})," - Environment, energy, biodiversity"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"associations"})," - Local organizations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"jeunesse"})," - Youth, schools, education"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"alimentation-bien-etre-soins"})," - Food, health, wellness"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"feature-3-wording-correction",children:"Feature 3: Wording Correction"}),"\n",(0,i.jsx)(n.p,{children:"Suggests improvements for clarity and constructiveness."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Class"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WordingCorrectionFeature"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Prompt"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti.wording_correction"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Opik Name"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti461-user-wording-correction"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Variables"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"title"}),", ",(0,i.jsx)(n.code,{children:"body"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Output"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WordingResult"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Improvements include:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Clarity and readability"}),"\n",(0,i.jsx)(n.li,{children:"Grammar corrections"}),"\n",(0,i.jsx)(n.li,{children:"More constructive phrasing"}),"\n",(0,i.jsx)(n.li,{children:"Removing inflammatory language"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"batch-validation-experiments",children:"Batch Validation (Experiments)"}),"\n",(0,i.jsxs)(n.p,{children:["Batch validation is handled as ",(0,i.jsx)(n.strong,{children:"Opik experiments"}),", not as a feature class. This allows:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A/B testing different prompt versions"}),"\n",(0,i.jsx)(n.li,{children:"Tracking metrics across validation runs"}),"\n",(0,i.jsx)(n.li,{children:"Comparing performance over time"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/app/PROMPT_MANAGEMENT",children:"PROMPT_MANAGEMENT.md"})," for experiment setup."]}),"\n",(0,i.jsx)(n.h2,{id:"prompt-organization",children:"Prompt Organization"}),"\n",(0,i.jsx)(n.h3,{id:"shared-system-prompt",children:"Shared System Prompt"}),"\n",(0,i.jsx)(n.p,{children:"All features share the same persona (system message):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"forseti.persona\n\u251c\u2500\u2500 Opik: forseti461-system-charter-28012026\n\u251c\u2500\u2500 Commit: a5195f45\n\u2514\u2500\u2500 Used by: ALL features\n"})}),"\n",(0,i.jsx)(n.h3,{id:"feature-prompts-user-messages",children:"Feature Prompts (User Messages)"}),"\n",(0,i.jsx)(n.p,{children:"Each feature has its own user prompt optimized for its task:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Local Name"}),(0,i.jsx)(n.th,{children:"Opik Name"}),(0,i.jsx)(n.th,{children:"Status"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Charter"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti.charter_validation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti461-user-charter-28012026"})}),(0,i.jsx)(n.td,{children:"\u2705 Synced"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Category"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti.category_classification"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti461-user-category-29012026"})}),(0,i.jsx)(n.td,{children:"\u2705 Synced"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Wording"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti.wording_correction"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"forseti461-user-wording-29012026"})}),(0,i.jsx)(n.td,{children:"\u2705 Synced"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"adding-a-new-feature",children:"Adding a New Feature"}),"\n",(0,i.jsx)(n.p,{children:"Follow this procedure to add a new feature with Opik integration."}),"\n",(0,i.jsx)(n.h3,{id:"step-1-define-the-prompt",children:"Step 1: Define the Prompt"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create the prompt template"})," in ",(0,i.jsx)(n.code,{children:"app/prompts/local/forseti.py"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'MY_FEATURE_PROMPT = """You are performing [task description].\n\n[Context and instructions]\n\nAnalyze the following contribution:\n\nTITLE: {title}\nBODY: {body}\n\nReturn a JSON object with:\n- "field1": description\n- "field2": description\n\nReturn JSON only, no markdown fences."""\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add to PROMPTS dict"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'PROMPTS = {\n    # ... existing prompts ...\n    "forseti.my_feature": {\n        "template": MY_FEATURE_PROMPT,\n        "type": "user",\n        "variables": ["title", "body"],\n        "description": "Description of what this feature does",\n    },\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-create-the-result-model",children:"Step 2: Create the Result Model"}),"\n",(0,i.jsxs)(n.p,{children:["Add to ",(0,i.jsx)(n.code,{children:"app/agents/forseti/models.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class MyFeatureResult(BaseModel):\n    """Result from my feature."""\n    field1: str\n    field2: list[str]\n    reasoning: str\n    confidence: float = Field(ge=0.0, le=1.0)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-implement-the-feature-class",children:"Step 3: Implement the Feature Class"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"app/agents/forseti/features/my_feature.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'"""\nMy Feature\n\nDescription of what this feature does.\n"""\n\nfrom app.providers import LLMProvider\n\nfrom ..models import MyFeatureResult\nfrom ..prompts import MY_FEATURE_PROMPT\nfrom .base import FeatureBase\n\n\nclass MyFeatureFeature(FeatureBase):\n    """\n    Feature for [description].\n    """\n\n    @property\n    def name(self) -> str:\n        return "my_feature"\n\n    @property\n    def prompt(self) -> str:\n        return MY_FEATURE_PROMPT\n\n    async def execute(\n        self,\n        provider: LLMProvider,\n        system_prompt: str,\n        title: str,\n        body: str,\n        **kwargs,\n    ) -> MyFeatureResult:\n        """\n        Execute the feature.\n\n        Args:\n            provider: LLM provider.\n            system_prompt: Agent persona prompt.\n            title: Contribution title.\n            body: Contribution body.\n\n        Returns:\n            MyFeatureResult with results.\n        """\n        user_prompt = self.format_prompt(title=title, body=body)\n\n        try:\n            data = await self._get_json_response(\n                provider=provider,\n                system_prompt=system_prompt,\n                user_prompt=user_prompt,\n                temperature=0.3,\n            )\n\n            return MyFeatureResult(\n                field1=data.get("field1", ""),\n                field2=data.get("field2", []),\n                reasoning=data.get("reasoning", ""),\n                confidence=float(data.get("confidence", 0.5)),\n            )\n        except Exception as e:\n            return MyFeatureResult(\n                field1="",\n                field2=[],\n                reasoning=f"Error: {e}",\n                confidence=0.5,\n            )\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-register-the-feature",children:"Step 4: Register the Feature"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Export from features module"})," (",(0,i.jsx)(n.code,{children:"app/agents/forseti/features/__init__.py"}),"):"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from .my_feature import MyFeatureFeature\n\n__all__ = [\n    # ... existing ...\n    "MyFeatureFeature",\n]\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Register in agent"})," (",(0,i.jsx)(n.code,{children:"app/agents/forseti/agent.py"}),"):"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from .features import MyFeatureFeature\n\nclass ForsetiAgent(BaseAgent):\n    def __init__(self, ..., enable_my_feature: bool = False):\n        # ...\n        if enable_my_feature:\n            self.register_feature(MyFeatureFeature())\n\n    async def my_feature(self, title: str, body: str) -> MyFeatureResult:\n        """Public method for the feature."""\n        return await self.execute_feature("my_feature", title=title, body=body)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-sync-to-opik",children:"Step 5: Sync to Opik"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add to JSON file"})," (",(0,i.jsx)(n.code,{children:"app/prompts/local/forseti_charter.json"}),"):"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "forseti.my_feature": {\n    "name": "forseti461-user-myfeature-DDMMYYYY",\n    "opik_commit": null,\n    "type": "user",\n    "format": "chat",\n    "variables": ["input.title", "input.body"],\n    "description": "Description",\n    "messages": [\n      {\n        "role": "user",\n        "content": "Your prompt with {{input.title}} and {{input.body}} variables"\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sync to Opik"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python -m app.prompts.opik_sync --prefix forseti.my_feature\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Update commit hash"})," after sync:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Get the commit ID from Opik UI or API"}),"\n",(0,i.jsxs)(n.li,{children:["Update ",(0,i.jsx)(n.code,{children:"opik_commit"})," in the JSON file"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-6-write-tests",children:"Step 6: Write Tests"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"tests/test_my_feature.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pytest\nfrom unittest.mock import AsyncMock, patch\n\nfrom app.agents.forseti import ForsetiAgent\nfrom app.agents.forseti.models import MyFeatureResult\n\n\n@pytest.fixture\ndef mock_provider():\n    provider = AsyncMock()\n    provider.complete.return_value = AsyncMock(\n        content=\'{"field1": "test", "field2": [], "reasoning": "ok", "confidence": 0.9}\'\n    )\n    return provider\n\n\n@pytest.mark.asyncio\nasync def test_my_feature(mock_provider):\n    agent = ForsetiAgent(provider=mock_provider, enable_my_feature=True)\n    result = await agent.my_feature(title="Test", body="Content")\n\n    assert isinstance(result, MyFeatureResult)\n    assert result.field1 == "test"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-7-optimize-with-opik-optional",children:"Step 7: Optimize with Opik (Optional)"}),"\n",(0,i.jsx)(n.p,{children:"Once you have validation data, optimize the prompt:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from app.prompts import optimize_forseti_charter\n\n# Create a dataset in Opik with labeled examples\nresult = optimize_forseti_charter(\n    dataset_name="forseti-my-feature-training",\n    optimizer_type="meta_prompt",\n    num_iterations=50,\n)\n\nprint(f"Best score: {result.best_score:.2%}")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from app.agents.forseti import ForsetiAgent\n\nagent = ForsetiAgent()\n\n# Full validation (charter + classification)\nresult = await agent.validate(\n    title="Proposition pour le port",\n    body="Je propose d\'am\xe9liorer l\'\xe9clairage du port..."\n)\n\nprint(f"Valid: {result.is_valid}")\nprint(f"Category: {result.category}")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"individual-features",children:"Individual Features"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Charter validation only\nvalidation = await agent.validate_charter(title="...", body="...")\n\n# Category classification only\nclassification = await agent.classify_category(title="...", body="...")\n\n# Wording correction (requires enable_wording=True)\nagent = ForsetiAgent(enable_wording=True)\nwording = await agent.correct_wording(title="...", body="...")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"with-tracing",children:"With Tracing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from app.agents.tracing import get_tracer\n\ntracer = get_tracer()\nagent = ForsetiAgent(tracer=tracer)\n\n# Traces automatically recorded to Opik\nresult = await agent.validate(title="...", body="...")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/app/PROMPT_MANAGEMENT",children:"PROMPT_MANAGEMENT.md"})," - Prompt registry and Opik integration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/app/AUTO_CONTRIBUTIONS",children:"AUTO_CONTRIBUTIONS.md"})," - Auto-contribution workflow using Forseti"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/app/LOGGING",children:"LOGGING.md"})," - Structured logging for agents"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>l});var r=t(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);