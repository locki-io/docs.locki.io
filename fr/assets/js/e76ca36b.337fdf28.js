"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[6902],{5147(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"workflows/n8n_integrations/Forseti-Charter-Validation","title":"Forseti Charter Validation","description":"Workflow ID: [TBD - assign after N8N creation]","source":"@site/docs/workflows/n8n_integrations/Forseti-Charter-Validation.md","sourceDirName":"workflows/n8n_integrations","slug":"/workflows/n8n_integrations/Forseti-Charter-Validation","permalink":"/fr/docs/workflows/n8n_integrations/Forseti-Charter-Validation","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/workflows/n8n_integrations/Forseti-Charter-Validation.md","tags":[],"version":"current","frontMatter":{}}');var t=s(4848),l=s(8453);const a={},r="Forseti Charter Validation",o={},d=[{value:"Purpose",id:"purpose",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Workflow Structure (Simplified)",id:"workflow-structure-simplified",level:2},{value:"Nodes Configuration",id:"nodes-configuration",level:2},{value:"1. Webhook Trigger",id:"1-webhook-trigger",level:3},{value:"2. HTTP Request - Get Issue (Check Existing Labels)",id:"2-http-request---get-issue-check-existing-labels",level:3},{value:"3. IF Node - Should Add Label",id:"3-if-node---should-add-label",level:3},{value:"4. HTTP Request - Add Label (True Branch)",id:"4-http-request---add-label-true-branch",level:3},{value:"5. Respond to Webhook",id:"5-respond-to-webhook",level:3},{value:"Input Parameters (from App)",id:"input-parameters-from-app",level:2},{value:"Output Format",id:"output-format",level:2},{value:"Label Change Effective",id:"label-change-effective",level:3},{value:"No Change (not assigned to Forseti)",id:"no-change-not-assigned-to-forseti",level:3},{value:"No Change (already has label)",id:"no-change-already-has-label",level:3},{value:"App Integration",id:"app-integration",level:2},{value:"Testing",id:"testing",level:2},{value:"Test from curl (simulating app call)",id:"test-from-curl-simulating-app-call",level:3},{value:"Test with invalid (should not add label)",id:"test-with-invalid-should-not-add-label",level:3},{value:"Learnings &amp; Issues",id:"learnings--issues",level:2},{value:"1. Separation of Concerns",id:"1-separation-of-concerns",level:3},{value:"2. Label Idempotency",id:"2-label-idempotency",level:3},{value:"3. Opik Tracing",id:"3-opik-tracing",level:3},{value:"N8N Setup Checklist",id:"n8n-setup-checklist",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Related",id:"related",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"forseti-charter-validation",children:"Forseti Charter Validation"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Workflow ID:"})," ",(0,t.jsx)(n.code,{children:"[TBD - assign after N8N creation]"}),"\n",(0,t.jsx)(n.strong,{children:"Status:"})," Active\n",(0,t.jsx)(n.strong,{children:"MCP Tool:"})," ",(0,t.jsx)(n.code,{children:"participons_validate_issue"}),"\n",(0,t.jsx)(n.strong,{children:"Created:"})," 2026-01-30"]}),"\n",(0,t.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,t.jsxs)(n.p,{children:["Add the ",(0,t.jsx)(n.code,{children:"conforme charte"})," label to a GitHub issue after the OCapistaine app has validated it against the contribution charter. This is a post-validation webhook - the LLM validation happens in the app, not in N8N."]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        OCapistaine App (front.py)                       \u2502\n\u2502                                                                         \u2502\n\u2502  User clicks "Validate" \u2192 ForsetiAgent validates \u2192 Result displayed    \u2502\n\u2502                                    \u2502                                    \u2502\n\u2502                                    \u25bc                                    \u2502\n\u2502                          if is_valid: POST to N8N                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                     \u2502\n                                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          N8N Workflow (this doc)                        \u2502\n\u2502                                                                         \u2502\n\u2502  Webhook \u2192 Check existing labels \u2192 IF valid \u2192 Add Label \u2192 Respond      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,t.jsx)(n.h2,{id:"workflow-structure-simplified",children:"Workflow Structure (Simplified)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Webhook      \u2502\u2500\u2500\u2500\u25ba\u2502 Get Issue    \u2502\u2500\u2500\u2500\u25ba\u2502 IF           \u2502\u2500\u2500\u2500\u25ba\u2502 Add Label    \u2502\n\u2502 Trigger      \u2502    \u2502 (check labels)\u2502   \u2502 (should add) \u2502    \u2502 (conditional)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                               \u2502                    \u2502\n                                               \u2502                    \u25bc\n                                               \u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 Respond to   \u2502\n                                                            \u2502 Webhook      \u2502\n                                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h2,{id:"nodes-configuration",children:"Nodes Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"1-webhook-trigger",children:"1. Webhook Trigger"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Method:"})," POST"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Path:"})," ",(0,t.jsx)(n.code,{children:"forseti/charter-valid"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Response Mode:"})," Response Node"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-http-request---get-issue-check-existing-labels",children:"2. HTTP Request - Get Issue (Check Existing Labels)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Method: GET\nURL: https://api.github.com/repos/audierne2026/participons/issues/{{ $json.body.issueNumber }}\n\nHeaders:\n  Authorization: Bearer {{ $credentials.githubApi.accessToken }}\n  Accept: application/vnd.github.v3+json\n  User-Agent: N8N-Forseti461\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-if-node---should-add-label",children:"3. IF Node - Should Add Label"}),"\n",(0,t.jsx)(n.p,{children:"Check if:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_valid"})," is true (from webhook body)"]}),"\n",(0,t.jsxs)(n.li,{children:["Issue doesn't already have ",(0,t.jsx)(n.code,{children:"conforme charte"})," label"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Condition (JavaScript):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const isValid = $('Webhook').item.json.body.is_valid === true;\nconst labels = $input.item.json.labels || [];\nconst hasLabel = labels.some(l => l.name?.toLowerCase() === 'conforme charte');\nreturn isValid && !hasLabel;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-http-request---add-label-true-branch",children:"4. HTTP Request - Add Label (True Branch)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Method: POST\nURL: https://api.github.com/repos/audierne2026/participons/issues/{{ $('Webhook').item.json.body.issueNumber }}/labels\n\nHeaders:\n  Authorization: Bearer {{ $credentials.githubApi.accessToken }}\n  Accept: application/vnd.github.v3+json\n  Content-Type: application/json\n  User-Agent: N8N-Forseti461\n\nBody:\n[\"conforme charte\"]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-respond-to-webhook",children:"5. Respond to Webhook"}),"\n",(0,t.jsx)(n.p,{children:"Both branches (label added / not added) should respond with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "issueNumber": "{{ $(\'Webhook\').item.json.body.issueNumber }}",\n  "label_added": true/false,\n  "reason": "Label added" / "Already has label" / "Not valid"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"input-parameters-from-app",children:"Input Parameters (from App)"}),"\n",(0,t.jsx)(n.p,{children:"The OCapistaine app sends this after ForsetiAgent validates:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "issueNumber": 64,\n  "is_valid": true,\n  "category": "logement",\n  "confidence": 0.92\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"output-format",children:"Output Format"}),"\n",(0,t.jsx)(n.h3,{id:"label-change-effective",children:"Label Change Effective"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "issueNumber": 64,\n  "isValid": true,\n  "new_category": "logement",\n  "category_labels": ["conforme charte"],\n  "new_title": "[logement] contribution...",\n  "should_replace_label": true,\n  "reason": "Label added"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"no-change-not-assigned-to-forseti",children:"No Change (not assigned to Forseti)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": false,\n  "issueNumber": 64,\n  "isValid": true,\n  "new_category": "logement",\n  "category_labels": [],\n  "new_title": "",\n  "should_replace_label": false,\n  "reason": "task not assigned to forseti461"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"no-change-already-has-label",children:"No Change (already has label)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": false,\n  "issueNumber": 64,\n  "isValid": true,\n  "new_category": "logement",\n  "category_labels": ["conforme charte"],\n  "new_title": "",\n  "should_replace_label": false,\n  "reason": "Already has conforme charte label"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," ",(0,t.jsx)(n.code,{children:"success: true"})," means a change was made to the issue (label added/updated). ",(0,t.jsx)(n.code,{children:"success: false"})," means no change was made (already compliant or not assigned)."]}),"\n",(0,t.jsx)(n.h2,{id:"app-integration",children:"App Integration"}),"\n",(0,t.jsxs)(n.p,{children:["The webhook is called from ",(0,t.jsx)(n.code,{children:"app/front.py"})," in ",(0,t.jsx)(n.code,{children:"_validate_with_forseti()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# After ForsetiAgent validates successfully\nif result.is_valid and issue_id:\n    requests.post(\n        N8N_CHARTER_VALID_WEBHOOK,\n        json={\n            "issueNumber": issue_id,\n            "is_valid": result.is_valid,\n            "category": result.category,\n            "confidence": result.confidence,\n        },\n        timeout=10,\n    )\n'})}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.h3,{id:"test-from-curl-simulating-app-call",children:"Test from curl (simulating app call)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://vaettir.locki.io/webhook/forseti/charter-valid" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"issueNumber": 64, "is_valid": true, "category": "logement", "confidence": 0.92}\'\n'})}),"\n",(0,t.jsx)(n.h3,{id:"test-with-invalid-should-not-add-label",children:"Test with invalid (should not add label)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://vaettir.locki.io/webhook/forseti/charter-valid" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"issueNumber": 64, "is_valid": false}\'\n'})}),"\n",(0,t.jsx)(n.h2,{id:"learnings--issues",children:"Learnings & Issues"}),"\n",(0,t.jsx)(n.h3,{id:"1-separation-of-concerns",children:"1. Separation of Concerns"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue:"})," Originally tried to do LLM validation in N8N, but it duplicated work already done in the app."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," KISS - N8N only handles the GitHub label action. Validation stays in the app where ForsetiAgent runs with proper Opik tracing."]}),"\n",(0,t.jsx)(n.h3,{id:"2-label-idempotency",children:"2. Label Idempotency"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue:"})," Adding a label that already exists causes no error, but we should track it."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," Check existing labels before adding and report whether label was actually added."]}),"\n",(0,t.jsx)(n.h3,{id:"3-opik-tracing",children:"3. Opik Tracing"}),"\n",(0,t.jsx)(n.p,{children:"All LLM validation traces stay in the app where Opik is configured. N8N only logs the label action."}),"\n",(0,t.jsx)(n.h2,{id:"n8n-setup-checklist",children:"N8N Setup Checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Configure GitHub credential (",(0,t.jsx)(n.code,{children:"audierne2026-github"}),") with scopes: ",(0,t.jsx)(n.code,{children:"repo"}),", ",(0,t.jsx)(n.code,{children:"issues:write"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Enable MCP access: Settings > Workflow > ",(0,t.jsx)(n.code,{children:"availableInMCP: true"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Activate workflow for production"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"OCapistaine App"})," must be running and calling this webhook after validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"GitHub credential"})," with ",(0,t.jsx)(n.code,{children:"repo"}),", ",(0,t.jsx)(n.code,{children:"issues:write"})," scopes"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/fr/docs/workflows/n8n-github-integration",children:"N8N GitHub Integration Design"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/fr/docs/agents/forseti/",children:"Forseti 461 Agent"})," - Charter validation agent"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/fr/docs/workflows/contribution-charter",children:"Contribution Charter"})," - Governance rules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/fr/docs/workflows/n8n_integrations/Participons-List-Issues",children:"List Issues Workflow"})," - Related workflow"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>r});var i=s(6540);const t={},l=i.createContext(t);function a(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);