"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[8108],{96(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"agents/forseti/ARCHITECTURE","title":"Forseti 461 Architecture","description":"Technical documentation for the Forseti 461 agent implementation.","source":"@site/docs/agents/forseti/ARCHITECTURE.md","sourceDirName":"agents/forseti","slug":"/agents/forseti/ARCHITECTURE","permalink":"/fr/docs/agents/forseti/ARCHITECTURE","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/agents/forseti/ARCHITECTURE.md","tags":[],"version":"current","frontMatter":{},"sidebar":"agentsSidebar","previous":{"title":"Forseti 461","permalink":"/fr/docs/agents/forseti/"},"next":{"title":"features_details","permalink":"/fr/docs/agents/forseti/features_details"}}');var i=t(4848),a=t(8453);const s={},o="Forseti 461 Architecture",l={},c=[{value:"Agents Directory Structure",id:"agents-directory-structure",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"Feature executions",id:"feature-executions",level:2},{value:"Data Flow",id:"data-flow",level:2},{value:"Pydantic Models",id:"pydantic-models",level:2},{value:"Core Models",id:"core-models",level:3},{value:"Anonymization Models",id:"anonymization-models",level:3},{value:"Batch Models",id:"batch-models",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"ProviderConfig",id:"providerconfig",level:3},{value:"Tracing",id:"tracing",level:2},{value:"Automatic Feature Tracing",id:"automatic-feature-tracing",level:3},{value:"Manual Tracing",id:"manual-tracing",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Testing",id:"testing",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"forseti-461-architecture",children:"Forseti 461 Architecture"})}),"\n",(0,i.jsx)(n.p,{children:"Technical documentation for the Forseti 461 agent implementation."}),"\n",(0,i.jsx)(n.h2,{id:"agents-directory-structure",children:"Agents Directory Structure"}),"\n",(0,i.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         FORSETI 461 AGENT                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                             \u2502\n\u2502  app/agents/forseti/                                                        \u2502\n\u2502  \u251c\u2500\u2500 __init__.py              Module exports                                \u2502\n\u2502  \u251c\u2500\u2500 agent.py                 ForsetiAgent class                            \u2502\n\u2502  \u251c\u2500\u2500 models.py                Pydantic models (ValidationResult, etc.)      \u2502\n\u2502  \u251c\u2500\u2500 prompts.py               Re-exports from app/prompts/                  \u2502\n\u2502  \u2514\u2500\u2500 features/                                                              \u2502\n\u2502      \u251c\u2500\u2500 __init__.py          Feature exports                               \u2502\n\u2502      \u251c\u2500\u2500 base.py              FeatureBase abstract class                    \u2502\n\u2502      \u251c\u2500\u2500 charter_validation.py                                              \u2502\n\u2502      \u251c\u2500\u2500 category_classification.py                                         \u2502\n\u2502      \u251c\u2500\u2500 wording_correction.py                                              \u2502\n\u2502      \u251c\u2500\u2500 anonymization.py     LLM-based PII anonymization                  \u2502\n\u2502      \u2514\u2500\u2500 translation.py       FR\u2192EN translation (available, not integrated) \u2502\n\u2502                                                                             \u2502\n\u2502  app/prompts/                                                               \u2502\n\u2502  \u251c\u2500\u2500 local/forseti.py         Python prompts (fallback)                     \u2502\n\u2502  \u2514\u2500\u2500 local/forseti_charter.json   Opik-synced prompts (chat format)         \u2502\n\u2502                                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,i.jsxs)(n.p,{children:["Prompts (System+User) matching concept\n",(0,i.jsx)(n.a,{href:"/fr/docs/app/core/prompts",children:"prompts"})]}),"\n",(0,i.jsx)(n.h2,{id:"feature-executions",children:"Feature executions"}),"\n",(0,i.jsxs)(n.p,{children:["Features are registered with agents and executed independently:\n",(0,i.jsx)(n.a,{href:"/fr/docs/agents/forseti/features_details",children:"features details"})]}),"\n",(0,i.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                  \u2502   REST API      \u2502\n                                  \u2502 /api/v1/validate\u2502\n                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                           \u2502\n                                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      ForsetiAgent                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  Persona    \u2502  \u2502  Features   \u2502  \u2502      Provider       \u2502  \u2502\n\u2502  \u2502  Prompt     \u2502  \u2502             \u2502  \u2502  (Gemini/Claude/...)\u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                   \u2502 \u2502Charter  \u2502 \u2502                           \u2502\n\u2502                   \u2502 \u2502Validation\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502                   \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502          \u2502                \u2502\n\u2502                   \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502          \u25bc                \u2502\n\u2502                   \u2502 \u2502Category \u2502 \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502                   \u2502 \u2502Classify \u2502\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  LLM     \u2502           \u2502\n\u2502                   \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502    \u2502 Provider \u2502           \u2502\n\u2502                   \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                   \u2502 \u2502Wording  \u2502 \u2502          \u2502                \u2502\n\u2502                   \u2502 \u2502Correct  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                   \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                           \u2502\n\u2502                   \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                           \u2502\n\u2502                   \u2502 \u2502Anonymize\u2502 \u2502  (standalone, not auto-   \u2502\n\u2502                   \u2502 \u2502  (PII)  \u2502 \u2502   registered)             \u2502\n\u2502                   \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                           \u2502\n\u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                           \u2502\n                                           \u25bc\n                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                  \u2502  AgentTracer    \u2502\n                                  \u2502    (Opik)       \u2502\n                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pydantic-models",children:"Pydantic Models"}),"\n",(0,i.jsx)(n.h3,{id:"core-models",children:"Core Models"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ValidationResult(BaseModel):\n    is_valid: bool\n    violations: list[str]\n    encouraged_aspects: list[str]\n    reasoning: str\n    confidence: float  # 0.0 - 1.0\n\nclass ClassificationResult(BaseModel):\n    category: str  # One of CATEGORIES\n    reasoning: str\n    confidence: float\n\nclass FullValidationResult(BaseModel):\n    is_valid: bool\n    category: str\n    original_category: str | None\n    violations: list[str]\n    encouraged_aspects: list[str]\n    reasoning: str\n    confidence: float\n"})}),"\n",(0,i.jsx)(n.h3,{id:"anonymization-models",children:"Anonymization Models"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class EntityType(str, Enum):\n    PERSON = "PERSONNE"\n    EMAIL = "EMAIL"\n    PHONE = "TELEPHONE"\n    ADDRESS = "ADRESSE"\n\nclass DetectedEntity(BaseModel):\n    original: str\n    placeholder: str\n    entity_type: EntityType\n\nclass AnonymizationResult(BaseModel):\n    anonymized_text: str\n    entities: list[DetectedEntity]\n    entity_mapping: dict[str, str]\n    keywords_extracted: list[str]\n    reasoning: str\n'})}),"\n",(0,i.jsx)(n.h3,{id:"batch-models",children:"Batch Models"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class BatchItem(BaseModel):\n    id: str\n    title: str\n    body: str\n    category: str | None\n\nclass BatchResult(BaseModel):\n    id: str\n    is_valid: bool\n    violations: list[str]\n    encouraged_aspects: list[str]\n    category: str\n    reasoning: str\n    confidence: float\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Provider selection\nDEFAULT_PROVIDER=gemini  # gemini | claude | mistral | ollama\n\n# Gemini\nGOOGLE_API_KEY=...\nGEMINI_MODEL=gemini-1.5-flash\nGEMINI_RATE_LIMIT=12.0  # seconds between calls\n\n# Claude\nANTHROPIC_API_KEY=...\nCLAUDE_MODEL=claude-3-haiku-20240307\n\n# Mistral\nMISTRAL_API_KEY=...\nMISTRAL_MODEL=mistral-small-latest\n\n# Ollama\nOLLAMA_HOST=http://localhost:11434\nOLLAMA_MODEL=mistral:latest\n\n# Tracing\nOPIK_API_KEY=...\nOPIK_WORKSPACE=...\nOPIK_PROJECT=forseti\n"})}),"\n",(0,i.jsx)(n.h3,{id:"providerconfig",children:"ProviderConfig"}),"\n",(0,i.jsx)(n.p,{children:"Configuration is managed via pydantic-settings:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from app.providers.config import get_config\n\nconfig = get_config()\nprint(config.default_provider)  # "gemini"\nprint(config.gemini_model)      # "gemini-1.5-flash"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"tracing",children:"Tracing"}),"\n",(0,i.jsx)(n.h3,{id:"automatic-feature-tracing",children:"Automatic Feature Tracing"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"@trace_feature"})," decorator:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from app.agents.tracing import trace_feature\n\nclass MyFeature(FeatureBase):\n    @trace_feature("my_feature")\n    async def execute(self, provider, system_prompt, **kwargs):\n        # Automatically traced\n        return result\n'})}),"\n",(0,i.jsx)(n.h3,{id:"manual-tracing",children:"Manual Tracing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from app.agents.tracing import get_tracer\n\ntracer = get_tracer()\ntracer.trace(\n    name="custom_operation",\n    input={"title": "..."},\n    output={"is_valid": True},\n    metadata={"confidence": 0.95},\n    tags=["forseti", "custom"],\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"Features fail gracefully with safe defaults:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Charter validation: fail open (allow content through)\nexcept Exception as e:\n    return ValidationResult(\n        is_valid=True,  # Fail open\n        violations=[],\n        reasoning=f"Validation error: {e}",\n        confidence=0.5,\n    )\n\n# Category classification: use default category\nexcept Exception as e:\n    return ClassificationResult(\n        category=current_category or CATEGORIES[0],  # Default to first\n        reasoning=f"Classification error: {e}",\n        confidence=0.5,\n    )\n'})}),"\n",(0,i.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run all tests\npoetry run pytest tests/test_providers/ tests/test_agents/\n\n# Test specific provider\npoetry run pytest tests/test_providers/test_gemini.py\n\n# Test Forseti agent\npoetry run pytest tests/test_agents/test_forseti.py\n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>s,x:()=>o});var r=t(6540);const i={},a=r.createContext(i);function s(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);