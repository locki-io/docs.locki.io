"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[7338],{8453(e,n,i){i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},8639(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"app/MOCKUP","title":"Mockup System - Contribution Testing Framework","description":"Overview","source":"@site/docs/app/MOCKUP.md","sourceDirName":"app","slug":"/app/MOCKUP","permalink":"/fr/docs/app/MOCKUP","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/app/MOCKUP.md","tags":[],"version":"current","frontMatter":{}}');var r=i(4848),s=i(8453);const o={},a="Mockup System - Contribution Testing Framework",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Why Mutation Testing?",id:"why-mutation-testing",level:2},{value:"Contribution Format (Framaforms)",id:"contribution-format-framaforms",level:2},{value:"Levenshtein-Based Mutations",id:"levenshtein-based-mutations",level:2},{value:"Mutation Types",id:"mutation-types",level:3},{value:"Violation Categories",id:"violation-categories",level:3},{value:"JSON Input Format",id:"json-input-format",level:2},{value:"Base Contributions (<code>contributions.json</code>)",id:"base-contributions-contributionsjson",level:3},{value:"AI-Generated Contributions",id:"ai-generated-contributions",level:3},{value:"Storage Architecture",id:"storage-architecture",level:2},{value:"Redis Keys",id:"redis-keys",level:3},{value:"Data Structure",id:"data-structure",level:3},{value:"Opik Integration",id:"opik-integration",level:2},{value:"Dataset Format",id:"dataset-format",level:3},{value:"Optimization Workflow",id:"optimization-workflow",level:3},{value:"Supported Optimizers",id:"supported-optimizers",level:3},{value:"Usage",id:"usage",level:2},{value:"Streamlit UI",id:"streamlit-ui",level:3},{value:"Programmatic API",id:"programmatic-api",level:3},{value:"Metrics",id:"metrics",level:2},{value:"Accuracy Metrics",id:"accuracy-metrics",level:3},{value:"Key Goal",id:"key-goal",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"File Structure",id:"file-structure",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mockup-system---contribution-testing-framework",children:"Mockup System - Contribution Testing Framework"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The mockup system generates controlled variations of citizen contributions to systematically test and improve Forseti 461's charter validation. By creating progressive mutations from valid to invalid contributions, we can:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Identify prompt weaknesses"})," - Find cases where violations slip through"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Measure consistency"})," - Ensure similar inputs produce similar outputs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build training datasets"})," - Create Opik-compatible datasets for prompt optimization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Track accuracy over time"})," - Compare validation results across prompt iterations"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"why-mutation-testing",children:"Why Mutation Testing?"}),"\n",(0,r.jsx)(n.p,{children:"Charter validation is a nuanced task. A contribution might be:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Clearly valid (constructive, local, factual)"}),"\n",(0,r.jsx)(n.li,{children:"Clearly invalid (personal attack, spam, off-topic)"}),"\n",(0,r.jsx)(n.li,{children:"Borderline (subtle violations, mixed content)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"The challenge"}),": LLM-based validation can miss subtle violations or flag valid content incorrectly."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"The solution"}),": Generate controlled mutations with known expected outcomes, then measure how well Forseti detects them."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Valid Contribution \u2500\u2500\u252c\u2500\u2500 Small mutation (95% similar) \u2192 Should still be valid\n                     \u251c\u2500\u2500 Medium mutation (80% similar) \u2192 Borderline\n                     \u251c\u2500\u2500 Large mutation (60% similar) \u2192 Likely invalid\n                     \u2514\u2500\u2500 Violation injected \u2192 Must be detected as invalid\n"})}),"\n",(0,r.jsx)(n.h2,{id:"contribution-format-framaforms",children:"Contribution Format (Framaforms)"}),"\n",(0,r.jsx)(n.p,{children:"All mockup contributions follow the Audierne2026 Framaforms submission format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "unique-contribution-id",\n  "category": "economie",\n  "constat_factuel": "Le parking du port est souvent plein en \xe9t\xe9...",\n  "idees_ameliorations": "Cr\xe9er un parking relais \xe0 l\'entr\xe9e de la ville...",\n  "source": "framaforms",\n  "expected_valid": true\n}\n'})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"category"})}),(0,r.jsx)(n.td,{children:"One of 7 categories: economie, logement, culture, ecologie, associations, jeunesse, alimentation-bien-etre-soins"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"constat_factuel"})}),(0,r.jsx)(n.td,{children:"Factual observation about the current situation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"idees_ameliorations"})}),(0,r.jsx)(n.td,{children:"Proposed improvements or solutions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"source"})}),(0,r.jsxs)(n.td,{children:["Origin: ",(0,r.jsx)(n.code,{children:"framaforms"})," (real), ",(0,r.jsx)(n.code,{children:"mock"})," (synthetic), ",(0,r.jsx)(n.code,{children:"derived"})," (mutated), ",(0,r.jsx)(n.code,{children:"input"})," (manual)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"expected_valid"})}),(0,r.jsx)(n.td,{children:"Ground truth for testing (null if unknown)"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"levenshtein-based-mutations",children:"Levenshtein-Based Mutations"}),"\n",(0,r.jsxs)(n.p,{children:["We use ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Levenshtein_distance",children:"Levenshtein distance"})," to create controlled text variations:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.mockup import levenshtein_ratio, apply_distance\n\noriginal = "Le port d\'Audierne est magnifique"\nmutated = apply_distance(original, target_ratio=0.8)  # 80% similarity\n# Result: "Le port d\'Audierne est magifique" (typo introduced)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"mutation-types",children:"Mutation Types"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Character-level mutations"})," - Typos, missing letters, swapped characters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Word-level mutations"})," - Synonym replacement, word removal"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Violation injection"})," - Insert charter-violating content"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"violation-categories",children:"Violation Categories"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'VIOLATION_PATTERNS = {\n    "personal_attack": [\n        "Le maire est incomp\xe9tent",\n        "Cette personne ne comprend rien",\n    ],\n    "off_topic": [\n        "D\'ailleurs, parlons de la politique nationale",\n        "Sans rapport avec Audierne, mais...",\n    ],\n    "non_constructive": [\n        "C\'est nul, point final",\n        "Rien ne marchera jamais ici",\n    ],\n    "aggressive": [\n        "Bande d\'incapables !",\n        "Vous \xeates tous corrompus",\n    ],\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"json-input-format",children:"JSON Input Format"}),"\n",(0,r.jsxs)(n.h3,{id:"base-contributions-contributionsjson",children:["Base Contributions (",(0,r.jsx)(n.code,{children:"contributions.json"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Located at ",(0,r.jsx)(n.code,{children:"app/mockup/data/contributions.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "contributions": [\n    {\n      "id": "framaforms-eco-001",\n      "category": "economie",\n      "constat_factuel": "Les commerces du centre-ville souffrent...",\n      "idees_ameliorations": "Je propose de cr\xe9er un programme...",\n      "source": "framaforms",\n      "expected_valid": true\n    },\n    {\n      "id": "mock-invalid-001",\n      "category": "culture",\n      "constat_factuel": "Le maire est un idiot qui ne fait rien.",\n      "idees_ameliorations": "Il faut le virer imm\xe9diatement.",\n      "source": "mock",\n      "expected_valid": false,\n      "violations_injected": ["personal_attack", "aggressive"]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"ai-generated-contributions",children:"AI-Generated Contributions"}),"\n",(0,r.jsx)(n.p,{children:"Use an LLM to generate realistic contributions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'prompt = """\nGenerate 5 citizen contributions for Audierne in JSON format.\nMix valid and invalid examples. Include:\n- 3 valid, constructive proposals\n- 1 with subtle off-topic content\n- 1 with mild personal criticism\n\nFormat:\n{\n  "contributions": [\n    {\n      "category": "economie|logement|culture|ecologie|associations|jeunesse|alimentation-bien-etre-soins",\n      "constat_factuel": "Factual observation about current situation",\n      "idees_ameliorations": "Proposed improvements",\n      "expected_valid": true|false,\n      "violations_injected": ["type"] // if invalid\n    }\n  ]\n}\n"""\n'})}),"\n",(0,r.jsx)(n.h2,{id:"storage-architecture",children:"Storage Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"redis-keys",children:"Redis Keys"}),"\n",(0,r.jsx)(n.p,{children:"Validation results are stored in Redis for historical analysis:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"contribution_mockup:forseti461:charter:{date}:{id}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"contribution_mockup:forseti461:charter:2026-01-26:framaforms-eco-001\n"})}),"\n",(0,r.jsx)(n.h3,{id:"data-structure",children:"Data Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "framaforms-eco-001",\n  "date": "2026-01-26",\n  "title": "Generated from constat_factuel",\n  "body": "Combined constat + idees",\n  "category": "economie",\n  "constat_factuel": "...",\n  "idees_ameliorations": "...",\n\n  "is_valid": true,\n  "violations": [],\n  "encouraged_aspects": ["Proposition concr\xe8te"],\n  "confidence": 0.92,\n  "reasoning": "...",\n\n  "source": "framaforms",\n  "expected_valid": true,\n  "execution_time_ms": 1250,\n  "trace_id": "opik-trace-abc"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"opik-integration",children:"Opik Integration"}),"\n",(0,r.jsx)(n.h3,{id:"dataset-format",children:"Dataset Format"}),"\n",(0,r.jsx)(n.p,{children:"Validation records export to Opik-compatible format for prompt optimization:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "input": {\n    "title": "...",\n    "body": "...",\n    "category": "economie",\n    "constat_factuel": "...",\n    "idees_ameliorations": "..."\n  },\n  "expected_output": {\n    "is_valid": true,\n    "violations": [],\n    "encouraged_aspects": ["..."],\n    "confidence": 0.92,\n    "reasoning": "...",\n    "category": "economie"\n  },\n  "metadata": {\n    "id": "...",\n    "date": "2026-01-26",\n    "source": "framaforms",\n    "expected_valid": true,\n    "violations_injected": []\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"optimization-workflow",children:"Optimization Workflow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Generate/load contributions\n        \u2193\n2. Run batch validation with Forseti\n        \u2193\n3. Store results in Redis\n        \u2193\n4. Export to Opik dataset\n        \u2193\n5. Create train/val/test split\n        \u2193\n6. Run Opik optimizer\n        \u2193\n7. Update Forseti prompts\n        \u2193\n8. Repeat with new test set\n"})}),"\n",(0,r.jsx)(n.h3,{id:"supported-optimizers",children:"Supported Optimizers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FewShotBayesianOptimizer"})," - Selects best examples for few-shot prompts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MetaPromptOptimizer"})," - Uses LLM to generate/refine prompts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MiproOptimizer"})," - DSPy-based optimization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"EvolutionaryOptimizer"})," - Genetic algorithm for prompt evolution"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"streamlit-ui",children:"Streamlit UI"}),"\n",(0,r.jsxs)(n.p,{children:["Access via the ",(0,r.jsx)(n.strong,{children:"Mockup"})," tab (",(0,r.jsx)(n.code,{children:"?tab=mockup"}),"):"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Load Existing"})," - Load contributions from JSON file"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generate Variations"})," - Create Levenshtein mutations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single Contribution"})," - Test one contribution manually"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Storage & Opik"})," - View statistics, export datasets"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"programmatic-api",children:"Programmatic API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.mockup import (\n    load_contributions,\n    generate_variations,\n    get_storage,\n    get_dataset_manager,\n)\n\n# Load base contributions\ngenerator = load_contributions()\n\n# Generate variations with violations\nvariations = generate_variations(\n    constat_factuel="Le port est souvent satur\xe9...",\n    idees_ameliorations="Cr\xe9er un parking relais...",\n    category="economie",\n    num_variations=5,\n    include_violations=True,\n)\n\n# After validation, export to Opik\nmanager = get_dataset_manager()\nmanager.create_charter_dataset("forseti-charter-v2")\nmanager.add_from_redis(date_str="2026-01-26")\nmanager.sync_to_opik()\n'})}),"\n",(0,r.jsx)(n.h2,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsx)(n.h3,{id:"accuracy-metrics",children:"Accuracy Metrics"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metric"}),(0,r.jsx)(n.th,{children:"Formula"}),(0,r.jsx)(n.th,{children:"Target"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Precision"})}),(0,r.jsx)(n.td,{children:"TP / (TP + FP)"}),(0,r.jsx)(n.td,{children:"> 95%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Recall"})}),(0,r.jsx)(n.td,{children:"TP / (TP + FN)"}),(0,r.jsx)(n.td,{children:"> 98%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"F1 Score"})}),(0,r.jsx)(n.td,{children:"2 _ (P _ R) / (P + R)"}),(0,r.jsx)(n.td,{children:"> 96%"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Where:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TP"})," = Invalid contribution correctly rejected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FP"})," = Valid contribution incorrectly rejected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FN"})," = Invalid contribution incorrectly accepted (most dangerous)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"key-goal",children:"Key Goal"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Minimize False Negatives"}),": A missed charter violation reaching the platform is worse than incorrectly flagging a valid contribution (which can be manually reviewed)."]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Diverse test sets"})," - Include all 7 categories and violation types"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Progressive difficulty"})," - Test from obvious to subtle violations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Real data baseline"})," - Include actual Framaforms submissions when available"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Regular re-testing"})," - Run tests after any prompt changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Track over time"})," - Compare accuracy across prompt versions"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"app/mockup/\n\u251c\u2500\u2500 __init__.py           # Module exports\n\u251c\u2500\u2500 generator.py          # MockContribution, ContributionGenerator\n\u251c\u2500\u2500 levenshtein.py        # Distance calculations, mutations\n\u251c\u2500\u2500 storage.py            # Redis storage, ValidationRecord\n\u251c\u2500\u2500 dataset.py            # Opik dataset management\n\u251c\u2500\u2500 batch_view.py         # Streamlit UI\n\u2514\u2500\u2500 data/\n    \u2514\u2500\u2500 contributions.json  # Base test contributions\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);