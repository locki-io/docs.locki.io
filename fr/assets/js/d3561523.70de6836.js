"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[7338],{8453(e,n,i){i.d(n,{R:()=>o,x:()=>l});var t=i(6540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},8639(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"app/MOCKUP","title":"Mockup System - Contribution Testing Framework","description":"Overview","source":"@site/docs/app/MOCKUP.md","sourceDirName":"app","slug":"/app/MOCKUP","permalink":"/fr/docs/app/MOCKUP","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/app/MOCKUP.md","tags":[],"version":"current","frontMatter":{},"sidebar":"appSidebar","previous":{"title":"Auto-Contribution Workflow","permalink":"/fr/docs/app/AUTO_CONTRIBUTIONS"},"next":{"title":"Prompt Management Architecture","permalink":"/fr/docs/app/PROMPT_MANAGEMENT"}}');var r=i(4848),s=i(8453);const o={},l="Mockup System - Contribution Testing Framework",a={},c=[{value:"Overview",id:"overview",level:2},{value:"Why Mutation Testing?",id:"why-mutation-testing",level:2},{value:"Contribution Format (Framaforms)",id:"contribution-format-framaforms",level:2},{value:"Source Types",id:"source-types",level:3},{value:"Mutation Strategies",id:"mutation-strategies",level:2},{value:"1. Text-Based Mutations (Levenshtein)",id:"1-text-based-mutations-levenshtein",level:3},{value:"2. LLM-Based Mutations (Ollama/Mistral)",id:"2-llm-based-mutations-ollamamistral",level:3},{value:"Choosing a Strategy",id:"choosing-a-strategy",level:3},{value:"Combined Approach",id:"combined-approach",level:3},{value:"Violation Categories",id:"violation-categories",level:3},{value:"JSON Input Format",id:"json-input-format",level:2},{value:"Base Contributions (<code>contributions.json</code>)",id:"base-contributions-contributionsjson",level:3},{value:"AI-Generated Contributions",id:"ai-generated-contributions",level:3},{value:"Storage Architecture",id:"storage-architecture",level:2},{value:"Storage Priority",id:"storage-priority",level:3},{value:"Redis Keys",id:"redis-keys",level:3},{value:"Data Structure",id:"data-structure",level:3},{value:"Opik Integration",id:"opik-integration",level:2},{value:"Dataset Format",id:"dataset-format",level:3},{value:"Optimization Workflow",id:"optimization-workflow",level:3},{value:"Daily Experiments",id:"daily-experiments",level:2},{value:"Custom Metrics",id:"custom-metrics",level:3},{value:"Confusion Matrix",id:"confusion-matrix",level:3},{value:"Supported Optimizers",id:"supported-optimizers",level:3},{value:"Usage",id:"usage",level:2},{value:"Streamlit UI",id:"streamlit-ui",level:3},{value:"Auto-Contribution Tab - Contribution Assistant",id:"auto-contribution-tab---contribution-assistant",level:3},{value:"Field Input Workflow",id:"field-input-workflow",level:3},{value:"Programmatic API",id:"programmatic-api",level:3},{value:"Metrics",id:"metrics",level:2},{value:"Accuracy Metrics",id:"accuracy-metrics",level:3},{value:"Key Goal",id:"key-goal",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"File Structure",id:"file-structure",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mockup-system---contribution-testing-framework",children:"Mockup System - Contribution Testing Framework"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The mockup system generates controlled variations of citizen contributions to systematically test and improve Forseti 461's charter validation. By creating progressive mutations from valid to invalid contributions, we can:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Identify prompt weaknesses"})," - Find cases where violations slip through"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Measure consistency"})," - Ensure similar inputs produce similar outputs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build training datasets"})," - Create Opik-compatible datasets for prompt optimization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Track accuracy over time"})," - Compare validation results across prompt iterations"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"why-mutation-testing",children:"Why Mutation Testing?"}),"\n",(0,r.jsx)(n.p,{children:"Charter validation is a nuanced task. A contribution might be:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Clearly valid (constructive, local, factual)"}),"\n",(0,r.jsx)(n.li,{children:"Clearly invalid (personal attack, spam, off-topic)"}),"\n",(0,r.jsx)(n.li,{children:"Borderline (subtle violations, mixed content)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"The challenge"}),": LLM-based validation can miss subtle violations or flag valid content incorrectly."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"The solution"}),": Generate controlled mutations with known expected outcomes, then measure how well Forseti detects them."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Valid Contribution \u2500\u2500\u252c\u2500\u2500 Small mutation (95% similar) \u2192 Should still be valid\n                     \u251c\u2500\u2500 Medium mutation (80% similar) \u2192 Borderline\n                     \u251c\u2500\u2500 Large mutation (60% similar) \u2192 Likely invalid\n                     \u2514\u2500\u2500 Violation injected \u2192 Must be detected as invalid\n"})}),"\n",(0,r.jsx)(n.h2,{id:"contribution-format-framaforms",children:"Contribution Format (Framaforms)"}),"\n",(0,r.jsx)(n.p,{children:"All mockup contributions follow the Audierne2026 Framaforms submission format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "unique-contribution-id",\n  "category": "economie",\n  "constat_factuel": "Le parking du port est souvent plein en \xe9t\xe9...",\n  "idees_ameliorations": "Cr\xe9er un parking relais \xe0 l\'entr\xe9e de la ville...",\n  "source": "framaforms",\n  "expected_valid": true\n}\n'})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"category"})}),(0,r.jsx)(n.td,{children:"One of 7 categories: economie, logement, culture, ecologie, associations, jeunesse, alimentation-bien-etre-soins"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"constat_factuel"})}),(0,r.jsx)(n.td,{children:"Factual observation about the current situation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"idees_ameliorations"})}),(0,r.jsx)(n.td,{children:"Proposed improvements or solutions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"source"})}),(0,r.jsxs)(n.td,{children:["Origin: ",(0,r.jsx)(n.code,{children:"framaforms"})," (real), ",(0,r.jsx)(n.code,{children:"mock"})," (synthetic), ",(0,r.jsx)(n.code,{children:"derived"})," (mutated), ",(0,r.jsx)(n.code,{children:"input"})," (Auto-Contribution tab)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"expected_valid"})}),(0,r.jsx)(n.td,{children:"Ground truth for testing (null if unknown)"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"source-types",children:"Source Types"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Source"}),(0,r.jsx)(n.th,{children:"Origin"}),(0,r.jsx)(n.th,{children:"Forseti Validated"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"framaforms"})}),(0,r.jsx)(n.td,{children:"Real citizen submissions"}),(0,r.jsx)(n.td,{children:"On demand"}),(0,r.jsx)(n.td,{children:"Ground truth baseline"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mock"})}),(0,r.jsx)(n.td,{children:"Manually created test data"}),(0,r.jsx)(n.td,{children:"On demand"}),(0,r.jsx)(n.td,{children:"Known violation patterns"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"derived"})}),(0,r.jsx)(n.td,{children:"LLM-mutated from base"}),(0,r.jsx)(n.td,{children:"On demand"}),(0,r.jsx)(n.td,{children:"Variation testing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"input"})}),(0,r.jsx)(n.td,{children:"Questions tab (user-created)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Pre-save"})}),(0,r.jsx)(n.td,{children:"Real user contributions"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"input"})," source is unique: contributions are ",(0,r.jsx)(n.strong,{children:"validated by Forseti 461 before saving"}),", ensuring all user-created contributions have validation metadata attached."]}),"\n",(0,r.jsx)(n.h2,{id:"mutation-strategies",children:"Mutation Strategies"}),"\n",(0,r.jsx)(n.p,{children:"The mockup system supports two mutation strategies:"}),"\n",(0,r.jsx)(n.h3,{id:"1-text-based-mutations-levenshtein",children:"1. Text-Based Mutations (Levenshtein)"}),"\n",(0,r.jsxs)(n.p,{children:["Uses ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Levenshtein_distance",children:"Levenshtein distance"})," for controlled character-level variations:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.mockup import levenshtein_ratio, apply_distance\n\noriginal = "Le port d\'Audierne est magnifique"\nmutated, distance = apply_distance(original, target_distance=5)\n# Result: "Le port d\'Audirne est magnifque" (typos introduced)\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Best for:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Simulating typing errors"}),"\n",(0,r.jsx)(n.li,{children:"Testing OCR-like corruption"}),"\n",(0,r.jsx)(n.li,{children:"Fast, deterministic mutations"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-llm-based-mutations-ollamamistral",children:"2. LLM-Based Mutations (Ollama/Mistral)"}),"\n",(0,r.jsx)(n.p,{children:"Uses a local LLM to generate semantic variations:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.mockup import generate_variations\n\n# Generate variations using Mistral\nvariations = generate_variations(\n    constat_factuel="Le parking du port est souvent plein...",\n    idees_ameliorations="Cr\xe9er un parking relais...",\n    num_variations=5,\n    include_violations=True,\n    use_llm=True,  # Use Ollama/Mistral\n    llm_model="mistral:latest",\n)\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Mutation Types (LLM):"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Expected Valid"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"paraphrase"})}),(0,r.jsx)(n.td,{children:"Same meaning, different words"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"orthographic"})}),(0,r.jsx)(n.td,{children:"Realistic typos and errors"}),(0,r.jsx)(n.td,{children:"\u2705 Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"semantic_shift"})}),(0,r.jsx)(n.td,{children:"Slightly different meaning"}),(0,r.jsx)(n.td,{children:"\u26a0\ufe0f Borderline"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"subtle_violation"})}),(0,r.jsx)(n.td,{children:"Hidden charter violation"}),(0,r.jsx)(n.td,{children:"\u274c No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"aggressive"})}),(0,r.jsx)(n.td,{children:"Obvious violation (attacks, caps)"}),(0,r.jsx)(n.td,{children:"\u274c No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"off_topic"})}),(0,r.jsx)(n.td,{children:"Drifts to unrelated subjects"}),(0,r.jsx)(n.td,{children:"\u274c No"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ollama running locally (",(0,r.jsx)(n.code,{children:"ollama serve"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Mistral model pulled (",(0,r.jsx)(n.code,{children:"ollama pull mistral"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"choosing-a-strategy",children:"Choosing a Strategy"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Criterion"}),(0,r.jsx)(n.th,{children:"Text (Levenshtein)"}),(0,r.jsx)(n.th,{children:"LLM (Mistral)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Speed"}),(0,r.jsx)(n.td,{children:"Fast"}),(0,r.jsx)(n.td,{children:"Slower"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Realism"}),(0,r.jsx)(n.td,{children:"Low"}),(0,r.jsx)(n.td,{children:"High"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Semantic understanding"}),(0,r.jsx)(n.td,{children:"None"}),(0,r.jsx)(n.td,{children:"Full"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Requires GPU/Ollama"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Deterministic"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommendation:"})," Use LLM mutations for realistic testing, text mutations for quick iteration."]}),"\n",(0,r.jsx)(n.h3,{id:"combined-approach",children:"Combined Approach"}),"\n",(0,r.jsx)(n.p,{children:"For comprehensive testing, use both:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Quick text-based mutations for volume\ntext_variations = generate_variations(text, num_variations=20, use_llm=False)\n\n# High-quality LLM mutations for edge cases\nllm_variations = generate_variations(text, num_variations=5, use_llm=True)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"violation-categories",children:"Violation Categories"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'VIOLATION_PATTERNS = {\n    "personal_attack": [\n        "Le maire est incomp\xe9tent",\n        "Cette personne ne comprend rien",\n    ],\n    "off_topic": [\n        "D\'ailleurs, parlons de la politique nationale",\n        "Sans rapport avec Audierne, mais...",\n    ],\n    "non_constructive": [\n        "C\'est nul, point final",\n        "Rien ne marchera jamais ici",\n    ],\n    "aggressive": [\n        "Bande d\'incapables !",\n        "Vous \xeates tous corrompus",\n    ],\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"json-input-format",children:"JSON Input Format"}),"\n",(0,r.jsxs)(n.h3,{id:"base-contributions-contributionsjson",children:["Base Contributions (",(0,r.jsx)(n.code,{children:"contributions.json"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Located at ",(0,r.jsx)(n.code,{children:"app/mockup/data/contributions.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "contributions": [\n    {\n      "id": "framaforms-eco-001",\n      "category": "economie",\n      "constat_factuel": "Les commerces du centre-ville souffrent...",\n      "idees_ameliorations": "Je propose de cr\xe9er un programme...",\n      "source": "framaforms",\n      "expected_valid": true\n    },\n    {\n      "id": "mock-invalid-001",\n      "category": "culture",\n      "constat_factuel": "Le maire est un idiot qui ne fait rien.",\n      "idees_ameliorations": "Il faut le virer imm\xe9diatement.",\n      "source": "mock",\n      "expected_valid": false,\n      "violations_injected": ["personal_attack", "aggressive"]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"ai-generated-contributions",children:"AI-Generated Contributions"}),"\n",(0,r.jsx)(n.p,{children:"Use an LLM to generate realistic contributions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'prompt = """\nGenerate 5 citizen contributions for Audierne in JSON format.\nMix valid and invalid examples. Include:\n- 3 valid, constructive proposals\n- 1 with subtle off-topic content\n- 1 with mild personal criticism\n\nFormat:\n{\n  "contributions": [\n    {\n      "category": "economie|logement|culture|ecologie|associations|jeunesse|alimentation-bien-etre-soins",\n      "constat_factuel": "Factual observation about current situation",\n      "idees_ameliorations": "Proposed improvements",\n      "expected_valid": true|false,\n      "violations_injected": ["type"] // if invalid\n    }\n  ]\n}\n"""\n'})}),"\n",(0,r.jsx)(n.h2,{id:"storage-architecture",children:"Storage Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"storage-priority",children:"Storage Priority"}),"\n",(0,r.jsxs)(n.p,{children:["The system uses a ",(0,r.jsx)(n.strong,{children:"Redis-first"})," approach with JSON fallback:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Load Order:\n1. Redis storage (get_latest_validations) \u2190 Primary\n2. JSON file (contributions.json)         \u2190 Fallback if Redis empty\n"})}),"\n",(0,r.jsx)(n.p,{children:"This ensures:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User contributions from Questions tab are immediately visible"}),"\n",(0,r.jsx)(n.li,{children:"Field Input generated contributions are persisted"}),"\n",(0,r.jsx)(n.li,{children:"Local development works without Redis (JSON fallback)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"redis-keys",children:"Redis Keys"}),"\n",(0,r.jsx)(n.p,{children:"Validation results are stored in Redis for historical analysis:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"contribution_mockup:forseti461:charter:{date}:{id}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"contribution_mockup:forseti461:charter:2026-01-26:framaforms-eco-001\ncontribution_mockup:forseti461:charter:2026-01-29:input_abc123def456  \u2190 From Questions tab\n"})}),"\n",(0,r.jsx)(n.h3,{id:"data-structure",children:"Data Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "framaforms-eco-001",\n  "date": "2026-01-26",\n  "title": "Generated from constat_factuel",\n  "body": "Combined constat + idees",\n  "category": "economie",\n  "constat_factuel": "...",\n  "idees_ameliorations": "...",\n\n  "is_valid": true,\n  "violations": [],\n  "encouraged_aspects": ["Proposition concr\xe8te"],\n  "confidence": 0.92,\n  "reasoning": "...",\n\n  "source": "framaforms",\n  "expected_valid": true,\n  "execution_time_ms": 1250,\n  "trace_id": "opik-trace-abc"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"opik-integration",children:"Opik Integration"}),"\n",(0,r.jsx)(n.h3,{id:"dataset-format",children:"Dataset Format"}),"\n",(0,r.jsx)(n.p,{children:"Validation records export to Opik-compatible format for prompt optimization:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "input": {\n    "title": "...",\n    "body": "...",\n    "category": "economie",\n    "constat_factuel": "...",\n    "idees_ameliorations": "..."\n  },\n  "expected_output": {\n    "is_valid": true,\n    "violations": [],\n    "encouraged_aspects": ["..."],\n    "confidence": 0.92,\n    "reasoning": "...",\n    "category": "economie"\n  },\n  "metadata": {\n    "id": "...",\n    "date": "2026-01-26",\n    "source": "framaforms",\n    "expected_valid": true,\n    "violations_injected": []\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"optimization-workflow",children:"Optimization Workflow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Generate/load contributions\n        \u2193\n2. Run batch validation with Forseti\n        \u2193\n3. Store results in Redis\n        \u2193\n4. Export to Opik dataset\n        \u2193\n5. Create train/val/test split\n        \u2193\n6. Run daily Opik experiment (track metrics)\n        \u2193\n7. Run Opik optimizer\n        \u2193\n8. Update Forseti prompts\n        \u2193\n9. Repeat with new test set\n"})}),"\n",(0,r.jsx)(n.h2,{id:"daily-experiments",children:"Daily Experiments"}),"\n",(0,r.jsxs)(n.p,{children:["The mockup processor supports ",(0,r.jsx)(n.strong,{children:"Opik experiments"})," for tracking Forseti's performance over time:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.processors import MockupProcessor\n\nprocessor = MockupProcessor()\n\n# Run daily experiment\nresult = await processor.run_daily_experiment(\n    validate_func=forseti.validate,\n    source_filter=["framaforms", "mock"],\n)\n\nprint(f"Accuracy: {result.charter_accuracy:.1%}")\nprint(f"F1 Score: {result.f1_score:.2f}")\nprint(f"False Negatives: {result.false_negatives}")  # Missed violations!\n'})}),"\n",(0,r.jsx)(n.h3,{id:"custom-metrics",children:"Custom Metrics"}),"\n",(0,r.jsx)(n.p,{children:"Three charter-specific metrics are tracked:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metric"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Goal"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"charter_accuracy"})}),(0,r.jsx)(n.td,{children:"Match between Forseti result and expected"}),(0,r.jsx)(n.td,{children:"> 95%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"violation_detection"})}),(0,r.jsx)(n.td,{children:"Detecting injected violations"}),(0,r.jsx)(n.td,{children:"> 98%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"confidence_calibration"})}),(0,r.jsx)(n.td,{children:"High confidence = correct prediction"}),(0,r.jsx)(n.td,{children:"> 0.8"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"confusion-matrix",children:"Confusion Matrix"}),"\n",(0,r.jsx)(n.p,{children:"For charter validation, we track:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"True Positive (TP)"}),": Invalid contribution correctly rejected \u2705"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"True Negative (TN)"}),": Valid contribution correctly accepted \u2705"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"False Positive (FP)"}),": Valid contribution incorrectly rejected \u26a0\ufe0f"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"False Negative (FN)"}),": Invalid contribution incorrectly accepted \u274c (worst!)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key goal"}),": Minimize False Negatives - a missed charter violation reaching the platform is worse than incorrectly flagging a valid contribution."]}),"\n",(0,r.jsx)(n.h3,{id:"supported-optimizers",children:"Supported Optimizers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FewShotBayesianOptimizer"})," - Selects best examples for few-shot prompts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MetaPromptOptimizer"})," - Uses LLM to generate/refine prompts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MiproOptimizer"})," - DSPy-based optimization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"EvolutionaryOptimizer"})," - Genetic algorithm for prompt evolution"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"streamlit-ui",children:"Streamlit UI"}),"\n",(0,r.jsxs)(n.p,{children:["Access via the ",(0,r.jsx)(n.strong,{children:"Mockup"})," tab (",(0,r.jsx)(n.code,{children:"?tab=mockup"}),"):"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Load Existing"})," - Load contributions from Redis (fallback: JSON file)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generate Variations"})," - Create Levenshtein mutations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single Contribution"})," - Test one contribution manually"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Field Input"})," - Generate from reports/docs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Storage & Opik"})," - View statistics, export datasets"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"auto-contribution-tab---contribution-assistant",children:"Auto-Contribution Tab - Contribution Assistant"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Auto-Contribution"})," tab (",(0,r.jsx)(n.code,{children:"?tab=autocontrib"}),") provides a user-friendly 5-step workflow for citizens to create charter-compliant contributions:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\ud83d\udcda Source Selection \u2192 \ud83c\udff7\ufe0f Category \u2192 \u2728 AI Draft \u2192 \u270f\ufe0f Edit \u2192 \ud83d\udd0d Validate & Save\n       \u2193                   \u2193             \u2193           \u2193              \u2193\n  (Audierne docs     (7 categories)  (LLM generates  (User edits  (Forseti 461\n   or paste text)                     draft)          fields)      validates)\n                                                                       \u2193\n                                                              Store in Redis\n                                                              with validation results\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"5-Step Workflow:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Step"}),(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"1"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Source"})}),(0,r.jsx)(n.td,{children:"Select inspiration from Audierne2026 docs or paste custom text"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Category"})}),(0,r.jsx)(n.td,{children:"Choose one of 7 categories (economie, logement, culture, etc.)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"3"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Inspiration"})}),(0,r.jsxs)(n.td,{children:["AI generates draft ",(0,r.jsx)(n.code,{children:"constat_factuel"})," + ",(0,r.jsx)(n.code,{children:"idees_ameliorations"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"4"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Edit"})}),(0,r.jsx)(n.td,{children:"User modifies both fields in editable text areas"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"5"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Save"})}),(0,r.jsx)(n.td,{children:"Forseti 461 validates, then saves to Redis with results"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Features:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bilingual Support"})," - UI and AI drafts in French or English"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"AI-Assisted Drafting"})," - LLM generates contextual draft based on source document"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pre-Save Validation"})," - Forseti 461 validates before storing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Full Traceability"})," - Validation results (is_valid, violations, confidence) stored with contribution"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Storage Format:"})}),"\n",(0,r.jsxs)(n.p,{children:["Contributions from the Questions tab are stored with ",(0,r.jsx)(n.code,{children:'source: "input"'})," to distinguish them from mockup-generated data:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "input_abc123def456",\n  "source": "input",\n  "category": "economie",\n  "constat_factuel": "Le parking du port est souvent satur\xe9...",\n  "idees_ameliorations": "Cr\xe9er un parking relais \xe0 l\'entr\xe9e...",\n  "is_valid": true,\n  "violations": [],\n  "encouraged_aspects": ["Proposition concr\xe8te", "Ancrage local"],\n  "confidence": 0.92,\n  "reasoning": "Contribution constructive et locale...",\n  "provider": "gemini",\n  "model": "gemini-2.5-flash"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Integration with Mockup Tab:"})}),"\n",(0,r.jsx)(n.p,{children:'Contributions created via the Auto-Contribution tab appear in the Mockup tab\'s "Load Existing" view:'}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Mockup tab first loads from ",(0,r.jsx)(n.strong,{children:"Redis"})," storage"]}),"\n",(0,r.jsxs)(n.li,{children:["Falls back to ",(0,r.jsx)(n.strong,{children:"JSON file"})," if Redis is empty"]}),"\n",(0,r.jsxs)(n.li,{children:["Filter by ",(0,r.jsx)(n.code,{children:'source: "input"'})," to see user-created contributions"]}),"\n",(0,r.jsx)(n.li,{children:"Run batch validation or export to Opik datasets"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"field-input-workflow",children:"Field Input Workflow"}),"\n",(0,r.jsx)(n.p,{children:"Generate themed contributions from real municipal data:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\ud83d\udccb Field Input \u2192 \ud83d\udd0d Theme Extraction \u2192 \ud83c\udff7\ufe0f Category Assignment \u2192 \ud83d\udcdd Contribution Generation\n                       \u2193                       \u2193                        \u2193\n              (public hearing)         (7 categories)          (valid + violations)\n              (mayor speech)                                          \u2193\n              (municipal docs)                              Store in Redis/JSON\n                                                                      \u2193\n                                                            Run Opik Experiment\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Available Input Sources:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audierne2026 Docs"})," - Select from ",(0,r.jsx)(n.code,{children:"docs/docs/audierne2026/"})," markdown files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Paste Text"})," - Directly paste content from reports, speeches, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upload File"})," - Upload markdown or text files"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.mockup import process_field_input_sync\n\n# Process a public hearing report\nresult = process_field_input_sync(\n    input_text=open("rapport_audience.md").read(),\n    source_title="Audience publique - R\xe9novation \xc9cole",\n    contributions_per_theme=2,\n    include_violations=True,\n)\n\nprint(f"Extracted {result.themes_extracted} themes")\nprint(f"Generated {result.contributions_generated} contributions")\nprint(f"Categories: {result.categories_covered}")\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Daily Experiment Workflow:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Inject field data through UI (report, speech, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"LLM extracts themes across 7 categories"}),"\n",(0,r.jsx)(n.li,{children:"Generate contributions (valid + violations)"}),"\n",(0,r.jsx)(n.li,{children:"Save to Redis"}),"\n",(0,r.jsx)(n.li,{children:"Run Opik experiment with current Forseti prompt"}),"\n",(0,r.jsx)(n.li,{children:"Track accuracy over time"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"programmatic-api",children:"Programmatic API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.mockup import (\n    load_contributions,\n    generate_variations,\n    get_storage,\n    get_dataset_manager,\n)\n\n# Load base contributions\ngenerator = load_contributions()\n\n# Generate variations with violations\nvariations = generate_variations(\n    constat_factuel="Le port est souvent satur\xe9...",\n    idees_ameliorations="Cr\xe9er un parking relais...",\n    category="economie",\n    num_variations=5,\n    include_violations=True,\n)\n\n# After validation, export to Opik\nmanager = get_dataset_manager()\nmanager.create_charter_dataset("forseti-charter-v2")\nmanager.add_from_redis(date_str="2026-01-26")\nmanager.sync_to_opik()\n'})}),"\n",(0,r.jsx)(n.h2,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsx)(n.h3,{id:"accuracy-metrics",children:"Accuracy Metrics"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metric"}),(0,r.jsx)(n.th,{children:"Formula"}),(0,r.jsx)(n.th,{children:"Target"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Precision"})}),(0,r.jsx)(n.td,{children:"TP / (TP + FP)"}),(0,r.jsx)(n.td,{children:"> 95%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Recall"})}),(0,r.jsx)(n.td,{children:"TP / (TP + FN)"}),(0,r.jsx)(n.td,{children:"> 98%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"F1 Score"})}),(0,r.jsx)(n.td,{children:"2 _ (P _ R) / (P + R)"}),(0,r.jsx)(n.td,{children:"> 96%"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Where:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TP"})," = Invalid contribution correctly rejected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FP"})," = Valid contribution incorrectly rejected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FN"})," = Invalid contribution incorrectly accepted (most dangerous)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"key-goal",children:"Key Goal"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Minimize False Negatives"}),": A missed charter violation reaching the platform is worse than incorrectly flagging a valid contribution (which can be manually reviewed)."]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Diverse test sets"})," - Include all 7 categories and violation types"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Progressive difficulty"})," - Test from obvious to subtle violations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Real data baseline"})," - Include actual Framaforms submissions when available"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Regular re-testing"})," - Run tests after any prompt changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Track over time"})," - Compare accuracy across prompt versions"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"app/mockup/\n\u251c\u2500\u2500 __init__.py           # Module exports\n\u251c\u2500\u2500 generator.py          # MockContribution, ContributionGenerator\n\u251c\u2500\u2500 levenshtein.py        # Distance calculations, text mutations\n\u251c\u2500\u2500 llm_mutations.py      # LLM-based semantic mutations (Ollama)\n\u251c\u2500\u2500 field_input.py        # Field input processing (reports \u2192 contributions)\n\u251c\u2500\u2500 storage.py            # Redis storage, ValidationRecord\n\u251c\u2500\u2500 dataset.py            # Opik dataset management\n\u251c\u2500\u2500 batch_view.py         # Streamlit UI (5 modes)\n\u2514\u2500\u2500 data/\n    \u251c\u2500\u2500 contributions.json    # Generated test contributions (fallback)\n    \u2514\u2500\u2500 category_themes.json  # Category themes for field input\n\napp/auto_contribution/\n\u251c\u2500\u2500 __init__.py               # Module exports\n\u2514\u2500\u2500 views.py                  # 5-step Streamlit workflow UI\n\napp/processors/workflows/\n\u251c\u2500\u2500 __init__.py                       # Workflow exports\n\u2514\u2500\u2500 workflow_autocontribution.py      # Business logic (ContributionAssistant, 5 steps)\n\napp/translations/\n\u251c\u2500\u2500 fr.json                   # French translations (autocontrib_* keys)\n\u2514\u2500\u2500 en.json                   # English translations (autocontrib_* keys)\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);