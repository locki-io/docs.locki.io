"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[6915],{8453(e,t,n){n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},9609(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tests/testing-strategy","title":"OCapistaine Testing Strategy","description":"Overview","source":"@site/docs/tests/testing-strategy.md","sourceDirName":"tests","slug":"/tests/testing-strategy","permalink":"/fr/docs/tests/testing-strategy","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/tests/testing-strategy.md","tags":[],"version":"current","frontMatter":{}}');var i=n(4848),r=n(8453);const a={},o="OCapistaine Testing Strategy",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Testing Pyramid",id:"testing-pyramid",level:2},{value:"Test Categories",id:"test-categories",level:2},{value:"1. Unit Tests (Fast, Mocked)",id:"1-unit-tests-fast-mocked",level:3},{value:"2. Integration Tests (External Dependencies)",id:"2-integration-tests-external-dependencies",level:3},{value:"3. Opik Experiments (LLM Evaluation)",id:"3-opik-experiments-llm-evaluation",level:3},{value:"Directory Structure",id:"directory-structure",level:2},{value:"Shared Fixtures (<code>conftest.py</code>)",id:"shared-fixtures-conftestpy",level:2},{value:"N8N Integration Testing",id:"n8n-integration-testing",level:2},{value:"Approach: Mock HTTP, Not N8N",id:"approach-mock-http-not-n8n",level:3},{value:"Manual E2E Testing",id:"manual-e2e-testing",level:3},{value:"Forseti Feature Tests \u2192 Opik Experiments Mapping",id:"forseti-feature-tests--opik-experiments-mapping",level:2},{value:"Test Case Categories",id:"test-case-categories",level:3},{value:"From Tests to Opik Datasets",id:"from-tests-to-opik-datasets",level:3},{value:"Opik Experimentation Strategy",id:"opik-experimentation-strategy",level:2},{value:"Dataset Management",id:"dataset-management",level:3},{value:"Experiment Types",id:"experiment-types",level:3},{value:"1. Accuracy Experiments (Daily)",id:"1-accuracy-experiments-daily",level:4},{value:"2. Prompt Optimization (Weekly)",id:"2-prompt-optimization-weekly",level:4},{value:"3. Model Comparison (On-demand)",id:"3-model-comparison-on-demand",level:4},{value:"Dataset Splits",id:"dataset-splits",level:3},{value:"Running Tests",id:"running-tests",level:2},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"Opik Dashboard",id:"opik-dashboard",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"ocapistaine-testing-strategy",children:"OCapistaine Testing Strategy"})}),"\n",(0,i.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(t.p,{children:"This document outlines the testing strategy for OCapistaine, including unit tests, integration tests, and Opik-based experimentation for LLM optimization."}),"\n",(0,i.jsx)(t.h2,{id:"testing-pyramid",children:"Testing Pyramid"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   E2E Tests   \u2502  Manual / Opik Experiments\n                    \u2502   (few)       \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502  Integration Tests    \u2502  N8N webhooks, Redis, API\n                \u2502  (some)               \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502           Unit Tests                  \u2502  Agents, Models, Utils\n        \u2502           (many)                      \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(t.h2,{id:"test-categories",children:"Test Categories"}),"\n",(0,i.jsx)(t.h3,{id:"1-unit-tests-fast-mocked",children:"1. Unit Tests (Fast, Mocked)"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Module"}),(0,i.jsx)(t.th,{children:"Test File"}),(0,i.jsx)(t.th,{children:"Coverage"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ForsetiAgent"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_forseti_agent.py"})}),(0,i.jsx)(t.td,{children:"Validation logic, prompt generation"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ContributionAssistant"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_contribution_assistant.py"})}),(0,i.jsx)(t.td,{children:"Draft generation, categories"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ValidationRecord"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_validation_record.py"})}),(0,i.jsx)(t.td,{children:"Serialization, Opik format"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"LLM Mutations"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_llm_mutations.py"})}),(0,i.jsx)(t.td,{children:"Mutation strategies"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Principles:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Mock all external calls (LLM providers, Redis, HTTP)"}),"\n",(0,i.jsx)(t.li,{children:"Test business logic in isolation"}),"\n",(0,i.jsx)(t.li,{children:"Fast execution (< 1s per test)"}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"2-integration-tests-external-dependencies",children:"2. Integration Tests (External Dependencies)"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Integration"}),(0,i.jsx)(t.th,{children:"Test File"}),(0,i.jsx)(t.th,{children:"What it tests"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"N8N Webhooks"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_n8n_integration.py"})}),(0,i.jsx)(t.td,{children:"Webhook calls, response handling"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Redis Storage"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_redis_integration.py"})}),(0,i.jsx)(t.td,{children:"ValidationRecord persistence"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"GitHub API"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_github_integration.py"})}),(0,i.jsx)(t.td,{children:"Issue fetching (via N8N)"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Principles:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Use test fixtures and mocks where possible"}),"\n",(0,i.jsxs)(t.li,{children:["Mark with ",(0,i.jsx)(t.code,{children:"@pytest.mark.integration"})," for selective running"]}),"\n",(0,i.jsx)(t.li,{children:"Can be skipped in CI if external services unavailable"}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"3-opik-experiments-llm-evaluation",children:"3. Opik Experiments (LLM Evaluation)"}),"\n",(0,i.jsxs)(t.p,{children:["Not traditional tests - these are ",(0,i.jsx)(t.strong,{children:"evaluation runs"})," that measure LLM performance."]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Experiment"}),(0,i.jsx)(t.th,{children:"Purpose"}),(0,i.jsx)(t.th,{children:"Metrics"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Charter Accuracy"}),(0,i.jsx)(t.td,{children:"Validate Forseti decisions"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"CharterAccuracyMetric"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Violation Detection"}),(0,i.jsx)(t.td,{children:"Measure recall on violations"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ViolationDetectionMetric"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Confidence Calibration"}),(0,i.jsx)(t.td,{children:"Confidence vs actual accuracy"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ConfidenceCalibrationMetric"})})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"tests/\n\u251c\u2500\u2500 conftest.py                      # Shared fixtures\n\u251c\u2500\u2500 test_contribution_assistant.py   # Existing unit tests\n\u251c\u2500\u2500 test_autocontribution_integration.py  # Existing integration tests\n\u251c\u2500\u2500 unit/\n\u2502   \u251c\u2500\u2500 forseti/                     # Forseti feature tests \u2192 Opik experiments\n\u2502   \u2502   \u251c\u2500\u2500 test_charter_validation.py     \u2192 forseti-charter-accuracy\n\u2502   \u2502   \u251c\u2500\u2500 test_category_classification.py \u2192 forseti-category-accuracy\n\u2502   \u2502   \u2514\u2500\u2500 test_batch_validation.py       \u2192 forseti-batch-throughput\n\u2502   \u251c\u2500\u2500 test_validation_record.py\n\u2502   \u2514\u2500\u2500 test_llm_mutations.py\n\u251c\u2500\u2500 integration/\n\u2502   \u251c\u2500\u2500 test_n8n_integration.py      # N8N webhook tests\n\u2502   \u2514\u2500\u2500 test_redis_integration.py\n\u2514\u2500\u2500 experiments/\n    \u2514\u2500\u2500 test_opik_experiments.py     # Opik experiment runners\n"})}),"\n",(0,i.jsxs)(t.h2,{id:"shared-fixtures-conftestpy",children:["Shared Fixtures (",(0,i.jsx)(t.code,{children:"conftest.py"}),")"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'import pytest\nfrom unittest.mock import AsyncMock, MagicMock\n\n# === Mock Providers ===\n\n@pytest.fixture\ndef mock_llm_provider():\n    """Mock LLM provider that returns controlled responses."""\n    provider = MagicMock()\n    provider.generate = AsyncMock(return_value="mocked response")\n    return provider\n\n@pytest.fixture\ndef mock_forseti_response():\n    """Standard Forseti validation response."""\n    return {\n        "is_valid": True,\n        "category": "economie",\n        "violations": [],\n        "encouraged_aspects": ["Constructive proposal"],\n        "reasoning": "The contribution is constructive.",\n        "confidence": 0.85\n    }\n\n# === Mock External Services ===\n\n@pytest.fixture\ndef mock_n8n_response():\n    """Mock N8N webhook response."""\n    return [{\n        "success": True,\n        "issueNumber": 64,\n        "isValid": True,\n        "reason": "Label added"\n    }]\n\n@pytest.fixture\ndef mock_redis():\n    """Mock Redis client."""\n    redis = MagicMock()\n    redis.hset = MagicMock(return_value=True)\n    redis.hget = MagicMock(return_value=None)\n    redis.hgetall = MagicMock(return_value={})\n    return redis\n\n# === Sample Data ===\n\n@pytest.fixture\ndef sample_contribution():\n    """Sample contribution for testing."""\n    return {\n        "title": "[economie] Proposition pour le port",\n        "body": "Je propose d\'am\xe9liorer les infrastructures portuaires...",\n        "category": "economie"\n    }\n\n@pytest.fixture\ndef sample_validation_record():\n    """Sample ValidationRecord for testing."""\n    from app.mockup.storage import ValidationRecord\n    return ValidationRecord(\n        id="test-123",\n        constat_factuel="Le port n\xe9cessite des r\xe9novations",\n        idees_ameliorations="Moderniser les quais",\n        category="economie",\n        is_valid=True,\n        violations=[],\n        encouraged_aspects=["Proposition concr\xe8te"],\n        reasoning="Contribution constructive",\n        confidence=0.9,\n        source="test"\n    )\n'})}),"\n",(0,i.jsx)(t.h2,{id:"n8n-integration-testing",children:"N8N Integration Testing"}),"\n",(0,i.jsx)(t.h3,{id:"approach-mock-http-not-n8n",children:"Approach: Mock HTTP, Not N8N"}),"\n",(0,i.jsx)(t.p,{children:"We don't need a mockup GitHub repo. Instead:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'# tests/integration/test_n8n_integration.py\n\nimport pytest\nfrom unittest.mock import patch, MagicMock\n\nclass TestN8NCharterValidation:\n    """Test N8N charter validation webhook integration."""\n\n    @patch("requests.post")\n    def test_webhook_called_on_valid_contribution(self, mock_post, mock_n8n_response):\n        """N8N webhook is called when Forseti validates as compliant."""\n        mock_post.return_value = MagicMock(\n            ok=True,\n            json=lambda: mock_n8n_response\n        )\n\n        # Call the validation function\n        from app.front import _validate_with_forseti\n        # ... test implementation\n\n        mock_post.assert_called_once()\n        call_args = mock_post.call_args\n        assert call_args[1]["json"]["issueNumber"] == 64\n        assert call_args[1]["json"]["is_valid"] is True\n\n    @patch("requests.post")\n    def test_webhook_not_called_on_invalid(self, mock_post):\n        """N8N webhook is NOT called when validation fails."""\n        # Mock ForsetiAgent to return is_valid=False\n        # ... test implementation\n\n        mock_post.assert_not_called()\n\n    @patch("requests.post")\n    def test_handles_n8n_error_gracefully(self, mock_post):\n        """App continues working if N8N is unavailable."""\n        mock_post.side_effect = requests.RequestException("Connection refused")\n\n        # Should not raise, just log warning\n        # ... test implementation\n'})}),"\n",(0,i.jsx)(t.h3,{id:"manual-e2e-testing",children:"Manual E2E Testing"}),"\n",(0,i.jsx)(t.p,{children:"For full end-to-end testing with real N8N:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'# 1. Use N8N test mode\ncurl -X POST "https://vaettir.locki.io/webhook-test/forseti/charter-valid" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"issueNumber": 64, "is_valid": true, "category": "logement"}\'\n\n# 2. Use a dedicated test issue in real repo\n# Issue #999 labeled "test-issue" - safe to modify\n'})}),"\n",(0,i.jsx)(t.h2,{id:"forseti-feature-tests--opik-experiments-mapping",children:"Forseti Feature Tests \u2192 Opik Experiments Mapping"}),"\n",(0,i.jsx)(t.p,{children:"Each Forseti feature has dedicated unit tests that map directly to Opik experiments:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Test File"}),(0,i.jsx)(t.th,{children:"Opik Experiment"}),(0,i.jsx)(t.th,{children:"Metrics"}),(0,i.jsx)(t.th,{children:"Purpose"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_charter_validation.py"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"forseti-charter-accuracy"})}),(0,i.jsx)(t.td,{children:"CharterAccuracyMetric, ViolationDetectionMetric"}),(0,i.jsx)(t.td,{children:"Validate charter compliance decisions"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_category_classification.py"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"forseti-category-accuracy"})}),(0,i.jsx)(t.td,{children:"CategoryAccuracyMetric, ConfusionMatrix"}),(0,i.jsx)(t.td,{children:"Validate category assignments"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_batch_validation.py"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"forseti-batch-throughput"})}),(0,i.jsx)(t.td,{children:"BatchThroughput, BatchAccuracy"}),(0,i.jsx)(t.td,{children:"Validate batch processing"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"test-case-categories",children:"Test Case Categories"}),"\n",(0,i.jsx)(t.p,{children:"Each test file contains test classes that represent different scenarios:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Charter Validation:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"TestCharterValidationCompliant"})," \u2192 Valid contributions (expected is_valid=True)"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"TestCharterValidationNonCompliant"})," \u2192 Invalid contributions (expected is_valid=False)"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"TestCharterValidationEdgeCases"})," \u2192 Ambiguous cases for confidence calibration"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Category Classification:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"TestCategoryEconomie"}),", ",(0,i.jsx)(t.code,{children:"TestCategoryLogement"}),", etc. \u2192 Per-category accuracy"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"TestCategoryEdgeCases"})," \u2192 Misclassification scenarios"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"TestCategoryConfusionMatrix"})," \u2192 Common confusion pairs"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"from-tests-to-opik-datasets",children:"From Tests to Opik Datasets"}),"\n",(0,i.jsx)(t.p,{children:"Test fixtures can be exported to Opik datasets:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"# Example: Export test cases to Opik dataset\nfrom tests.unit.forseti.test_charter_validation import TestCharterValidationOpikMapping\n\ntest_class = TestCharterValidationOpikMapping()\nvalid_item = test_class.opik_valid_item()\ninvalid_item = test_class.opik_invalid_item()\n\n# Add to Opik dataset\ndataset_manager.add_items([valid_item, invalid_item])\n"})}),"\n",(0,i.jsx)(t.h2,{id:"opik-experimentation-strategy",children:"Opik Experimentation Strategy"}),"\n",(0,i.jsx)(t.h3,{id:"dataset-management",children:"Dataset Management"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Data Pipeline                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  Framaforms \u2500\u2500\u2510                                             \u2502\n\u2502               \u2502                                             \u2502\n\u2502  Mockup \u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u25ba ValidationRecord \u2500\u2500\u25ba Redis \u2500\u2500\u25ba Opik     \u2502\n\u2502               \u2502         \u2502                          Dataset  \u2502\n\u2502  Manual \u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502                             \u2502     \u2502\n\u2502                         \u25bc                             \u25bc     \u2502\n\u2502                   Local Storage              Train/Val/Test \u2502\n\u2502                                                   Split     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(t.h3,{id:"experiment-types",children:"Experiment Types"}),"\n",(0,i.jsx)(t.h4,{id:"1-accuracy-experiments-daily",children:"1. Accuracy Experiments (Daily)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'# Run via MockupProcessor\nprocessor = MockupProcessor(storage, dataset_manager)\nresults = processor.run_daily_experiment(\n    experiment_name=f"forseti-daily-{date}",\n    dataset_name="forseti-charter-validation"\n)\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Metrics tracked:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Charter accuracy (is_valid match)"}),"\n",(0,i.jsx)(t.li,{children:"Violation detection recall"}),"\n",(0,i.jsx)(t.li,{children:"Confidence calibration"}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"2-prompt-optimization-weekly",children:"2. Prompt Optimization (Weekly)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'# Use Opik Optimizer Studio\nfrom opik_optimizer import optimize_prompt\n\nresults = optimize_prompt(\n    base_prompt=FORSETI_CHARTER_PROMPT,\n    dataset="forseti-charter-training",\n    metric="charter_accuracy",\n    n_iterations=10\n)\n'})}),"\n",(0,i.jsx)(t.h4,{id:"3-model-comparison-on-demand",children:"3. Model Comparison (On-demand)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'# Compare providers/models\nproviders = ["openai:gpt-4", "anthropic:claude-3", "mistral:large"]\nfor provider in providers:\n    processor.run_experiment(\n        experiment_name=f"model-comparison-{provider}",\n        provider=provider\n    )\n'})}),"\n",(0,i.jsx)(t.h3,{id:"dataset-splits",children:"Dataset Splits"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Dataset"}),(0,i.jsx)(t.th,{children:"Purpose"}),(0,i.jsx)(t.th,{children:"Size"}),(0,i.jsx)(t.th,{children:"Update Frequency"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"forseti-charter-training"})}),(0,i.jsx)(t.td,{children:"Prompt optimization"}),(0,i.jsx)(t.td,{children:"70%"}),(0,i.jsx)(t.td,{children:"Weekly"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"forseti-charter-validation"})}),(0,i.jsx)(t.td,{children:"Experiment evaluation"}),(0,i.jsx)(t.td,{children:"15%"}),(0,i.jsx)(t.td,{children:"Weekly"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"forseti-charter-test"})}),(0,i.jsx)(t.td,{children:"Final benchmarks"}),(0,i.jsx)(t.td,{children:"15%"}),(0,i.jsx)(t.td,{children:"Monthly"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'# All unit tests (fast)\npytest tests/unit/ -v\n\n# Integration tests (requires services)\npytest tests/integration/ -v -m integration\n\n# Skip slow tests\npytest -v -m "not slow"\n\n# With coverage\npytest --cov=app --cov-report=html\n\n# Run Opik experiments (separate from pytest)\npython -m app.processors.mockup_processor --experiment daily\n'})}),"\n",(0,i.jsx)(t.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"# .github/workflows/test.yml\njobs:\n  unit-tests:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Run unit tests\n        run: pytest tests/unit/ -v\n\n  integration-tests:\n    runs-on: ubuntu-latest\n    needs: unit-tests\n    steps:\n      - name: Run integration tests\n        run: pytest tests/integration/ -v -m integration\n        env:\n          REDIS_URL: ${{ secrets.REDIS_URL }}\n"})}),"\n",(0,i.jsx)(t.h2,{id:"opik-dashboard",children:"Opik Dashboard"}),"\n",(0,i.jsxs)(t.p,{children:["Access experiment results at: ",(0,i.jsx)(t.a,{href:"https://www.comet.com/opik",children:"https://www.comet.com/opik"})]}),"\n",(0,i.jsx)(t.p,{children:"Key dashboards:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Forseti Accuracy Trends"})," - Daily accuracy over time"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Model Comparison"})," - Provider/model performance"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Prompt Versions"})," - A/B testing results"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(t.ol,{className:"contains-task-list",children:["\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Create ",(0,i.jsx)(t.code,{children:"conftest.py"})," with shared fixtures"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Split existing tests into ",(0,i.jsx)(t.code,{children:"unit/"})," and ",(0,i.jsx)(t.code,{children:"integration/"})]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Add ",(0,i.jsx)(t.code,{children:"test_forseti_agent.py"})," unit tests"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Add ",(0,i.jsx)(t.code,{children:"test_n8n_integration.py"})]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Set up daily Opik experiment automation"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Add GitHub Actions workflow for CI"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);