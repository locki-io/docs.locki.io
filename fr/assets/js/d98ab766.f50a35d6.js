"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[2906],{8453(e,n,r){r.d(n,{R:()=>c,x:()=>t});var s=r(6540);const i={},o=s.createContext(i);function c(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(o.Provider,{value:n},e.children)}},9969(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"orchestration/PROXY_MANAGEMENT","title":"Proxy Management Guide","description":"Quick reference for managing the ocapistaine proxy service.","source":"@site/docs/orchestration/PROXY_MANAGEMENT.md","sourceDirName":"orchestration","slug":"/orchestration/PROXY_MANAGEMENT","permalink":"/fr/docs/orchestration/PROXY_MANAGEMENT","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/orchestration/PROXY_MANAGEMENT.md","tags":[],"version":"current","frontMatter":{}}');var i=r(4848),o=r(8453);const c={},t="Proxy Management Guide",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Quick Commands",id:"quick-commands",level:2},{value:"Check Status",id:"check-status",level:3},{value:"Restart Proxy",id:"restart-proxy",level:3},{value:"Update Configuration",id:"update-configuration",level:3},{value:"Ngrok Setup",id:"ngrok-setup",level:2},{value:"With Custom Domain (Current Setup)",id:"with-custom-domain-current-setup",level:3},{value:"Without Custom Domain (Free Plan)",id:"without-custom-domain-free-plan",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Proxy Not Running",id:"proxy-not-running",level:3},{value:"Connection Refused",id:"connection-refused",level:3},{value:"Bad Gateway (502)",id:"bad-gateway-502",level:3},{value:"Cannot Find Module Error",id:"cannot-find-module-error",level:3},{value:"TLS/SSL Errors",id:"tlsssl-errors",level:3},{value:"IPv6 Connection Issues",id:"ipv6-connection-issues",level:3},{value:"Streamlit Apps - JavaScript Required / WebSocket Failures",id:"streamlit-apps---javascript-required--websocket-failures",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"View Real-Time Traffic",id:"view-real-time-traffic",level:3},{value:"Check Traefik Routing",id:"check-traefik-routing",level:3},{value:"Maintenance",id:"maintenance",level:2},{value:"Regular Tasks",id:"regular-tasks",level:3},{value:"Updating Ngrok",id:"updating-ngrok",level:3},{value:"Backup Configuration",id:"backup-configuration",level:3},{value:"Adding New Proxy Services",id:"adding-new-proxy-services",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"proxy-management-guide",children:"Proxy Management Guide"})}),"\n",(0,i.jsx)(n.p,{children:"Quick reference for managing the ocapistaine proxy service."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The proxy service routes traffic from ",(0,i.jsx)(n.code,{children:"https://ocapistaine.vaettir.locki.io"})," to your local machine via ngrok:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User/n8n \u2192 vaettir.locki.io:443 \u2192 Traefik \u2192 ocapistaine:80 \u2192 ngrok \u2192 localhost:8050\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-commands",children:"Quick Commands"}),"\n",(0,i.jsx)(n.h3,{id:"check-status",children:"Check Status"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# View proxy status\nssh <user>@<server> 'cd ~/vaettir && docker compose ps ocapistaine'\n\n# View logs\nssh <user>@<server> 'cd ~/vaettir && docker compose logs -f ocapistaine'\n\n# Test endpoint\ncurl -I https://ocapistaine.vaettir.locki.io\n"})}),"\n",(0,i.jsx)(n.h3,{id:"restart-proxy",children:"Restart Proxy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Quick restart (no changes)\n./scripts/update_proxy.sh\n\n# Restart with rebuild (after config changes)\n./scripts/update_proxy.sh --build\n"})}),"\n",(0,i.jsx)(n.h3,{id:"update-configuration",children:"Update Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# 1. Make changes locally\nnano proxy-configs/ocapistaine.conf.template\n\n# 2. Commit and push\ngit add .\ngit commit -m "Update proxy config"\ngit push\n\n# 3. Deploy to production\n./scripts/update_proxy.sh --build\n'})}),"\n",(0,i.jsx)(n.h2,{id:"ngrok-setup",children:"Ngrok Setup"}),"\n",(0,i.jsx)(n.h3,{id:"with-custom-domain-current-setup",children:"With Custom Domain (Current Setup)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Start ngrok:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/dev/ocapistaine\ndocker compose up -d\n\n# Start ngrok with custom domain\nngrok http 8050 --domain=ocapistaine.ngrok-free.app\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["URL stays constant: ",(0,i.jsx)(n.code,{children:"https://ocapistaine.ngrok-free.app"})]}),"\n",(0,i.jsx)(n.li,{children:"No configuration updates needed"}),"\n",(0,i.jsx)(n.li,{children:"Production config never changes"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".env"}),": ",(0,i.jsx)(n.code,{children:"OCAPISTAINE_TARGET_URL=https://ocapistaine.ngrok-free.app"})]}),"\n",(0,i.jsx)(n.li,{children:"Proxy config has hardcoded domain (lines 20 & 23)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"without-custom-domain-free-plan",children:"Without Custom Domain (Free Plan)"}),"\n",(0,i.jsx)(n.p,{children:"If using free ngrok, URL changes on each restart."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When ngrok URL changes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Get new URL: ",(0,i.jsx)(n.code,{children:"https://xyz123.ngrok-free.app"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Update production ",(0,i.jsx)(n.code,{children:".env"}),":"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh <user>@<server>\ncd ~/vaettir\nnano .env\n# Update: OCAPISTAINE_TARGET_URL=https://xyz123.ngrok-free.app\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Update proxy config:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nano proxy-configs/ocapistaine.conf.template\n# Line 20: proxy_ssl_name xyz123.ngrok-free.app;\n# Line 23: proxy_set_header Host xyz123.ngrok-free.app;\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Rebuild and restart:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose build ocapistaine\ndocker compose --profile production --profile proxy up -d ocapistaine\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"proxy-not-running",children:"Proxy Not Running"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Check service status:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh <user>@<server> 'cd ~/vaettir && docker compose ps ocapistaine'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"If not running:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh <user>@<server> 'cd ~/vaettir && docker compose --profile production --profile proxy up -d ocapistaine'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"connection-refused",children:"Connection Refused"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Check ngrok is running:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# On your local machine\ncurl http://localhost:4040/api/tunnels\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Check local service:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8050/health\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bad-gateway-502",children:"Bad Gateway (502)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Ngrok URL changed (free plan)"}),"\n",(0,i.jsx)(n.li,{children:"Host header mismatch"}),"\n",(0,i.jsx)(n.li,{children:"ngrok domain doesn't match config"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check current ngrok URL\ncurl http://localhost:4040/api/tunnels | jq '.tunnels[0].public_url'\n\n# Update production .env if different\nssh <user>@<server>\ncd ~/vaettir\nnano .env\n# Update OCAPISTAINE_TARGET_URL\n\n# Restart proxy\ndocker compose --profile production --profile proxy restart ocapistaine\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cannot-find-module-error",children:"Cannot Find Module Error"}),"\n",(0,i.jsx)(n.p,{children:"Nginx config error - check logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh <user>@<server> 'cd ~/vaettir && docker compose logs ocapistaine --tail 50'\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Common issue:"})," Environment variable substitution problem"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check generated nginx config\nssh <user>@<server> 'docker exec vaettir-ocapistaine-1 cat /etc/nginx/nginx.conf'\n\n# Should see the actual URL, not ${OCAPISTAINE_TARGET_URL}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tlsssl-errors",children:"TLS/SSL Errors"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"SNI Error:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"This client does not support TLS SNI\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fix:"})," Ensure these lines are in ",(0,i.jsx)(n.code,{children:"proxy-configs/ocapistaine.conf.template"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"proxy_ssl_server_name on;\nproxy_ssl_name ocapistaine.ngrok-free.app;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Host Error:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Received a request for different Host than the current tunnel\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fix:"})," Ensure Host header matches ngrok domain:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"proxy_set_header Host ocapistaine.ngrok-free.app;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ipv6-connection-issues",children:"IPv6 Connection Issues"}),"\n",(0,i.jsx)(n.p,{children:"If seeing IPv6 errors in logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"connect() to [2a05:...]:443 failed (101: Network unreachable)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fix:"})," Already configured to force IPv4 in proxy config:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"resolver 8.8.8.8 8.8.4.4 valid=300s ipv6=off;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"streamlit-apps---javascript-required--websocket-failures",children:"Streamlit Apps - JavaScript Required / WebSocket Failures"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Page loads but shows "You need to enable JavaScript to run this app"'}),"\n",(0,i.jsxs)(n.li,{children:["WebSocket connection errors in browser console: ",(0,i.jsx)(n.code,{children:"WebSocket connection to 'wss://ocapistaine.vaettir.locki.io/_stcore/stream' failed"})]}),"\n",(0,i.jsxs)(n.li,{children:["403 Forbidden errors on ",(0,i.jsx)(n.code,{children:"/_stcore/stream"})," in logs"]}),"\n",(0,i.jsx)(n.li,{children:"App appears broken or disconnected"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Root Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nginx proxy missing WebSocket upgrade headers"})," (most common)"]}),"\n",(0,i.jsx)(n.li,{children:"Streamlit CORS configuration blocking proxy domain"}),"\n",(0,i.jsx)(n.li,{children:"Missing proxy headers for proper host forwarding"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fix 1: Update Nginx Proxy for WebSocket Support"})}),"\n",(0,i.jsxs)(n.p,{children:["The nginx proxy on vaettir ",(0,i.jsx)(n.strong,{children:"MUST"})," include WebSocket upgrade headers. Edit the proxy configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# SSH to vaettir\nssh <user>@<server>\n\n# Edit the ocapistaine proxy config\ncd ~/vaettir\nnano proxy-configs/ocapistaine.conf.template\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Required configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"# WebSocket upgrade support (add at the top, outside server block)\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    '' close;\n}\n\nserver {\n    listen 80;\n\n    # DNS resolver for dynamic upstream\n    resolver 8.8.8.8 8.8.4.4 valid=300s ipv6=off;\n\n    location / {\n        # Target ngrok URL (from environment variable)\n        proxy_pass ${OCAPISTAINE_TARGET_URL};\n\n        # WebSocket support - CRITICAL for Streamlit\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n\n        # Disable buffering for real-time streaming\n        proxy_buffering off;\n        proxy_cache off;\n\n        # Standard proxy headers\n        proxy_set_header Host ocapistaine.ngrok-free.app;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Forwarded-Host $host;\n\n        # SSL settings for ngrok\n        proxy_ssl_server_name on;\n        proxy_ssl_name ocapistaine.ngrok-free.app;\n\n        # Timeouts (important for WebSocket long-polling)\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 300s;\n        proxy_read_timeout 300s;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rebuild and restart:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Rebuild the proxy container with new config\ndocker compose build ocapistaine\n\n# Restart with production profile\ndocker compose --profile production --profile proxy up -d ocapistaine\n\n# Verify it's running\ndocker compose ps ocapistaine\n\n# Check logs for errors\ndocker compose logs ocapistaine --tail 50\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fix 2: Streamlit CORS Configuration"})}),"\n",(0,i.jsxs)(n.p,{children:["In your local ocapistaine app, ensure CORS is configured via ",(0,i.jsx)(n.strong,{children:"environment variables"})," (not config.toml):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# In ocapistaine/.env\nNGROK_DOMAIN=ocapistaine.ngrok-free.app\n\n# Run Streamlit with automatic CORS setup\n./scripts/run_streamlit.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"run_streamlit.sh"})," script automatically configures:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"STREAMLIT_SERVER_ALLOWED_ORIGINS"})," with all required domains"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"STREAMLIT_SERVER_ENABLE_CORS=true"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=false"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Streamlit 1.53.0 does NOT support ",(0,i.jsx)(n.code,{children:"allowedOrigins"})," in config.toml. You MUST use environment variables."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fix 3: Verify Configuration"})}),"\n",(0,i.jsx)(n.p,{children:"After applying fixes, test the connection:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# 1. Check WebSocket endpoint accessibility\ncurl -I https://ocapistaine.vaettir.locki.io/_stcore/stream\n\n# Should return "426 Upgrade Required" (not 403 or 502)\n\n# 2. Test in browser\nopen https://ocapistaine.vaettir.locki.io\n\n# 3. Check browser console (F12 \u2192 Console)\n# Should see: WebSocket connection established\n# Should NOT see: WebSocket connection failed or 403 errors\n\n# 4. Check Network tab (F12 \u2192 Network \u2192 WS filter)\n# Look for: /_stcore/stream with status "101 Switching Protocols"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Troubleshooting:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Error"}),(0,i.jsx)(n.th,{children:"Cause"}),(0,i.jsx)(n.th,{children:"Fix"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WebSocket connection failed"})}),(0,i.jsx)(n.td,{children:"Missing WebSocket headers in proxy"}),(0,i.jsxs)(n.td,{children:["Add ",(0,i.jsx)(n.code,{children:"Upgrade"})," and ",(0,i.jsx)(n.code,{children:"Connection"})," headers (Fix 1)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"403 Forbidden"})}),(0,i.jsx)(n.td,{children:"CORS blocking domain"}),(0,i.jsx)(n.td,{children:"Configure STREAMLIT_SERVER_ALLOWED_ORIGINS (Fix 2)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"502 Bad Gateway"})}),(0,i.jsx)(n.td,{children:"Proxy can't reach ngrok"}),(0,i.jsx)(n.td,{children:"Verify ngrok is running and URL is correct"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"426 Upgrade Required"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"NORMAL"})," - This is correct for direct curl (not a browser)"]}),(0,i.jsx)(n.td,{children:"No fix needed"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"For detailed Streamlit configuration:"})," See ",(0,i.jsx)(n.a,{href:"/fr/docs/app/STREAMLIT_SETUP",children:"STREAMLIT_SETUP.md"})]}),"\n",(0,i.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,i.jsx)(n.h3,{id:"view-real-time-traffic",children:"View Real-Time Traffic"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ngrok Web Interface:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Open in browser\nopen http://localhost:4040\n"})}),"\n",(0,i.jsx)(n.p,{children:"Shows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All HTTP requests"}),"\n",(0,i.jsx)(n.li,{children:"Request/response details"}),"\n",(0,i.jsx)(n.li,{children:"Replay capability"}),"\n",(0,i.jsx)(n.li,{children:"Performance metrics"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"check-traefik-routing",children:"Check Traefik Routing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh <user>@<server> 'cd ~/vaettir && docker compose logs traefik | grep ocapistaine'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should see:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Creating router ocapistaine\nCreating service ocapistaine\n"})}),"\n",(0,i.jsx)(n.h2,{id:"maintenance",children:"Maintenance"}),"\n",(0,i.jsx)(n.h3,{id:"regular-tasks",children:"Regular Tasks"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Daily:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure ngrok is running locally"}),"\n",(0,i.jsxs)(n.li,{children:["Verify connection: ",(0,i.jsx)(n.code,{children:"curl -I https://ocapistaine.vaettir.locki.io"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Weekly:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check proxy logs for errors"}),"\n",(0,i.jsx)(n.li,{children:"Monitor ngrok usage/bandwidth"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Monthly:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Update ngrok client if needed"}),"\n",(0,i.jsx)(n.li,{children:"Review proxy performance"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"updating-ngrok",children:"Updating Ngrok"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# macOS\nbrew upgrade ngrok\n\n# Or download from https://ngrok.com/download\n"})}),"\n",(0,i.jsx)(n.h3,{id:"backup-configuration",children:"Backup Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Configuration is in git, but to backup manually:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Backup proxy config\nscp <user>@<server>:~/vaettir/proxy-configs/ocapistaine.conf.template ./PRIVATE_backups/\n\n# Backup .env (contains ngrok URL)\nssh <user>@<server> 'cd ~/vaettir && grep OCAPISTAINE .env' > ./PRIVATE_backups/proxy-env-backup.txt\n"})}),"\n",(0,i.jsx)(n.h2,{id:"adding-new-proxy-services",children:"Adding New Proxy Services"}),"\n",(0,i.jsx)(n.p,{children:"To proxy additional services:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Create config template:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cp proxy-configs/ocapistaine.conf.template proxy-configs/myservice.conf.template\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Update docker-compose.yml:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'myservice:\n  build:\n    context: .\n    dockerfile: Dockerfile.proxy-myservice\n  environment:\n    - MYSERVICE_TARGET_URL=${MYSERVICE_TARGET_URL}\n  profiles: ["proxy"]\n  labels:\n    - "traefik.enable=true"\n    - "traefik.http.routers.myservice.rule=Host(`myservice.vaettir.locki.io`)"\n    - "traefik.http.routers.myservice.entrypoints=websecure"\n    - "traefik.http.routers.myservice.tls=true"\n    - "traefik.http.routers.myservice.tls.certresolver=myresolver"\n    - "traefik.http.services.myservice.loadbalancer.server.port=80"\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Add DNS record"})," in Cloudflare: ",(0,i.jsx)(n.code,{children:"myservice.vaettir.locki.io \u2192 213.136.85.11"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Start ngrok"})," with custom domain: ",(0,i.jsx)(n.code,{children:"myservice.ngrok-free.app"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/fr/docs/orchestration/",children:"Main Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/fr/docs/orchestration/DEVELOPMENT",children:"Development Workflow"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/fr/docs/orchestration/PORTS",children:"Port Management"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/fr/docs/orchestration/TROUBLESHOOTING",children:"Troubleshooting"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://ngrok.com/docs",children:"ngrok Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);