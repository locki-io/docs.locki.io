"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[5173],{1111(e,s,n){n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"app/scheduler/README","title":"OCapistaine Scheduler Service","description":"Production-grade task orchestration system for civic transparency workflows.","source":"@site/docs/app/scheduler/README.md","sourceDirName":"app/scheduler","slug":"/app/scheduler/","permalink":"/fr/docs/app/scheduler/","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/app/scheduler/README.md","tags":[],"version":"current","frontMatter":{},"sidebar":"appSidebar","previous":{"title":"Dynamic CORS Strategy for OCapistaine","permalink":"/fr/docs/app/CORS_STRATEGY"},"next":{"title":"OCapistaine Scheduler Service","permalink":"/fr/docs/app/scheduler/"}}');var i=n(4848),l=n(8453);const c={},t="OCapistaine Scheduler Service",d={},a=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:3},{value:"Design Principles",id:"design-principles",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Import Hierarchy (No Circular Dependencies)",id:"import-hierarchy-no-circular-dependencies",level:3},{value:"FastAPI Integration",id:"fastapi-integration",level:3},{value:"Task Types",id:"task-types",level:2},{value:"1. Daily Workflow Tasks (Once Per Day)",id:"1-daily-workflow-tasks-once-per-day",level:3},{value:"2. Recurring Tasks (Cron-Based)",id:"2-recurring-tasks-cron-based",level:3},{value:"Core Components",id:"core-components",level:2},{value:"1. Task Boilerplate (<code>_task_boilerplate</code>)",id:"1-task-boilerplate-_task_boilerplate",level:3},{value:"2. Scheduler Utils (<code>app/services/scheduler/utils.py</code>)",id:"2-scheduler-utils-appservicesschedulerutilspy",level:3},{value:"3. Redis Keys",id:"3-redis-keys",level:3},{value:"4. TaskError Exception",id:"4-taskerror-exception",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Adding a New Task",id:"adding-a-new-task",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"DO",id:"do",level:3},{value:"DON&#39;T",id:"dont",level:3},{value:"Redis Usage",id:"redis-usage",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Task Not Running",id:"task-not-running",level:3},{value:"Task Runs Multiple Times",id:"task-runs-multiple-times",level:3},{value:"References",id:"references",level:2},{value:"Documentation",id:"documentation",level:3},{value:"Related Projects",id:"related-projects",level:3},{value:"Task Schedule Summary",id:"task-schedule-summary",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"ocapistaine-scheduler-service",children:"OCapistaine Scheduler Service"})}),"\n",(0,i.jsx)(s.p,{children:"Production-grade task orchestration system for civic transparency workflows."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Last Updated:"})," February 2026\n",(0,i.jsx)(s.strong,{children:"Architecture Version:"})," 1.0.0"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#overview",children:"Overview"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#architecture",children:"Architecture"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#task-types",children:"Task Types"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#core-components",children:"Core Components"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#quick-start",children:"Quick Start"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#references",children:"References"})}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(s.p,{children:"The Scheduler Service coordinates all automated workflows in OCapistaine using APScheduler with Redis-based coordination. It manages data crawling, contribution analysis, and LLM evaluation with a focus on reliability and avoiding duplicate work."}),"\n",(0,i.jsx)(s.h3,{id:"key-features",children:"Key Features"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Task Orchestration"}),": Dependency-driven task chains with sequential execution"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Distributed Locking"}),": Redis-based coordination prevents duplicate work"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Idempotency"}),": Success keys ensure tasks run once per day"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Error Handling"}),": TaskError propagation with automatic retries"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"FastAPI Integration"}),": Seamless lifespan management"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"design-principles",children:"Design Principles"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Tasks are isolated workflow units"})," - Each task file is self-contained"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Scheduler is an orchestration service"})," - Manages timing and dependencies"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"No circular dependencies"})," - Clean import hierarchy via ",(0,i.jsx)(s.code,{children:"scheduler.utils"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Shared utilities"})," - Common patterns in ",(0,i.jsx)(s.code,{children:"_task_boilerplate"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Redis coordination"})," - Lock and success keys prevent duplicate work"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(s.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"app/services/\n\u251c\u2500\u2500 scheduler/              # Orchestration service\n\u2502   \u251c\u2500\u2500 __init__.py         # Main scheduler, FastAPI lifespan integration\n\u2502   \u2514\u2500\u2500 utils.py            # Shared utilities (breaks circular imports)\n\u2502\n\u2514\u2500\u2500 tasks/                  # Individual task modules\n    \u251c\u2500\u2500 __init__.py         # Task registry, _task_boilerplate\n    \u251c\u2500\u2500 task_contributions_analysis.py   # Daily contribution validation\n    \u251c\u2500\u2500 task_opik_experiment.py          # Opik evaluation runner\n    \u2514\u2500\u2500 task_firecrawl.py                # Document crawling\n"})}),"\n",(0,i.jsx)(s.h3,{id:"import-hierarchy-no-circular-dependencies",children:"Import Hierarchy (No Circular Dependencies)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"app/services/tasks/__init__.py\n  \u2193 defines utilities (TaskError, _task_boilerplate)\n  \u2193 imports task modules\n\napp/services/tasks/task_*.py\n  \u2193 imports from app.services.scheduler.utils\n  \u2193 (NOT from app.services.scheduler)\n\napp/services/scheduler/__init__.py\n  \u2193 imports from app.services.scheduler.utils\n  \u2193 imports from app.services.tasks\n  \u2713 No circular dependency\n"})}),"\n",(0,i.jsx)(s.h3,{id:"fastapi-integration",children:"FastAPI Integration"}),"\n",(0,i.jsx)(s.p,{children:"The scheduler integrates with FastAPI via the lifespan context manager:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"# In app/main.py\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    # Startup\n    from app.services.scheduler import start_scheduler\n    await start_scheduler()\n\n    yield\n\n    # Shutdown\n    from app.services.scheduler import stop_scheduler\n    await stop_scheduler()\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"task-types",children:"Task Types"}),"\n",(0,i.jsx)(s.h3,{id:"1-daily-workflow-tasks-once-per-day",children:"1. Daily Workflow Tasks (Once Per Day)"}),"\n",(0,i.jsxs)(s.p,{children:["Run sequentially via ",(0,i.jsx)(s.code,{children:"orchestrate_task_chain()"})," every 7 minutes from 6 AM to 11 PM:"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Task"}),(0,i.jsx)(s.th,{children:"Purpose"}),(0,i.jsx)(s.th,{children:"Dependencies"})]})}),(0,i.jsx)(s.tbody,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"task_contributions_analysis"})}),(0,i.jsx)(s.td,{children:"Validate citizen contributions"}),(0,i.jsx)(s.td,{children:"None"})]})})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Success Keys:"})," ",(0,i.jsx)(s.code,{children:"success:{task_name}:YYYYMMDD"})," (24h TTL)"]}),"\n",(0,i.jsx)(s.h3,{id:"2-recurring-tasks-cron-based",children:"2. Recurring Tasks (Cron-Based)"}),"\n",(0,i.jsx)(s.p,{children:"Run on fixed schedules:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Task"}),(0,i.jsx)(s.th,{children:"Schedule"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"orchestrate_task_chain"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"*/7 6-23 * * *"})}),(0,i.jsx)(s.td,{children:"Check/schedule daily tasks"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"task_firecrawl"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0 3 * * *"})}),(0,i.jsx)(s.td,{children:"Nightly document crawling"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"task_opik_experiment"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0 5 * * *"})}),(0,i.jsx)(s.td,{children:"Daily LLM evaluation"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"core-components",children:"Core Components"}),"\n",(0,i.jsxs)(s.h3,{id:"1-task-boilerplate-_task_boilerplate",children:["1. Task Boilerplate (",(0,i.jsx)(s.code,{children:"_task_boilerplate"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Location:"})," ",(0,i.jsx)(s.code,{children:"app/services/tasks/__init__.py"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Purpose:"})," Eliminates repetitive code in every task (lock, success key, result dict)."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from app.services.tasks import _task_boilerplate, TaskError\n\nl, lock_key, success_key, result, task_id = _task_boilerplate(\n    "task_name", date_string, skip_success_check=False\n)\n\nif result["status"] == "skipped":\n    return result  # Already completed or running\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"l"}),": Redis connection (db=6)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"lock_key"}),": ",(0,i.jsx)(s.code,{children:"lock:task_name:YYYYMMDD"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"success_key"}),": ",(0,i.jsx)(s.code,{children:"success:task_name:YYYYMMDD"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"result"}),": Pre-initialized dict with status, errors, warnings"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"task_id"}),": Unique UUID for this execution"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"skip_success_check"}),": Set ",(0,i.jsx)(s.code,{children:"True"})," for recurring tasks (default: ",(0,i.jsx)(s.code,{children:"False"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"2-scheduler-utils-appservicesschedulerutilspy",children:["2. Scheduler Utils (",(0,i.jsx)(s.code,{children:"app/services/scheduler/utils.py"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Purpose:"})," Shared utilities to avoid circular imports between scheduler and tasks."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Functions:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'def get_scheduler_redis() -> redis.Redis:\n    """Get Redis connection for scheduler locks (db=6)."""\n    ...\n\ndef normalize_timestamp(ts: int | float) -> int:\n    """Convert millisecond timestamps to seconds."""\n    ...\n\ndef clear_old_jobs(scheduler, prefix: str = "task_") -> int:\n    """Remove stale jobs with given prefix."""\n    ...\n'})}),"\n",(0,i.jsx)(s.h3,{id:"3-redis-keys",children:"3. Redis Keys"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Lock Keys"})," (TTL: 300 seconds):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"lock:task_contributions_analysis:20260203\nlock:task_firecrawl:20260203\nlock:task_opik_experiment:20260203\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Success Keys"})," (TTL: 86400 seconds):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"success:task_contributions_analysis:20260203\nsuccess:task_firecrawl:20260203\nsuccess:task_opik_experiment:20260203\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Purpose:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Lock keys: Prevent concurrent execution (distributed locking)"}),"\n",(0,i.jsx)(s.li,{children:"Success keys: Enable idempotency (skip if already completed)"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"4-taskerror-exception",children:"4. TaskError Exception"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'class TaskError(Exception):\n    """Custom exception for task failures."""\n\n    def __init__(self, status: str, message: str):\n        self.status = status\n        self.message = message\n        super().__init__(message)\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'try:\n    result = fetch_data()\n    if not result:\n        raise TaskError("failed", "No data returned from API")\nexcept RequestException as e:\n    raise TaskError("failed", f"API request failed: {e}")\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(s.h3,{id:"adding-a-new-task",children:"Adding a New Task"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"1. Create task file:"})," ",(0,i.jsx)(s.code,{children:"app/services/tasks/task_mynewtask.py"})]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"2. Use boilerplate pattern:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from app.services.tasks import TaskError, _task_boilerplate, REDIS_SUCCESS_TTL\n\ndef task_mynewtask(date_string: str = None) -> dict:\n    l, lock_key, success_key, result, task_id = _task_boilerplate(\n        "task_mynewtask", date_string\n    )\n\n    if result["status"] == "skipped":\n        return result\n\n    try:\n        # Your logic here\n        result["status"] = "success"\n        l.set(success_key, "completed", ex=REDIS_SUCCESS_TTL)\n        return result\n    except Exception as e:\n        result["status"] = "failed"\n        result["errors"].append(str(e))\n        raise TaskError("failed", str(e))\n    finally:\n        l.delete(lock_key)\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"3. Export from task registry:"})," ",(0,i.jsx)(s.code,{children:"app/services/tasks/__init__.py"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"4. Schedule in orchestrator:"})," ",(0,i.jsx)(s.code,{children:"app/services/scheduler/__init__.py"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"See:"})," ",(0,i.jsx)(s.a,{href:"/fr/docs/app/scheduler/USAGE_EXAMPLES",children:"USAGE_EXAMPLES.md"})," for complete examples."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(s.h3,{id:"do",children:"DO"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Use ",(0,i.jsx)(s.code,{children:"_task_boilerplate"})," for consistency"]}),"\n",(0,i.jsx)(s.li,{children:"Return standardized result dict"}),"\n",(0,i.jsx)(s.li,{children:"Mark task as completed with success key"}),"\n",(0,i.jsxs)(s.li,{children:["Release lock in ",(0,i.jsx)(s.code,{children:"finally"})," block"]}),"\n",(0,i.jsx)(s.li,{children:"Log errors with full context"}),"\n",(0,i.jsx)(s.li,{children:"Keep tasks idempotent"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"dont",children:"DON'T"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Skip lock acquisition (causes duplicate work)"}),"\n",(0,i.jsx)(s.li,{children:"Forget to release lock (blocks future runs)"}),"\n",(0,i.jsxs)(s.li,{children:["Raise generic ",(0,i.jsx)(s.code,{children:"Exception"})," (use ",(0,i.jsx)(s.code,{children:"TaskError"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Import from ",(0,i.jsx)(s.code,{children:"app.services.scheduler"})," in tasks (use ",(0,i.jsx)(s.code,{children:"scheduler.utils"}),")"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"redis-usage",children:"Redis Usage"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'from app.services.scheduler.utils import get_scheduler_redis\n\n# Scheduler locks (db=6)\nl = get_scheduler_redis()\nl.set("lock:task_name:20260203", task_id, ex=300, nx=True)\n\n# Application data (db=5, via redis_client)\nfrom app.data.redis_client import redis_connection\nwith redis_connection() as r:\n    r.setex("contribution:abc123", 86400, json.dumps(data))\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(s.h3,{id:"task-not-running",children:"Task Not Running"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Check:"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Scheduler running: ",(0,i.jsx)(s.code,{children:"scheduler.running == True"})]}),"\n",(0,i.jsxs)(s.li,{children:["Task scheduled: ",(0,i.jsx)(s.code,{children:"scheduler.get_jobs()"})]}),"\n",(0,i.jsxs)(s.li,{children:["Lock held: ",(0,i.jsx)(s.code,{children:'redis-cli -n 6 KEYS "lock:task_name:*"'})]}),"\n",(0,i.jsxs)(s.li,{children:["Already completed: ",(0,i.jsx)(s.code,{children:'redis-cli -n 6 KEYS "success:task_name:*"'})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Fix:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'# Clear stuck lock\nredis-cli -n 6 DEL "lock:task_contributions_analysis:20260203"\n\n# Re-run task\nredis-cli -n 6 DEL "success:task_contributions_analysis:20260203"\n'})}),"\n",(0,i.jsx)(s.h3,{id:"task-runs-multiple-times",children:"Task Runs Multiple Times"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Cause:"})," Lock not acquired properly or released prematurely."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Fix:"})," Always use ",(0,i.jsx)(s.code,{children:"_task_boilerplate"})," and release lock in ",(0,i.jsx)(s.code,{children:"finally"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'l, lock_key, success_key, result, task_id = _task_boilerplate(...)\n\nif result["status"] == "skipped":\n    return result\n\ntry:\n    # Task logic\n    pass\nfinally:\n    l.delete(lock_key)  # CRITICAL: Always release\n'})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,i.jsx)(s.h3,{id:"documentation",children:"Documentation"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.a,{href:"/fr/docs/app/scheduler/USAGE_EXAMPLES",children:"USAGE_EXAMPLES.md"})})," - Complete how-to guide with code examples"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.a,{href:"/fr/docs/app/scheduler/TASK_BOILERPLATE",children:"TASK_BOILERPLATE.md"})})," - Detailed boilerplate usage"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"related-projects",children:"Related Projects"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Vaettir"})," (github.com/locki-io/vaettir) - N8N workflows for decision-making"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"audierne2026/participons"})," - Public participation platform"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"task-schedule-summary",children:"Task Schedule Summary"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Task"}),(0,i.jsx)(s.th,{children:"Schedule"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"orchestrate_task_chain"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"*/7 6-23 * * *"})}),(0,i.jsx)(s.td,{children:"Dependency-driven task orchestration"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"task_contributions_analysis"})}),(0,i.jsx)(s.td,{children:"Via chain"}),(0,i.jsx)(s.td,{children:"Daily contribution validation"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"task_opik_experiment"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0 5 * * *"})}),(0,i.jsx)(s.td,{children:"Daily Opik experiments"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"task_firecrawl"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0 3 * * *"})}),(0,i.jsx)(s.td,{children:"Nightly document crawling"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Last Updated:"})," February 2026\n",(0,i.jsx)(s.strong,{children:"Maintained by:"})," OCapistaine Team\n",(0,i.jsx)(s.strong,{children:"Architecture Version:"})," 1.0.0"]})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,s,n){n.d(s,{R:()=>c,x:()=>t});var r=n(6540);const i={},l=r.createContext(i);function c(e){const s=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:s},e.children)}}}]);