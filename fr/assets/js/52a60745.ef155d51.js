"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[6941],{662(e,t,s){s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"app/PROMPT_MANAGEMENT","title":"Prompt Management Architecture","description":"Overview","source":"@site/docs/app/PROMPT_MANAGEMENT.md","sourceDirName":"app","slug":"/app/PROMPT_MANAGEMENT","permalink":"/fr/docs/app/PROMPT_MANAGEMENT","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/app/PROMPT_MANAGEMENT.md","tags":[],"version":"current","frontMatter":{}}');var r=s(4848),n=s(8453);const o={},c="Prompt Management Architecture",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Current State \u2705",id:"current-state-",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Prompt Inventory",id:"prompt-inventory",level:2},{value:"Forseti Agent Prompts (JSON - Chat Format)",id:"forseti-agent-prompts-json---chat-format",level:3},{value:"Forseti Batch Validation (Experiments)",id:"forseti-batch-validation-experiments",level:3},{value:"Auto-Contribution Prompts (Python - Text Format)",id:"auto-contribution-prompts-python---text-format",level:3},{value:"Shared Constants",id:"shared-constants",level:3},{value:"File Structure",id:"file-structure",level:2},{value:"Usage",id:"usage",level:2},{value:"Get Prompt Registry",id:"get-prompt-registry",level:3},{value:"Get Chat Messages (JSON Format)",id:"get-chat-messages-json-format",level:3},{value:"Format Text Prompt (Python Format)",id:"format-text-prompt-python-format",level:3},{value:"Check Prompt Metadata",id:"check-prompt-metadata",level:3},{value:"CLI Commands",id:"cli-commands",level:2},{value:"List Local Prompts",id:"list-local-prompts",level:3},{value:"Sync to Opik",id:"sync-to-opik",level:3},{value:"Compare Local vs Opik",id:"compare-local-vs-opik",level:3},{value:"Optimization",id:"optimization",level:2},{value:"Run Prompt Optimization",id:"run-prompt-optimization",level:3},{value:"Available Optimizers",id:"available-optimizers",level:3},{value:"Migration Plan",id:"migration-plan",level:2},{value:"Phase 1: Consolidate \u2705 Complete",id:"phase-1-consolidate--complete",level:3},{value:"Phase 2: Opik Integration \u2705 Complete",id:"phase-2-opik-integration--complete",level:3},{value:"Phase 3: Vaettir MCP (Future)",id:"phase-3-vaettir-mcp-future",level:3},{value:"Phase 4: Update Forseti Agent (Next)",id:"phase-4-update-forseti-agent-next",level:3},{value:"Variable Formats",id:"variable-formats",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"External References",id:"external-references",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"prompt-management-architecture",children:"Prompt Management Architecture"})}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"This document outlines the unified prompt management strategy for OCapistaine, integrating:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Opik"})," for versioning, optimization, and experiments"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Vaettir MCP"})," for centralized prompt storage and retrieval (future)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Local JSON/Python prompts"})," as fallback during development"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"current-state-",children:"Current State \u2705"}),"\n",(0,r.jsxs)(t.p,{children:["Prompts are now centralized in ",(0,r.jsx)(t.code,{children:"app/prompts/"})," with:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Single source of truth for categories and descriptions"}),"\n",(0,r.jsx)(t.li,{children:"JSON format for chat-based prompts (synced from Opik)"}),"\n",(0,r.jsx)(t.li,{children:"Python format for text-based prompts (legacy)"}),"\n",(0,r.jsx)(t.li,{children:"Registry with Opik fallback chain"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           PROMPT MANAGEMENT LAYERS                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  LAYER 1: PROMPT REGISTRY (app/prompts/)                        \u2705 COMPLETE  \u2502    \u2502\n\u2502  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502    \u2502\n\u2502  \u2502  \u2022 PromptRegistry class         Central prompt access                        \u2502    \u2502\n\u2502  \u2502  \u2022 get_prompt(name, version)    Retrieve by name + optional version          \u2502    \u2502\n\u2502  \u2502  \u2022 get_messages(name, **vars)   Get chat-format messages                     \u2502    \u2502\n\u2502  \u2502  \u2022 format_prompt(name, **vars)  Format with Mustache/Python variables        \u2502    \u2502\n\u2502  \u2502  \u2022 list_prompts()               Enumerate available prompts                  \u2502    \u2502\n\u2502  \u2502                                                                               \u2502    \u2502\n\u2502  \u2502  Sources (priority order):                                                    \u2502    \u2502\n\u2502  \u2502  1. Local JSON (chat format)  \u2192 Synced from Opik                            \u2502    \u2502\n\u2502  \u2502  2. Local Python (text)       \u2192 Legacy fallback                             \u2502    \u2502\n\u2502  \u2502  3. Opik Prompt Library       \u2192 Remote versioned (when configured)          \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                       \u2502                                              \u2502\n\u2502                                       \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  LAYER 2: OPIK INTEGRATION                                      \u2705 COMPLETE  \u2502    \u2502\n\u2502  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502    \u2502\n\u2502  \u2502  \u2022 opik_sync.py               Sync local \u2194 Opik library                     \u2502    \u2502\n\u2502  \u2502  \u2022 optimizer.py               Prompt optimization with opik-optimizer        \u2502    \u2502\n\u2502  \u2502  \u2022 Charter accuracy metric    Custom scoring for validation                  \u2502    \u2502\n\u2502  \u2502  \u2022 Experiment support         Track prompt versions in experiments           \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                       \u2502                                              \u2502\n\u2502                                       \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  LAYER 3: VAETTIR MCP                                           \ud83d\udd1c PLANNED   \u2502    \u2502\n\u2502  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502    \u2502\n\u2502  \u2502  \u2022 MCP Tool: get_prompt         Fetch prompt from Vaettir realm              \u2502    \u2502\n\u2502  \u2502  \u2022 MCP Tool: list_prompts       List available prompts                       \u2502    \u2502\n\u2502  \u2502  \u2022 Multi-agent sharing          Same prompts across N8N + Python             \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(t.h2,{id:"prompt-inventory",children:"Prompt Inventory"}),"\n",(0,r.jsx)(t.h3,{id:"forseti-agent-prompts-json---chat-format",children:"Forseti Agent Prompts (JSON - Chat Format)"}),"\n",(0,r.jsx)(t.p,{children:"All Forseti feature prompts are now in JSON chat format for Opik compatibility:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Local Name"}),(0,r.jsx)(t.th,{children:"Opik Name"}),(0,r.jsx)(t.th,{children:"Commit"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Variables"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti.persona"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti461-system-persona"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"f73d1f4a"})}),(0,r.jsx)(t.td,{children:"system"}),(0,r.jsx)(t.td,{children:"None"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti.charter_validation"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti461-user-charter-validation"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"4b187053"})}),(0,r.jsx)(t.td,{children:"user"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{{input.title}}"}),", ",(0,r.jsx)(t.code,{children:"{{input.body}}"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti.category_classification"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti461-user-category-classification"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"efd48155"})}),(0,r.jsx)(t.td,{children:"user"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{{input.title}}"}),", ",(0,r.jsx)(t.code,{children:"{{input.body}}"}),", ",(0,r.jsx)(t.code,{children:"{{input.current_category}}"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti.wording_correction"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti461-user-wording-correction"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"f2bbedd1"})}),(0,r.jsx)(t.td,{children:"user"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{{input.title}}"}),", ",(0,r.jsx)(t.code,{children:"{{input.body}}"})]})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"forseti-batch-validation-experiments",children:"Forseti Batch Validation (Experiments)"}),"\n",(0,r.jsxs)(t.p,{children:["Batch validation is handled as ",(0,r.jsx)(t.strong,{children:"Opik experiments"}),", not as a feature prompt:"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Prompt Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Variables"}),(0,r.jsx)(t.th,{children:"Notes"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"forseti.batch_validation"})}),(0,r.jsx)(t.td,{children:"user"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{items_json}"})}),(0,r.jsx)(t.td,{children:"Python format, for experiment runs"})]})})]}),"\n",(0,r.jsxs)(t.p,{children:["See ",(0,r.jsx)(t.a,{href:"/fr/docs/app/FORSETI_AGENT",children:"FORSETI_AGENT.md"})," for experiment setup and feature documentation."]}),"\n",(0,r.jsx)(t.h3,{id:"auto-contribution-prompts-python---text-format",children:"Auto-Contribution Prompts (Python - Text Format)"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Prompt Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Variables"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"autocontrib.draft_fr"})}),(0,r.jsx)(t.td,{children:"user"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{source_text}"}),", ",(0,r.jsx)(t.code,{children:"{category}"}),", ",(0,r.jsx)(t.code,{children:"{category_desc}"}),", ",(0,r.jsx)(t.code,{children:"{source_title_section}"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"autocontrib.draft_en"})}),(0,r.jsx)(t.td,{children:"user"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{source_text}"}),", ",(0,r.jsx)(t.code,{children:"{category}"}),", ",(0,r.jsx)(t.code,{children:"{category_desc}"}),", ",(0,r.jsx)(t.code,{children:"{source_title_section}"})]})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"shared-constants",children:"Shared Constants"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Constant"}),(0,r.jsx)(t.th,{children:"Location"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"CATEGORIES"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"app/prompts/constants.py"})}),(0,r.jsx)(t.td,{children:"7 charter categories (single source)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"CATEGORY_DESCRIPTIONS"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"app/prompts/constants.py"})}),(0,r.jsx)(t.td,{children:"FR/EN/prompt descriptions"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"VIOLATIONS_TEXT"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"app/prompts/constants.py"})}),(0,r.jsx)(t.td,{children:"Charter violation rules"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"ENCOURAGED_TEXT"})}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"app/prompts/constants.py"})}),(0,r.jsx)(t.td,{children:"Charter values"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"app/prompts/\n\u251c\u2500\u2500 __init__.py              # Exports: get_registry, sync_all_prompts, optimize_forseti_charter\n\u251c\u2500\u2500 registry.py              # PromptRegistry class with chat format support\n\u251c\u2500\u2500 constants.py             # CATEGORIES, CATEGORY_DESCRIPTIONS (single source)\n\u251c\u2500\u2500 opik_sync.py             # Sync prompts to Opik library (CLI + API)\n\u251c\u2500\u2500 optimizer.py             # Prompt optimization with opik-optimizer\n\u2514\u2500\u2500 local/\n    \u251c\u2500\u2500 __init__.py          # Aggregates JSON + Python prompts\n    \u251c\u2500\u2500 json_loader.py       # JSON prompt loader with Mustache support\n    \u251c\u2500\u2500 forseti_charter.json # Synced from Opik (chat format)\n    \u251c\u2500\u2500 forseti.py           # Legacy Python prompts (text format)\n    \u2514\u2500\u2500 autocontrib.py       # AutoContrib prompts (FR/EN)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(t.h3,{id:"get-prompt-registry",children:"Get Prompt Registry"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"from app.prompts import get_registry\n\nregistry = get_registry()\n\n# List all prompts\nprompts = registry.list_prompts()\n# ['autocontrib.draft_en', 'autocontrib.draft_fr', 'forseti.charter_validation', ...]\n"})}),"\n",(0,r.jsx)(t.h3,{id:"get-chat-messages-json-format",children:"Get Chat Messages (JSON Format)"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'# Get formatted messages for LLM chat API\nmessages = registry.get_messages(\n    "forseti.charter_validation",\n    title="My contribution title",\n    body="My contribution content",\n)\n# Returns: [{"role": "user", "content": "Validate a citizen contribution..."}]\n\n# Get system prompt\npersona = registry.get_prompt("forseti.persona")\nsystem_message = persona.messages[0]\n# {"role": "system", "content": "## Your Identity\\nYou are Forseti..."}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"format-text-prompt-python-format",children:"Format Text Prompt (Python Format)"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'# For text-based prompts with {var} format\nformatted = registry.format_prompt(\n    "autocontrib.draft_fr",\n    source_text="...",\n    category="economie",\n    category_desc="Commerce, tourisme...",\n    source_title_section=" - Document Title",\n)\n'})}),"\n",(0,r.jsx)(t.h3,{id:"check-prompt-metadata",children:"Check Prompt Metadata"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'info = registry.get_prompt("forseti.charter_validation")\nprint(f"Format: {info.format}")        # "chat"\nprint(f"Type: {info.type}")            # "user"\nprint(f"Opik name: {info.opik_name}")  # "foreseti461-user-charter-28012026"\nprint(f"Version: {info.version}")      # "ae49fab0"\nprint(f"Variables: {info.variables}")  # ["input.title", "input.body"]\n'})}),"\n",(0,r.jsx)(t.h2,{id:"cli-commands",children:"CLI Commands"}),"\n",(0,r.jsx)(t.h3,{id:"list-local-prompts",children:"List Local Prompts"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"python -m app.prompts.opik_sync --list\n"})}),"\n",(0,r.jsx)(t.h3,{id:"sync-to-opik",children:"Sync to Opik"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# Sync all prompts\npython -m app.prompts.opik_sync\n\n# Sync only Forseti prompts\npython -m app.prompts.opik_sync --prefix forseti.\n"})}),"\n",(0,r.jsx)(t.h3,{id:"compare-local-vs-opik",children:"Compare Local vs Opik"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"python -m app.prompts.opik_sync --compare\n"})}),"\n",(0,r.jsx)(t.h2,{id:"optimization",children:"Optimization"}),"\n",(0,r.jsx)(t.h3,{id:"run-prompt-optimization",children:"Run Prompt Optimization"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'from app.prompts import optimize_forseti_charter\n\nresult = optimize_forseti_charter(\n    dataset_name="forseti-charter-training",\n    optimizer_type="meta_prompt",  # or "few_shot_bayesian", "evolutionary"\n    num_iterations=50,\n)\n\nprint(f"Best score: {result.best_score:.2%}")\nprint(f"Optimized prompt saved to Opik")\n'})}),"\n",(0,r.jsx)(t.h3,{id:"available-optimizers",children:"Available Optimizers"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Optimizer"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"few_shot_bayesian"})}),(0,r.jsx)(t.td,{children:"Select best examples for few-shot prompts"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"meta_prompt"})}),(0,r.jsx)(t.td,{children:"LLM-generated prompt improvements"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"evolutionary"})}),(0,r.jsx)(t.td,{children:"Genetic algorithm for prompt evolution"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"migration-plan",children:"Migration Plan"}),"\n",(0,r.jsx)(t.h3,{id:"phase-1-consolidate--complete",children:"Phase 1: Consolidate \u2705 Complete"}),"\n",(0,r.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Identify all prompts (7 templates)"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Extract ",(0,r.jsx)(t.code,{children:"CATEGORY_DESCRIPTIONS"})," to shared location"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Create ",(0,r.jsx)(t.code,{children:"app/prompts/"})," module with local registry"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Update Forseti to use registry"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Update AutoContribution to use registry"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","17 tests passing"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"phase-2-opik-integration--complete",children:"Phase 2: Opik Integration \u2705 Complete"}),"\n",(0,r.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Install ",(0,r.jsx)(t.code,{children:"opik-optimizer"})," package"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Create ",(0,r.jsx)(t.code,{children:"opik_sync.py"})," for syncing prompts"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Create ",(0,r.jsx)(t.code,{children:"optimizer.py"})," for prompt optimization"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Add charter accuracy metric"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Access user's Opik prompts (",(0,r.jsx)(t.code,{children:"forseti461-*"}),")"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Sync Opik prompts to local JSON format"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Support chat format with Mustache variables"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Add ",(0,r.jsx)(t.code,{children:"get_messages()"})," method for chat API"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"phase-3-vaettir-mcp-future",children:"Phase 3: Vaettir MCP (Future)"}),"\n",(0,r.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Define MCP tools in Vaettir"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Create prompt sync between Opik \u2194 Vaettir"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Update registry to check MCP first"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Test with N8N workflows"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"phase-4-update-forseti-agent-next",children:"Phase 4: Update Forseti Agent (Next)"}),"\n",(0,r.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Update ",(0,r.jsx)(t.code,{children:"ForsetiAgent"})," to use ",(0,r.jsx)(t.code,{children:"registry.get_messages()"})]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Use chat format for validation calls"]}),"\n",(0,r.jsxs)(t.li,{className:"task-list-item",children:[(0,r.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Add system prompt from ",(0,r.jsx)(t.code,{children:"forseti.persona"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"variable-formats",children:"Variable Formats"}),"\n",(0,r.jsx)(t.p,{children:"The registry supports two variable formats:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Format"}),(0,r.jsx)(t.th,{children:"Syntax"}),(0,r.jsx)(t.th,{children:"Used By"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Mustache"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{{input.title}}"}),", ",(0,r.jsx)(t.code,{children:"{{var}}"})]}),(0,r.jsx)(t.td,{children:"JSON prompts (Opik)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Python"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"{title}"}),", ",(0,r.jsx)(t.code,{children:"{var}"})]}),(0,r.jsx)(t.td,{children:"Python prompts (legacy)"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["Both formats are handled transparently by ",(0,r.jsx)(t.code,{children:"format_prompt()"})," and ",(0,r.jsx)(t.code,{children:"get_messages()"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/fr/docs/app/FORSETI_AGENT",children:"FORSETI_AGENT.md"})," - Forseti agent features and how to add new features"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/fr/docs/app/AUTO_CONTRIBUTIONS",children:"AUTO_CONTRIBUTIONS.md"})," - Auto-contribution workflow using prompts"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"external-references",children:"External References"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://www.comet.com/docs/opik/prompt_engineering/prompt_management",children:"Opik Prompt Management"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://www.comet.com/docs/opik/agent_optimization/overview",children:"Opik Agent Optimizer"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://pypi.org/project/opik-optimizer/",children:"opik-optimizer PyPI"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,t,s){s.d(t,{R:()=>o,x:()=>c});var i=s(6540);const r={},n=i.createContext(r);function o(e){const t=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);