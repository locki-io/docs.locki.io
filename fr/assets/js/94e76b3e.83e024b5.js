"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[8100],{5771(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"orchestration/OBSERVABILITY","title":"Observability with Opik","description":"Guide to monitoring n8n workflows using Opik LLM observability platform.","source":"@site/docs/orchestration/OBSERVABILITY.md","sourceDirName":"orchestration","slug":"/orchestration/OBSERVABILITY","permalink":"/fr/docs/orchestration/OBSERVABILITY","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/orchestration/OBSERVABILITY.md","tags":[],"version":"current","frontMatter":{},"sidebar":"orchestrationSidebar","previous":{"title":"Port Management","permalink":"/fr/docs/orchestration/PORTS"},"next":{"title":"Troubleshooting Guide","permalink":"/fr/docs/orchestration/TROUBLESHOOTING"}}');var l=i(4848),r=i(8453);const t={},o="Observability with Opik",c={},d=[{value:"Overview",id:"overview",level:2},{value:"When to Use Opik",id:"when-to-use-opik",level:2},{value:"Enable in Production \u2713",id:"enable-in-production-",level:3},{value:"Skip in Local Dev \u2717",id:"skip-in-local-dev-",level:3},{value:"Setup Guide",id:"setup-guide",level:2},{value:"Step 1: Create Opik Account",id:"step-1-create-opik-account",level:3},{value:"Step 2: Get API Key",id:"step-2-get-api-key",level:3},{value:"Step 3: Create Workspace",id:"step-3-create-workspace",level:3},{value:"Step 4: Configure Environment",id:"step-4-configure-environment",level:3},{value:"Step 5: Restart n8n",id:"step-5-restart-n8n",level:3},{value:"Step 6: Verify Integration",id:"step-6-verify-integration",level:3},{value:"What Gets Traced",id:"what-gets-traced",level:2},{value:"Workflow Executions",id:"workflow-executions",level:3},{value:"LLM Calls",id:"llm-calls",level:3},{value:"Metadata",id:"metadata",level:3},{value:"Using the Opik Dashboard",id:"using-the-opik-dashboard",level:2},{value:"View Traces",id:"view-traces",level:3},{value:"Analyze Performance",id:"analyze-performance",level:3},{value:"Debug Errors",id:"debug-errors",level:3},{value:"Custom Annotations",id:"custom-annotations",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Service Name",id:"service-name",level:3},{value:"Sampling",id:"sampling",level:3},{value:"Data Privacy",id:"data-privacy",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Traces not appearing",id:"traces-not-appearing",level:3},{value:"n8n fails to start",id:"n8n-fails-to-start",level:3},{value:"Partial traces",id:"partial-traces",level:3},{value:"High costs",id:"high-costs",level:3},{value:"Data retention",id:"data-retention",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Tag Workflows",id:"1-tag-workflows",level:3},{value:"2. Set Alerts",id:"2-set-alerts",level:3},{value:"3. Regular Review",id:"3-regular-review",level:3},{value:"4. Cost Monitoring",id:"4-cost-monitoring",level:3},{value:"5. Privacy Compliance",id:"5-privacy-compliance",level:3},{value:"Integration with Other Tools",id:"integration-with-other-tools",level:2},{value:"Grafana",id:"grafana",level:3},{value:"Slack Notifications",id:"slack-notifications",level:3},{value:"PagerDuty",id:"pagerduty",level:3},{value:"Self-Hosted Opik",id:"self-hosted-opik",level:2},{value:"Install Opik Locally",id:"install-opik-locally",level:3},{value:"Configure n8n",id:"configure-n8n",level:3},{value:"Benefits",id:"benefits",level:3},{value:"Drawbacks",id:"drawbacks",level:3},{value:"Advanced: Custom Metrics",id:"advanced-custom-metrics",level:2},{value:"Disabling Observability",id:"disabling-observability",level:2},{value:"Temporary",id:"temporary",level:3},{value:"Permanent",id:"permanent",level:3},{value:"Comparison: Observability Options",id:"comparison-observability-options",level:2},{value:"Resources",id:"resources",level:2},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"observability-with-opik",children:"Observability with Opik"})}),"\n",(0,l.jsx)(n.p,{children:"Guide to monitoring n8n workflows using Opik LLM observability platform."}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.p,{children:"Opik provides tracing and monitoring for LLM applications and workflows. When integrated with n8n, it captures:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Workflow executions"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 LLM API calls (OpenAI, Anthropic, etc.)"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Performance metrics"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Error traces"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Cost tracking"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Custom annotations"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"when-to-use-opik",children:"When to Use Opik"}),"\n",(0,l.jsx)(n.h3,{id:"enable-in-production-",children:"Enable in Production \u2713"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Monitor real workflow performance"}),"\n",(0,l.jsx)(n.li,{children:"Track LLM costs and usage"}),"\n",(0,l.jsx)(n.li,{children:"Debug production issues"}),"\n",(0,l.jsx)(n.li,{children:"Analyze execution patterns"}),"\n",(0,l.jsx)(n.li,{children:"Compliance and auditing"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"skip-in-local-dev-",children:"Skip in Local Dev \u2717"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Adds unnecessary overhead"}),"\n",(0,l.jsx)(n.li,{children:"Creates noise in traces"}),"\n",(0,l.jsx)(n.li,{children:"Costs API calls for testing"}),"\n",(0,l.jsxs)(n.li,{children:["Local logs are sufficient (",(0,l.jsx)(n.code,{children:"docker compose logs"}),")"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Recommendation"}),": Enable only on production server."]}),"\n",(0,l.jsx)(n.h2,{id:"setup-guide",children:"Setup Guide"}),"\n",(0,l.jsx)(n.h3,{id:"step-1-create-opik-account",children:"Step 1: Create Opik Account"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Go to ",(0,l.jsx)(n.a,{href:"https://www.comet.com/signup?product=opik",children:"https://www.comet.com/signup?product=opik"})]}),"\n",(0,l.jsx)(n.li,{children:"Sign up (free tier available)"}),"\n",(0,l.jsx)(n.li,{children:"Verify email"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"step-2-get-api-key",children:"Step 2: Get API Key"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Log in to Comet"}),"\n",(0,l.jsx)(n.li,{children:"Go to Settings \u2192 API Keys"}),"\n",(0,l.jsx)(n.li,{children:"Create new API key for n8n"}),"\n",(0,l.jsxs)(n.li,{children:["Copy the key (starts with ",(0,l.jsx)(n.code,{children:"MC."}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"step-3-create-workspace",children:"Step 3: Create Workspace"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"In Comet dashboard: Create workspace"}),"\n",(0,l.jsxs)(n.li,{children:["Name it (e.g., ",(0,l.jsx)(n.code,{children:"vaettir-production"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Note the workspace name"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"step-4-configure-environment",children:"Step 4: Configure Environment"}),"\n",(0,l.jsxs)(n.p,{children:["On your ",(0,l.jsx)(n.strong,{children:"production server"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh user@your-server\ncd ~/vaettir\nnano .env\n"})}),"\n",(0,l.jsx)(n.p,{children:"Add these lines:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Opik Observability\nOPIK_API_KEY=MC.your_actual_api_key_here\nOPIK_WORKSPACE=vaettir-production\nOTEL_EXPORTER_OTLP_ENDPOINT=https://www.comet.com/opik/api/v1/private/otel\nOTEL_EXPORTER_OTLP_HEADERS=Authorization=${OPIK_API_KEY},Comet-Workspace=${OPIK_WORKSPACE}\nN8N_OTEL_SERVICE_NAME=vaettir-n8n-prod\nEXTERNAL_HOOK_FILES=/opt/nodejs/node-v22.21.1/lib/node_modules/n8n-observability/dist/hooks.cjs\n"})}),"\n",(0,l.jsx)(n.h3,{id:"step-5-restart-n8n",children:"Step 5: Restart n8n"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker compose restart n8n\n\n# Check logs for errors\ndocker compose logs -f n8n\n"})}),"\n",(0,l.jsx)(n.p,{children:"Look for:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"External hooks init complete\n"})}),"\n",(0,l.jsx)(n.h3,{id:"step-6-verify-integration",children:"Step 6: Verify Integration"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Execute a workflow in n8n"}),"\n",(0,l.jsx)(n.li,{children:"Go to Opik dashboard"}),"\n",(0,l.jsx)(n.li,{children:"Navigate to Traces"}),"\n",(0,l.jsx)(n.li,{children:"You should see the execution appear"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"what-gets-traced",children:"What Gets Traced"}),"\n",(0,l.jsx)(n.h3,{id:"workflow-executions",children:"Workflow Executions"}),"\n",(0,l.jsx)(n.p,{children:"Every workflow execution creates a trace:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Trace: workflow_execution_1234\n  \u251c\u2500 Span: Webhook Trigger\n  \u251c\u2500 Span: HTTP Request Node\n  \u251c\u2500 Span: Code Node (Python)\n  \u251c\u2500 Span: AI Agent\n  \u2502   \u251c\u2500 Span: OpenAI API Call\n  \u2502   \u2514\u2500 Span: Response Processing\n  \u2514\u2500 Span: Send Email\n"})}),"\n",(0,l.jsx)(n.h3,{id:"llm-calls",children:"LLM Calls"}),"\n",(0,l.jsx)(n.p,{children:"AI nodes automatically traced:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Model used (gpt-4, claude-3, etc.)"}),"\n",(0,l.jsx)(n.li,{children:"Prompt content"}),"\n",(0,l.jsx)(n.li,{children:"Response content"}),"\n",(0,l.jsx)(n.li,{children:"Token usage"}),"\n",(0,l.jsx)(n.li,{children:"Latency"}),"\n",(0,l.jsx)(n.li,{children:"Cost (estimated)"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"metadata",children:"Metadata"}),"\n",(0,l.jsx)(n.p,{children:"Each trace includes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Workflow name and ID"}),"\n",(0,l.jsx)(n.li,{children:"Execution ID"}),"\n",(0,l.jsx)(n.li,{children:"Start/end time"}),"\n",(0,l.jsx)(n.li,{children:"Success/failure status"}),"\n",(0,l.jsx)(n.li,{children:"Error messages (if failed)"}),"\n",(0,l.jsx)(n.li,{children:"User who triggered (if applicable)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"using-the-opik-dashboard",children:"Using the Opik Dashboard"}),"\n",(0,l.jsx)(n.h3,{id:"view-traces",children:"View Traces"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Go to ",(0,l.jsx)(n.a,{href:"https://www.comet.com/workspace/opik",children:"https://www.comet.com/workspace/opik"})]}),"\n",(0,l.jsx)(n.li,{children:'Click "Traces" in sidebar'}),"\n",(0,l.jsx)(n.li,{children:"See all workflow executions"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Filters"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Time range"}),"\n",(0,l.jsx)(n.li,{children:"Workflow name"}),"\n",(0,l.jsx)(n.li,{children:"Success/failure"}),"\n",(0,l.jsx)(n.li,{children:"Duration"}),"\n",(0,l.jsx)(n.li,{children:"Custom tags"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"analyze-performance",children:"Analyze Performance"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Latency view"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"See slowest nodes"}),"\n",(0,l.jsx)(n.li,{children:"Identify bottlenecks"}),"\n",(0,l.jsx)(n.li,{children:"Compare execution times"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Cost view"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"LLM token usage"}),"\n",(0,l.jsx)(n.li,{children:"Estimated costs"}),"\n",(0,l.jsx)(n.li,{children:"Cost trends over time"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"debug-errors",children:"Debug Errors"}),"\n",(0,l.jsx)(n.p,{children:"When workflow fails:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Find trace in Opik"}),"\n",(0,l.jsx)(n.li,{children:"Click to expand"}),"\n",(0,l.jsx)(n.li,{children:"See exact error location"}),"\n",(0,l.jsx)(n.li,{children:"View full error message"}),"\n",(0,l.jsx)(n.li,{children:"Inspect input/output data"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"custom-annotations",children:"Custom Annotations"}),"\n",(0,l.jsx)(n.p,{children:"Add metadata to traces from workflows:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# In Code node\nimport os\n\n# Add custom metadata (if supported by n8n-observability)\n# This appears in Opik trace\nmetadata = {\n    "user_id": "123",\n    "feature": "content_moderation",\n    "version": "1.2.3"\n}\n\n# Your workflow logic\nresult = process_data(input_data)\n\nreturn [{\n    "json": {\n        "result": result,\n        "metadata": metadata\n    }\n}]\n'})}),"\n",(0,l.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,l.jsx)(n.h3,{id:"service-name",children:"Service Name"}),"\n",(0,l.jsx)(n.p,{children:"Identifies your n8n instance in Opik:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"N8N_OTEL_SERVICE_NAME=vaettir-n8n-prod\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Use different names"})," for multiple environments:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"vaettir-n8n-prod"})," - Production"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"vaettir-n8n-staging"})," - Staging"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"vaettir-n8n-dev"})," - Development (if you enable it)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sampling",children:"Sampling"}),"\n",(0,l.jsx)(n.p,{children:"To reduce costs, sample traces (only send subset):"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note"}),": n8n-observability may not support sampling yet. Check docs."]}),"\n",(0,l.jsx)(n.p,{children:"If available, add to .env:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"OTEL_TRACES_SAMPLER=traceidratio\nOTEL_TRACES_SAMPLER_ARG=0.1  # 10% sampling\n"})}),"\n",(0,l.jsx)(n.h3,{id:"data-privacy",children:"Data Privacy"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Sensitive data handling"}),":"]}),"\n",(0,l.jsx)(n.p,{children:"Opik receives:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Workflow structure"}),"\n",(0,l.jsx)(n.li,{children:"Node configurations"}),"\n",(0,l.jsx)(n.li,{children:"Input/output data"}),"\n",(0,l.jsx)(n.li,{children:"LLM prompts/responses"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"To protect sensitive data"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Don't trace sensitive workflows"}),": Disable for PII-heavy flows"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Sanitize in code nodes"}),": Remove sensitive fields before processing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use self-hosted Opik"}),": Deploy Opik on your infrastructure"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Self-hosted Opik"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:5173/api/v1/private/otel\n# No Authorization header needed for self-hosted\n"})}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"traces-not-appearing",children:"Traces not appearing"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Check n8n logs"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker compose logs n8n | grep -i opik\ndocker compose logs n8n | grep -i otel\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Verify configuration"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker compose exec n8n env | grep OPIK\ndocker compose exec n8n env | grep OTEL\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Common issues"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"EXTERNAL_HOOK_FILES"})," not set correctly"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OPIK_API_KEY"})," missing or invalid"]}),"\n",(0,l.jsx)(n.li,{children:"n8n-observability not installed (check Dockerfile.n8n)"}),"\n",(0,l.jsx)(n.li,{children:"Network issues reaching Comet API"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"n8n-fails-to-start",children:"n8n fails to start"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Error"}),": ",(0,l.jsx)(n.code,{children:"Problem loading external hook file"})," or ",(0,l.jsx)(n.code,{children:"Cannot find module '/usr/local/lib/node_modules/n8n-observability/dist/hooks.cjs'"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Cause"}),": n8n-observability not installed or ",(0,l.jsx)(n.code,{children:"EXTERNAL_HOOK_FILES"})," path incorrect"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Fix"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Option 1: Verify the correct installation path\ndocker run --rm vaettir/n8n:latest npm list -g n8n-observability\n# Should show: /opt/nodejs/node-v22.21.1/lib\n\n# Update .env with correct path\nnano .env\n# Set: EXTERNAL_HOOK_FILES=/opt/nodejs/node-v22.21.1/lib/node_modules/n8n-observability/dist/hooks.cjs\ndocker compose restart n8n\n\n# Option 2: Disable observability temporarily\nnano .env\n# Comment out all OPIK/OTEL variables including EXTERNAL_HOOK_FILES\n\n# Option 3: Rebuild if package not installed\ndocker compose build n8n --no-cache\ndocker compose up -d\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Important"}),": The n8n-observability package installs to ",(0,l.jsx)(n.code,{children:"/opt/nodejs/node-v22.21.1/lib/node_modules/"})," in the official n8n Docker image, not ",(0,l.jsx)(n.code,{children:"/usr/local/lib/node_modules/"}),". Always verify the installation path matches your ",(0,l.jsx)(n.code,{children:"EXTERNAL_HOOK_FILES"})," setting."]}),"\n",(0,l.jsx)(n.h3,{id:"partial-traces",children:"Partial traces"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Symptom"}),": Some nodes missing from traces"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Causes"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Node type not supported by n8n-observability"}),"\n",(0,l.jsx)(n.li,{children:"Error in node (execution stopped)"}),"\n",(0,l.jsx)(n.li,{children:"Async nodes not waited for"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Investigation"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Check n8n logs for errors"}),"\n",(0,l.jsx)(n.li,{children:"Verify all nodes executed successfully"}),"\n",(0,l.jsx)(n.li,{children:"Check Opik for partial traces (better than nothing)"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"high-costs",children:"High costs"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Problem"}),": Too many traces, high Opik bill"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Sample traces"}),": Only send percentage"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Filter workflows"}),": Only trace important ones"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Disable for high-volume"}),": Skip simple/frequent workflows"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Self-host Opik"}),": No per-trace costs"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"data-retention",children:"Data retention"}),"\n",(0,l.jsx)(n.p,{children:"Opik retains traces based on plan:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Free: 30 days"}),"\n",(0,l.jsx)(n.li,{children:"Paid: Longer (check plan)"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"For longer retention"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Export traces periodically"}),"\n",(0,l.jsx)(n.li,{children:"Use self-hosted Opik"}),"\n",(0,l.jsx)(n.li,{children:"Store critical traces separately"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"1-tag-workflows",children:"1. Tag Workflows"}),"\n",(0,l.jsx)(n.p,{children:"Add meaningful tags to workflows:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Environment (prod, staging)"}),"\n",(0,l.jsx)(n.li,{children:"Feature area (moderation, notifications)"}),"\n",(0,l.jsx)(n.li,{children:"Criticality (critical, normal, low)"}),"\n",(0,l.jsx)(n.li,{children:"Owner (team name)"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Helps filtering in Opik."}),"\n",(0,l.jsx)(n.h3,{id:"2-set-alerts",children:"2. Set Alerts"}),"\n",(0,l.jsx)(n.p,{children:"In Opik dashboard:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Alert on high error rate"}),"\n",(0,l.jsx)(n.li,{children:"Alert on slow executions"}),"\n",(0,l.jsx)(n.li,{children:"Alert on high costs"}),"\n",(0,l.jsx)(n.li,{children:"Send to Slack/email"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-regular-review",children:"3. Regular Review"}),"\n",(0,l.jsx)(n.p,{children:"Weekly:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Check error trends"}),"\n",(0,l.jsx)(n.li,{children:"Identify slow workflows"}),"\n",(0,l.jsx)(n.li,{children:"Review LLM costs"}),"\n",(0,l.jsx)(n.li,{children:"Optimize bottlenecks"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-cost-monitoring",children:"4. Cost Monitoring"}),"\n",(0,l.jsx)(n.p,{children:"Set budgets:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Daily LLM spend limit"}),"\n",(0,l.jsx)(n.li,{children:"Alert when approaching"}),"\n",(0,l.jsx)(n.li,{children:"Review biggest cost drivers"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"5-privacy-compliance",children:"5. Privacy Compliance"}),"\n",(0,l.jsx)(n.p,{children:"Document:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"What data is sent to Opik"}),"\n",(0,l.jsx)(n.li,{children:"How long it's retained"}),"\n",(0,l.jsx)(n.li,{children:"Who has access"}),"\n",(0,l.jsx)(n.li,{children:"GDPR/compliance notes"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"integration-with-other-tools",children:"Integration with Other Tools"}),"\n",(0,l.jsx)(n.h3,{id:"grafana",children:"Grafana"}),"\n",(0,l.jsx)(n.p,{children:"Export Opik metrics to Grafana for custom dashboards."}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Setup"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Use Opik API to fetch metrics"}),"\n",(0,l.jsx)(n.li,{children:"Create Grafana dashboard"}),"\n",(0,l.jsx)(n.li,{children:"Display alongside other metrics"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"slack-notifications",children:"Slack Notifications"}),"\n",(0,l.jsx)(n.p,{children:"Get alerts in Slack:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Opik \u2192 Settings \u2192 Integrations"}),"\n",(0,l.jsx)(n.li,{children:"Connect Slack"}),"\n",(0,l.jsx)(n.li,{children:"Configure alert rules"}),"\n",(0,l.jsx)(n.li,{children:"Get notified of failures/anomalies"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"pagerduty",children:"PagerDuty"}),"\n",(0,l.jsx)(n.p,{children:"For critical alerts:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Opik \u2192 Integrations \u2192 PagerDuty"}),"\n",(0,l.jsx)(n.li,{children:"Connect account"}),"\n",(0,l.jsx)(n.li,{children:"Set up critical workflow alerts"}),"\n",(0,l.jsx)(n.li,{children:"On-call team gets paged"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"self-hosted-opik",children:"Self-Hosted Opik"}),"\n",(0,l.jsx)(n.p,{children:"For full control and privacy:"}),"\n",(0,l.jsx)(n.h3,{id:"install-opik-locally",children:"Install Opik Locally"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Using Docker Compose\ngit clone https://github.com/comet-ml/opik\ncd opik/deployment/docker-compose\n\n# Start Opik\ndocker compose up -d\n\n# Access at http://localhost:5173\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configure-n8n",children:"Configure n8n"}),"\n",(0,l.jsxs)(n.p,{children:["Update ",(0,l.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"OTEL_EXPORTER_OTLP_ENDPOINT=http://opik:5173/api/v1/private/otel\n# Remove OTEL_EXPORTER_OTLP_HEADERS (no auth needed)\nN8N_OTEL_SERVICE_NAME=vaettir-n8n\nEXTERNAL_HOOK_FILES=/usr/local/lib/node_modules/n8n-observability/dist/hooks.cjs\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Add Opik to ",(0,l.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'services:\n  opik:\n    image: ghcr.io/comet-ml/opik:latest\n    ports:\n      - "5173:5173"\n    volumes:\n      - opik_data:/data\n'})}),"\n",(0,l.jsx)(n.h3,{id:"benefits",children:"Benefits"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 No external API calls"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Full data control"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Unlimited retention"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 No per-trace costs"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 GDPR compliance easier"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"drawbacks",children:"Drawbacks"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u274c Self-managed infrastructure"}),"\n",(0,l.jsx)(n.li,{children:"\u274c No automatic updates"}),"\n",(0,l.jsx)(n.li,{children:"\u274c Need to monitor Opik itself"}),"\n",(0,l.jsx)(n.li,{children:"\u274c More complex setup"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"advanced-custom-metrics",children:"Advanced: Custom Metrics"}),"\n",(0,l.jsx)(n.p,{children:"Beyond automatic tracing, send custom metrics:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'# In Code node (example - check n8n-observability API)\nfrom opentelemetry import metrics\n\nmeter = metrics.get_meter("n8n.workflow")\ncounter = meter.create_counter("custom_metric")\n\n# Increment\ncounter.add(1, {"workflow": "moderation", "result": "flagged"})\n'})}),"\n",(0,l.jsx)(n.p,{children:"View in Opik metrics dashboard."}),"\n",(0,l.jsx)(n.h2,{id:"disabling-observability",children:"Disabling Observability"}),"\n",(0,l.jsx)(n.p,{children:"To turn off Opik:"}),"\n",(0,l.jsx)(n.h3,{id:"temporary",children:"Temporary"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Comment out in .env\n# OPIK_API_KEY=...\n# EXTERNAL_HOOK_FILES=...\n\n# Restart\ndocker compose restart n8n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"permanent",children:"Permanent"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Remove from .env entirely\nnano .env\n# Delete all OPIK/OTEL lines\n\n# Remove from docker-compose.yml if you want\n# (Already optional - safe to leave)\n\n# Restart\ndocker compose restart n8n\n"})}),"\n",(0,l.jsx)(n.h2,{id:"comparison-observability-options",children:"Comparison: Observability Options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Feature"}),(0,l.jsx)(n.th,{children:"Opik Cloud"}),(0,l.jsx)(n.th,{children:"Opik Self-Hosted"}),(0,l.jsx)(n.th,{children:"n8n Logs"}),(0,l.jsx)(n.th,{children:"Alternatives"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Setup"}),(0,l.jsx)(n.td,{children:"Easy"}),(0,l.jsx)(n.td,{children:"Medium"}),(0,l.jsx)(n.td,{children:"None"}),(0,l.jsx)(n.td,{children:"Varies"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cost"}),(0,l.jsx)(n.td,{children:"Per-trace"}),(0,l.jsx)(n.td,{children:"Infrastructure"}),(0,l.jsx)(n.td,{children:"Free"}),(0,l.jsx)(n.td,{children:"Varies"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"LLM tracking"}),(0,l.jsx)(n.td,{children:"\u2705 Native"}),(0,l.jsx)(n.td,{children:"\u2705 Native"}),(0,l.jsx)(n.td,{children:"\u274c"}),(0,l.jsx)(n.td,{children:"Some"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Visualization"}),(0,l.jsx)(n.td,{children:"\u2705 Rich"}),(0,l.jsx)(n.td,{children:"\u2705 Rich"}),(0,l.jsx)(n.td,{children:"\u274c Basic"}),(0,l.jsx)(n.td,{children:"\u2705 Varies"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Privacy"}),(0,l.jsx)(n.td,{children:"Cloud"}),(0,l.jsx)(n.td,{children:"\u2705 Full control"}),(0,l.jsx)(n.td,{children:"\u2705 Local"}),(0,l.jsx)(n.td,{children:"Varies"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Retention"}),(0,l.jsx)(n.td,{children:"30d (free)"}),(0,l.jsx)(n.td,{children:"\u2705 Unlimited"}),(0,l.jsx)(n.td,{children:"Until rotation"}),(0,l.jsx)(n.td,{children:"Varies"})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Alternatives"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Datadog APM"}),"\n",(0,l.jsx)(n.li,{children:"New Relic"}),"\n",(0,l.jsx)(n.li,{children:"Honeycomb"}),"\n",(0,l.jsx)(n.li,{children:"Jaeger (self-hosted)"}),"\n",(0,l.jsx)(n.li,{children:"Zipkin (self-hosted)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Opik Documentation"}),": ",(0,l.jsx)(n.a,{href:"https://www.comet.com/docs/opik",children:"https://www.comet.com/docs/opik"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"n8n-observability GitHub"}),": ",(0,l.jsx)(n.a,{href:"https://github.com/comet-ml/n8n-observability",children:"https://github.com/comet-ml/n8n-observability"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"n8n Integrations"}),": ",(0,l.jsx)(n.a,{href:"https://docs.n8n.io/integrations/",children:"https://docs.n8n.io/integrations/"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"OpenTelemetry Docs"}),": ",(0,l.jsx)(n.a,{href:"https://opentelemetry.io/docs/",children:"https://opentelemetry.io/docs/"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/fr/docs/orchestration/SETUP",children:"Setup Guide"})," - Configure Opik integration"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/fr/docs/orchestration/TROUBLESHOOTING",children:"Troubleshooting"})," - Debug issues"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/fr/docs/orchestration/WORKFLOWS",children:"Workflows"})," - Build traceable workflows"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>t,x:()=>o});var s=i(6540);const l={},r=s.createContext(l);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);