"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[6515],{1353(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"app/scheduler/tasks/TASK_AUDIERNE_DOCS","title":"Task: Audierne Docs Processing","description":"File: app/services/tasks/taskaudiernedocs.py","source":"@site/docs/app/scheduler/tasks/TASK_AUDIERNE_DOCS.md","sourceDirName":"app/scheduler/tasks","slug":"/app/scheduler/tasks/TASK_AUDIERNE_DOCS","permalink":"/fr/docs/app/scheduler/tasks/TASK_AUDIERNE_DOCS","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/app/scheduler/tasks/TASK_AUDIERNE_DOCS.md","tags":[],"version":"current","frontMatter":{}}');var r=s(4848),l=s(8453);const d={},t="Task: Audierne Docs Processing",c={},o=[{value:"Purpose",id:"purpose",level:2},{value:"What It Does",id:"what-it-does",level:2},{value:"Documents",id:"documents",level:2},{value:"Progress Tracking",id:"progress-tracking",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Failover Behavior",id:"failover-behavior",level:2},{value:"Manual Run",id:"manual-run",level:2},{value:"Success Keys",id:"success-keys",level:2},{value:"Output",id:"output",level:2},{value:"Workflow Integration",id:"workflow-integration",level:2},{value:"Related",id:"related",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"task-audierne-docs-processing",children:"Task: Audierne Docs Processing"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File:"})," ",(0,r.jsx)(n.code,{children:"app/services/tasks/task_audierne_docs.py"}),"\n",(0,r.jsx)(n.strong,{children:"Schedule:"})," ",(0,r.jsx)(n.code,{children:"0 */2 * * *"})," (Every 2 hours - dev mode)\n",(0,r.jsx)(n.strong,{children:"LLM Provider:"})," Ollama (default) with gemini failover\n",(0,r.jsx)(n.strong,{children:"Resource Lock:"})," ",(0,r.jsx)(n.code,{children:"lock:ollama:global"})," (TTL: 600s)"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsx)(n.p,{children:"Processes audierne2026 markdown documents to build training datasets for Forseti prompt optimization. Designed for continuous improvement of charter validation."}),"\n",(0,r.jsx)(n.h2,{id:"what-it-does",children:"What It Does"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Reads Progress File"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Checks ",(0,r.jsx)(n.code,{children:"docs/docs/audierne2026/PROCESSING_PROGRESS.md"})]}),"\n",(0,r.jsx)(n.li,{children:"Identifies next unprocessed document"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Acquires Ollama Lock"})," (if using Ollama)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prevents concurrent Ollama usage with other tasks"}),"\n",(0,r.jsx)(n.li,{children:"TTL: 600 seconds (10 minutes)"}),"\n",(0,r.jsx)(n.li,{children:"Falls back to gemini if lock unavailable"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Processes One Document"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Extracts themes using LLM (chunked for large docs: 15k chars, 500 overlap)"}),"\n",(0,r.jsx)(n.li,{children:"Generates contributions (2 per theme by default)"}),"\n",(0,r.jsx)(n.li,{children:"Includes violation examples for testing"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Creates Opik Dataset"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Dataset name: ",(0,r.jsx)(n.code,{children:"audierne-{filename}-{date}"})]}),"\n",(0,r.jsx)(n.li,{children:"Contains input/output pairs for optimization"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Updates Progress"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Marks document as complete"}),"\n",(0,r.jsx)(n.li,{children:"Logs themes, contributions, dataset name"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Releases Ollama Lock"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Always releases in finally block"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"documents",children:"Documents"}),"\n",(0,r.jsxs)(n.p,{children:["Located in ",(0,r.jsx)(n.code,{children:"docs/docs/audierne2026/"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"File"}),(0,r.jsx)(n.th,{children:"Size"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mayor-2026-wishes.md"}),(0,r.jsx)(n.td,{children:"21KB"}),(0,r.jsx)(n.td,{children:"Mayor's New Year speech"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"municipal-council-january2026.md"}),(0,r.jsx)(n.td,{children:"22KB"}),(0,r.jsx)(n.td,{children:"Council meeting minutes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"MVP_meeting.md"}),(0,r.jsx)(n.td,{children:"13KB"}),(0,r.jsx)(n.td,{children:"MVP planning meeting"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"MVP-meeting-satellite.md"}),(0,r.jsx)(n.td,{children:"11KB"}),(0,r.jsx)(n.td,{children:"Satellite meeting notes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"overview.md"}),(0,r.jsx)(n.td,{children:"6KB"}),(0,r.jsx)(n.td,{children:"Project overview"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"progress-tracking",children:"Progress Tracking"}),"\n",(0,r.jsxs)(n.p,{children:["Progress file: ",(0,r.jsx)(n.code,{children:"docs/docs/audierne2026/PROCESSING_PROGRESS.md"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"| File | Status | Processed At | Themes | Contributions | Dataset |\n|------|--------|--------------|--------|---------------|---------|\n| MVP-meeting-satellite.md | \u2705 Done | 2026-02-06 11:29 | 3 | 12 | audierne-MVP-meeting-satellite-20260206 |\n| MVP_meeting.md | \u23f3 Pending | - | - | - | - |\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Default settings in task file\nDEFAULT_PROVIDER = "ollama"\nFALLBACK_PROVIDER = "gemini"     # Used when Ollama unavailable\nCONTRIBUTIONS_PER_THEME = 2\nINCLUDE_VIOLATIONS = True\nOLLAMA_LOCK_TTL = 600            # 10 minutes\n'})}),"\n",(0,r.jsx)(n.h2,{id:"failover-behavior",children:"Failover Behavior"}),"\n",(0,r.jsx)(n.p,{children:"When Ollama is unavailable or locked by another task:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Task checks ",(0,r.jsx)(n.code,{children:"lock:ollama:global"})," in Redis"]}),"\n",(0,r.jsx)(n.li,{children:"If locked \u2192 automatically uses gemini instead"}),"\n",(0,r.jsxs)(n.li,{children:["Result includes ",(0,r.jsx)(n.code,{children:"provider_used"})," to show actual provider"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Task result with failover\n{\n    "status": "success",\n    "provider_used": "gemini",  # Failover occurred\n    "warnings": ["Ollama busy, using gemini"]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Disable Failover:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Force Ollama only (will skip if locked)\nresult = task_audierne_docs(\n    provider="ollama",\n    enable_failover=False\n)\n# Returns status="skipped", reason="ollama_locked" if busy\n'})}),"\n",(0,r.jsx)(n.h2,{id:"manual-run",children:"Manual Run"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Run next pending document\npython -c \"from app.services.scheduler import run_task_now; print(run_task_now('task_audierne_docs'))\"\n\n# Force specific document\npython -c \"\nfrom app.services.tasks.task_audierne_docs import task_audierne_docs\nresult = task_audierne_docs(force_doc='Mayor-2026-wishes.md')\nprint(result)\n\"\n"})}),"\n",(0,r.jsx)(n.h2,{id:"success-keys",children:"Success Keys"}),"\n",(0,r.jsxs)(n.p,{children:["Note: Uses ",(0,r.jsx)(n.code,{children:"skip_success_check=True"})," to allow multiple runs per day (one doc at a time)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"success:task_audierne_docs:YYYYMMDD  # Set when ALL docs are processed\n"})}),"\n",(0,r.jsx)(n.h2,{id:"output",children:"Output"}),"\n",(0,r.jsx)(n.p,{children:"Each run produces:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Opik Dataset"}),": ",(0,r.jsx)(n.code,{children:"audierne-{filename}-{date}"})," with training data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Progress Update"}),": Markdown table with status"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redis Storage"}),": Contributions stored for validation testing"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"workflow-integration",children:"Workflow Integration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Continuous Improvement Loop                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  task_audierne_docs (every 2h)                                  \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  Generate contributions from real docs                          \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  Create Opik dataset                                            \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  task_opik_evaluate (every 30min)                               \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  Evaluate Forseti accuracy                                      \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  Opik Optimizer                                                 \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  Improved prompts                                               \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  task_prompt_sync (midnight)                                    \u2502\n\u2502        \u2193                                                        \u2502\n\u2502  Updated prompts in production                                  \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/fr/docs/app/MOCKUP",children:"Mockup System"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/fr/docs/app/FIELD_INPUT_WORKFLOW",children:"Field Input Workflow"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"../../opik/",children:"Opik Integration"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function d(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);