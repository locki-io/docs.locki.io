"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[3969],{7765(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"orchestration/DEVELOPMENT","title":"Development Workflow","description":"Guide to developing external services locally while testing against production n8n using the proxy pattern.","source":"@site/docs/orchestration/DEVELOPMENT.md","sourceDirName":"orchestration","slug":"/orchestration/DEVELOPMENT","permalink":"/fr/docs/orchestration/DEVELOPMENT","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/orchestration/DEVELOPMENT.md","tags":[],"version":"current","frontMatter":{},"sidebar":"orchestrationSidebar","previous":{"title":"Vaettir Setup Guide","permalink":"/fr/docs/orchestration/SETUP"},"next":{"title":"USAGE","permalink":"/fr/docs/orchestration/USAGE"}}');var o=r(4848),i=r(8453);const l={},t="Development Workflow",c={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Benefits",id:"benefits",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup Guide",id:"setup-guide",level:2},{value:"Step 1: Install ngrok",id:"step-1-install-ngrok",level:3},{value:"Step 2: Authenticate ngrok",id:"step-2-authenticate-ngrok",level:3},{value:"Step 3: Run Your Service Locally",id:"step-3-run-your-service-locally",level:3},{value:"Step 4: Create ngrok Tunnel",id:"step-4-create-ngrok-tunnel",level:3},{value:"Step 5: Configure Production Server",id:"step-5-configure-production-server",level:3},{value:"Step 6: Start Proxy Service",id:"step-6-start-proxy-service",level:3},{value:"Step 7: Test the Connection",id:"step-7-test-the-connection",level:3},{value:"Step 8: Update n8n Workflows",id:"step-8-update-n8n-workflows",level:3},{value:"Daily Development Workflow",id:"daily-development-workflow",level:2},{value:"Morning Setup",id:"morning-setup",level:3},{value:"During Development",id:"during-development",level:3},{value:"Managing the Proxy",id:"managing-the-proxy",level:3},{value:"Evening Cleanup (Optional)",id:"evening-cleanup-optional",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Persistent Subdomain",id:"persistent-subdomain",level:3},{value:"IP Whitelisting",id:"ip-whitelisting",level:3},{value:"Traffic Inspection",id:"traffic-inspection",level:3},{value:"Adding More Services",id:"adding-more-services",level:2},{value:"1. Create Proxy Config Template",id:"1-create-proxy-config-template",level:3},{value:"2. Add Service to docker-compose.yml",id:"2-add-service-to-docker-composeyml",level:3},{value:"3. Update Dockerfile.proxy (if needed)",id:"3-update-dockerfileproxy-if-needed",level:3},{value:"4. Configure and Start",id:"4-configure-and-start",level:3},{value:"5. Use in n8n",id:"5-use-in-n8n",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"ngrok tunnel not reachable from server",id:"ngrok-tunnel-not-reachable-from-server",level:3},{value:"Proxy returns 502 Bad Gateway",id:"proxy-returns-502-bad-gateway",level:3},{value:"n8n can&#39;t resolve service name",id:"n8n-cant-resolve-service-name",level:3},{value:"Slow response times",id:"slow-response-times",level:3},{value:"Local service not receiving requests",id:"local-service-not-receiving-requests",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Security",id:"security",level:3},{value:"Performance",id:"performance",level:3},{value:"Workflow",id:"workflow",level:3},{value:"Alternatives to ngrok",id:"alternatives-to-ngrok",level:2},{value:"Cloudflare Tunnel",id:"cloudflare-tunnel",level:3},{value:"Tailscale",id:"tailscale",level:3},{value:"SSH Reverse Tunnel",id:"ssh-reverse-tunnel",level:3},{value:"Advanced: Production Cutover",id:"advanced-production-cutover",level:2},{value:"Option 1: Deploy Container",id:"option-1-deploy-container",level:3},{value:"Option 2: Direct Service",id:"option-2-direct-service",level:3},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"development-workflow",children:"Development Workflow"})}),"\n",(0,o.jsx)(n.p,{children:"Guide to developing external services locally while testing against production n8n using the proxy pattern."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"The proxy pattern allows you to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Run services (like ocapistaine) on your local machine"}),"\n",(0,o.jsx)(n.li,{children:"Expose them via ngrok tunnel"}),"\n",(0,o.jsx)(n.li,{children:"Have production n8n call your local code"}),"\n",(0,o.jsx)(n.li,{children:"Make changes and see results immediately without deployment"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Production n8n (vaettir.locki.io)\n    \u2502\n    \u2502 Workflow calls: http://ocapistaine:8050\n    \u2193\nProxy Service (nginx container)\n    \u2502\n    \u2502 Routes to: $OCAPISTAINE_TARGET_URL\n    \u2193\nngrok Tunnel (https://abc123.ngrok-free.app)\n    \u2502\n    \u2193\nYour Local Machine (localhost:8050)\n    \u2502\n    \u2514\u2500\u2192 ocapistaine running locally\n"})}),"\n",(0,o.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,o.jsxs)(n.p,{children:["\u2705 ",(0,o.jsx)(n.strong,{children:"Live development"})," - Changes reflected immediately\n\u2705 ",(0,o.jsx)(n.strong,{children:"Real workflows"})," - Test with actual production n8n\n\u2705 ",(0,o.jsx)(n.strong,{children:"No deployment"})," - Skip build/push/deploy cycle\n\u2705 ",(0,o.jsx)(n.strong,{children:"Debug locally"})," - Full IDE debugging\n\u2705 ",(0,o.jsx)(n.strong,{children:"Multiple devs"})," - Each can tunnel their own instance\n\u2705 ",(0,o.jsx)(n.strong,{children:"Consistent URLs"})," - n8n workflows don't change"]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"ngrok account (free tier works)"}),"\n",(0,o.jsx)(n.li,{children:"Service running locally (e.g., ocapistaine)"}),"\n",(0,o.jsx)(n.li,{children:"SSH access to production server"}),"\n",(0,o.jsx)(n.li,{children:"Docker running locally"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"setup-guide",children:"Setup Guide"}),"\n",(0,o.jsx)(n.h3,{id:"step-1-install-ngrok",children:"Step 1: Install ngrok"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Option A: CLI (Recommended)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# macOS\nbrew install ngrok/ngrok/ngrok\n\n# Linux\ncurl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | \\\n  sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null && \\\n  echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | \\\n  sudo tee /etc/apt/sources.list.d/ngrok.list && \\\n  sudo apt update && sudo apt install ngrok\n\n# Windows\nchoco install ngrok\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Option B: Docker Desktop Extension"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Open Docker Desktop"}),"\n",(0,o.jsx)(n.li,{children:"Go to Extensions"}),"\n",(0,o.jsx)(n.li,{children:'Search for "ngrok"'}),"\n",(0,o.jsx)(n.li,{children:"Install ngrok extension"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"step-2-authenticate-ngrok",children:"Step 2: Authenticate ngrok"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Get your authtoken from https://dashboard.ngrok.com/get-started/your-authtoken\nngrok config add-authtoken YOUR_TOKEN\n"})}),"\n",(0,o.jsx)(n.h3,{id:"step-3-run-your-service-locally",children:"Step 3: Run Your Service Locally"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Example: ocapistaine"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Clone the repo\ncd ~/dev\ngit clone https://github.com/locki-io/ocapistaine\ncd ocapistaine\n\n# Run with Docker\ndocker compose up -d\n\n# Or run directly (if you prefer)\npython -m uvicorn main:app --reload --port 8000\n\n# Verify it's running\ncurl http://localhost:8050/health\n"})}),"\n",(0,o.jsx)(n.h3,{id:"step-4-create-ngrok-tunnel",children:"Step 4: Create ngrok Tunnel"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"With Custom Domain (Paid Plan - Recommended)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Start ngrok with custom domain\nngrok http 8050 --domain=ocapistaine.ngrok-free.app\n\n# Or configure in ngrok.yml for persistent setup\ncat > ~/.ngrok2/ngrok.yml << EOF\nversion: "2"\nauthtoken: YOUR_AUTH_TOKEN\ntunnels:\n  ocapistaine:\n    proto: http\n    addr: 8050\n    domain: ocapistaine.ngrok-free.app\nEOF\n\n# Then start with:\nngrok start ocapistaine\n'})}),"\n",(0,o.jsx)(n.p,{children:"You'll see output like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Session Status                online\nAccount                       Your Name (Plan: Pro)\nForwarding                    https://ocapistaine.ngrok-free.app -> http://localhost:8050\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Without Custom Domain (Free Plan)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Simple tunnel (URL changes every restart)\nngrok http 8050\n"})}),"\n",(0,o.jsx)(n.p,{children:"You'll see:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Session Status                online\nAccount                       Your Name (Plan: Free)\nForwarding                    https://abc123.ngrok-free.app -> http://localhost:8050\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Copy the ngrok URL"})," - you'll need it for production configuration."]}),"\n",(0,o.jsx)(n.h3,{id:"step-5-configure-production-server",children:"Step 5: Configure Production Server"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"With Custom Domain (Recommended)"})}),"\n",(0,o.jsx)(n.p,{children:"If using a custom ngrok domain, the configuration is already set correctly:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# In .env (already configured)\nOCAPISTAINE_TARGET_URL=https://ocapistaine.ngrok-free.app\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The proxy config (",(0,o.jsx)(n.code,{children:"proxy-configs/ocapistaine.conf.template"}),") is also pre-configured for this domain."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Without Custom Domain (Free Plan)"})}),"\n",(0,o.jsx)(n.p,{children:"If using a temporary ngrok URL, you need to update it every time ngrok restarts:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ssh <user>@<server>\ncd ~/vaettir\nnano .env\n"})}),"\n",(0,o.jsx)(n.p,{children:"Update:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Proxy target for ocapistaine (update with your current ngrok URL)\nOCAPISTAINE_TARGET_URL=https://abc123.ngrok-free.app\n"})}),"\n",(0,o.jsx)(n.p,{children:"And update the proxy config:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nano proxy-configs/ocapistaine.conf.template\n"})}),"\n",(0,o.jsx)(n.p,{children:"Update lines 20 and 23 with your ngrok domain:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"proxy_ssl_name abc123.ngrok-free.app;\n...\nproxy_set_header Host abc123.ngrok-free.app;\n"})}),"\n",(0,o.jsx)(n.p,{children:"Save and exit (Ctrl+X, Y, Enter)."}),"\n",(0,o.jsx)(n.h3,{id:"step-6-start-proxy-service",children:"Step 6: Start Proxy Service"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"First Time Setup"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# SSH to production\nssh <user>@<server>\ncd ~/vaettir\n\n# Build proxy image\ndocker compose build ocapistaine\n\n# Start proxy with both production and proxy profiles\ndocker compose --profile production --profile proxy up -d ocapistaine\n\n# Check status\ndocker compose ps ocapistaine\n\n# Check logs\ndocker compose logs -f ocapistaine\n"})}),"\n",(0,o.jsx)(n.p,{children:"Expected output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"ocapistaine-1  | nginx: configuration file /etc/nginx/nginx.conf test is successful\nocapistaine-1  | Starting nginx...\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Quick Update (from local machine)"})}),"\n",(0,o.jsx)(n.p,{children:"Use the helper script to update and restart the proxy:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Update proxy without rebuild (for code changes only)\n./scripts/update_proxy.sh\n\n# Update and rebuild (after config changes)\n./scripts/update_proxy.sh --build\n"})}),"\n",(0,o.jsx)(n.h3,{id:"step-7-test-the-connection",children:"Step 7: Test the Connection"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"From your server"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Test that proxy can reach your local machine\ndocker compose exec n8n curl -v http://ocapistaine:8000/health\n"})}),"\n",(0,o.jsx)(n.p,{children:"Should return response from your local service!"}),"\n",(0,o.jsx)(n.h3,{id:"step-8-update-n8n-workflows",children:"Step 8: Update n8n Workflows"}),"\n",(0,o.jsx)(n.p,{children:"In your n8n workflows, use:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"URL: http://ocapistaine:8000\n"})}),"\n",(0,o.jsx)(n.p,{children:"The proxy will route to your local machine via ngrok."}),"\n",(0,o.jsx)(n.h2,{id:"daily-development-workflow",children:"Daily Development Workflow"}),"\n",(0,o.jsx)(n.h3,{id:"morning-setup",children:"Morning Setup"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"With Custom Domain (Recommended)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# 1. Start local service (port 8050)\ncd ~/dev/ocapistaine\ndocker compose up -d\n\n# 2. Start ngrok tunnel with custom domain\nngrok start ocapistaine\n# Or: ngrok http 8050 --domain=ocapistaine.ngrok-free.app\n\n# 3. You're ready! No server updates needed.\n# Test: https://ocapistaine.vaettir.locki.io\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"With Free Plan (Temporary URL)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# 1. Start local service\ncd ~/dev/ocapistaine\ndocker compose up -d\n\n# 2. Start ngrok tunnel\nngrok http 8050\n# Copy the URL: https://xyz789.ngrok-free.app\n\n# 3. Update production server\nssh <user>@<server>\ncd ~/vaettir\nnano .env\n# Update: OCAPISTAINE_TARGET_URL=https://xyz789.ngrok-free.app\n\n# Also update proxy-configs/ocapistaine.conf.template (lines 20 & 23)\nnano proxy-configs/ocapistaine.conf.template\n\n# 4. Rebuild and restart proxy\ndocker compose build ocapistaine\ndocker compose --profile production --profile proxy up -d ocapistaine\n\n# 5. You're ready! Make changes locally and test via production n8n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"during-development",children:"During Development"}),"\n",(0,o.jsx)(n.p,{children:"Make changes to your local code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd ~/dev/ocapistaine\n# Edit files in your IDE\n"})}),"\n",(0,o.jsx)(n.p,{children:"Changes are immediately available:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"FastAPI auto-reloads (if using --reload)"}),"\n",(0,o.jsxs)(n.li,{children:["Or restart: ",(0,o.jsx)(n.code,{children:"docker compose restart"})]}),"\n",(0,o.jsx)(n.li,{children:"n8n workflows call through tunnel to your local code"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"managing-the-proxy",children:"Managing the Proxy"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"View Proxy Status"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# From local machine\nssh <user>@<server> 'cd ~/vaettir && docker compose ps ocapistaine'\n\n# Check logs\nssh <user>@<server> 'cd ~/vaettir && docker compose logs -f ocapistaine'\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Restart Proxy"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Quick restart (no code changes)\nssh <user>@<server> 'cd ~/vaettir && docker compose --profile production --profile proxy restart ocapistaine'\n\n# Or use the helper script from local machine\n./scripts/update_proxy.sh\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Update Proxy After Code Changes"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Commit and push your changes\ngit add .\ngit commit -m "Update proxy configuration"\ngit push\n\n# Update on production (from local machine)\n./scripts/update_proxy.sh --build\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Renew/Update ngrok URL"})}),"\n",(0,o.jsx)(n.p,{children:"With custom domain, no renewal needed! The URL stays constant."}),"\n",(0,o.jsx)(n.p,{children:"Without custom domain (free plan):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# 1. Update .env on production\nssh <user>@<server>\ncd ~/vaettir\nnano .env\n# Change: OCAPISTAINE_TARGET_URL=https://new-ngrok-url.ngrok-free.app\n\n# 2. Update proxy config\nnano proxy-configs/ocapistaine.conf.template\n# Update lines 20 and 23 with new domain\n\n# 3. Rebuild and restart\ndocker compose build ocapistaine\ndocker compose --profile production --profile proxy up -d ocapistaine\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Test Proxy Connection"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Test from internet\ncurl -I https://ocapistaine.vaettir.locki.io\n\n# Test from n8n container\nssh <user>@<server> 'docker exec vaettir-n8n-1 curl -I http://ocapistaine:80'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"evening-cleanup-optional",children:"Evening Cleanup (Optional)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Stop ngrok (Ctrl+C in terminal)\n\n# Stop local service\ncd ~/dev/ocapistaine\ndocker compose down\n\n# On server: stop proxy (optional, but usually leave it running)\nssh <user>@<server>\ncd ~/vaettir\ndocker compose stop ocapistaine\n"})}),"\n",(0,o.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,o.jsx)(n.h3,{id:"persistent-subdomain",children:"Persistent Subdomain"}),"\n",(0,o.jsx)(n.p,{children:"For a stable URL (requires ngrok Pro):"}),"\n",(0,o.jsxs)(n.p,{children:["Create ",(0,o.jsx)(n.code,{children:"~/ngrok.yml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"version: 2\nauthtoken: YOUR_TOKEN\ntunnels:\n  ocapistaine:\n    proto: http\n    addr: 8000\n    subdomain: ocapistaine-yourname\n"})}),"\n",(0,o.jsx)(n.p,{children:"Start:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ngrok start ocapistaine\n"})}),"\n",(0,o.jsxs)(n.p,{children:["URL stays same: ",(0,o.jsx)(n.code,{children:"https://ocapistaine-yourname.ngrok.io"})]}),"\n",(0,o.jsx)(n.h3,{id:"ip-whitelisting",children:"IP Whitelisting"}),"\n",(0,o.jsx)(n.p,{children:"Restrict tunnel to your server's IP:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Get server IP\nssh user@your-server curl -4 icanhazip.com\n\n# Start ngrok with IP restriction\nngrok http 8000 --cidr-allow="YOUR_SERVER_IP/32"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"traffic-inspection",children:"Traffic Inspection"}),"\n",(0,o.jsx)(n.p,{children:"View requests in ngrok dashboard:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# ngrok starts web interface on http://localhost:4040\n"})}),"\n",(0,o.jsx)(n.p,{children:"Open in browser to see:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"All HTTP requests/responses"}),"\n",(0,o.jsx)(n.li,{children:"Replay requests"}),"\n",(0,o.jsx)(n.li,{children:"Request details and timing"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"adding-more-services",children:"Adding More Services"}),"\n",(0,o.jsxs)(n.p,{children:["The proxy pattern works for any service. Example: add a new service called ",(0,o.jsx)(n.code,{children:"myapp"}),":"]}),"\n",(0,o.jsx)(n.h3,{id:"1-create-proxy-config-template",children:"1. Create Proxy Config Template"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd ~/vaettir\ncp proxy-configs/ocapistaine.conf.template proxy-configs/myapp.conf.template\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Edit ",(0,o.jsx)(n.code,{children:"proxy-configs/myapp.conf.template"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"events {\n    worker_connections 1024;\n}\n\nhttp {\n    server {\n        listen 9000;  # Different port\n\n        location / {\n            proxy_pass ${MYAPP_TARGET_URL};\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            proxy_read_timeout 300;\n            proxy_connect_timeout 300;\n            proxy_send_timeout 300;\n        }\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"2-add-service-to-docker-composeyml",children:"2. Add Service to docker-compose.yml"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'services:\n  # ... existing services ...\n\n  myapp:\n    build:\n      context: .\n      dockerfile: Dockerfile.proxy\n    restart: always\n    environment:\n      - MYAPP_TARGET_URL=${MYAPP_TARGET_URL:-http://host.docker.internal:9000}\n    profiles: ["proxy"]\n'})}),"\n",(0,o.jsx)(n.h3,{id:"3-update-dockerfileproxy-if-needed",children:"3. Update Dockerfile.proxy (if needed)"}),"\n",(0,o.jsx)(n.p,{children:"For multiple services, update the CMD to process all templates:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dockerfile",children:'FROM nginx:alpine\n\nRUN apk add --no-cache gettext\n\nCOPY proxy-configs/*.conf.template /etc/nginx/templates/\n\nCMD ["/bin/sh", "-c", "for template in /etc/nginx/templates/*.conf.template; do envsubst < $template > /etc/nginx/$(basename $template .template); done && nginx -g \'daemon off;\'"]\n'})}),"\n",(0,o.jsx)(n.h3,{id:"4-configure-and-start",children:"4. Configure and Start"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Add to .env\necho "MYAPP_TARGET_URL=https://def456.ngrok-free.app" >> .env\n\n# Start\ndocker compose --profile proxy up -d myapp\n'})}),"\n",(0,o.jsx)(n.h3,{id:"5-use-in-n8n",children:"5. Use in n8n"}),"\n",(0,o.jsx)(n.p,{children:"Workflows can now call:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"http://myapp:9000/endpoint\n"})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"ngrok-tunnel-not-reachable-from-server",children:"ngrok tunnel not reachable from server"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check ngrok status"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Local machine: is ngrok running?\n# Look for "Session Status: online"\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Test from server"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ssh user@your-server\ncurl -v https://abc123.ngrok-free.app\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Common issues"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"ngrok tunnel expired (free tier has limits)"}),"\n",(0,o.jsx)(n.li,{children:"Local service not running"}),"\n",(0,o.jsx)(n.li,{children:"Firewall blocking ngrok"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"proxy-returns-502-bad-gateway",children:"Proxy returns 502 Bad Gateway"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check proxy logs"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose logs ocapistaine\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Verify target URL"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# On server\ndocker compose exec ocapistaine env | grep OCAPISTAINE_TARGET_URL\n\n# Should show your ngrok URL\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Update if needed"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nano .env\n# Update OCAPISTAINE_TARGET_URL\ndocker compose --profile proxy restart ocapistaine\n"})}),"\n",(0,o.jsx)(n.h3,{id:"n8n-cant-resolve-service-name",children:"n8n can't resolve service name"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check if proxy is running"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose ps | grep ocapistaine\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Start proxy"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose --profile proxy up -d ocapistaine\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check Docker network"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker network inspect vaettir_default\n# Should show ocapistaine container\n"})}),"\n",(0,o.jsx)(n.h3,{id:"slow-response-times",children:"Slow response times"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"ngrok adds latency"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Expect ~50-200ms overhead"}),"\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"ngrok http 8050 --region=eu"})," for EU (closer to server)"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check ngrok dashboard"})," (",(0,o.jsx)(n.a,{href:"http://localhost:4040",children:"http://localhost:4040"}),"):"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"View request timing"}),"\n",(0,o.jsx)(n.li,{children:"See where time is spent"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"local-service-not-receiving-requests",children:"Local service not receiving requests"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check ngrok is forwarding"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# ngrok dashboard shows requests?\n# Local service logs show requests?\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Test local service directly"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8000/endpoint\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Check local firewall"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# ngrok needs to access localhost:8050\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use authentication"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'ngrok http 8000 --basic-auth="user:pass"\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Restrict IPs"})," (paid feature):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'ngrok http 8000 --cidr-allow="server-ip/32"\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Implement app-level auth"})," in your service"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Don't expose production data"})," on local dev instances"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"performance",children:"Performance"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Choose nearest region"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ngrok http 8000 --region=eu  # or us, ap, au, sa, in, jp\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Monitor ngrok dashboard"})," for bottlenecks"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use persistent tunnel"})," (paid) to avoid reconnections"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"workflow",children:"Workflow"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Document tunnel URL"})," in team chat when sharing"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Stop tunnel"})," when done to free ngrok resources"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Use separate workspace"})," in Opik for dev traces"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Test locally first"})," before tunneling to production"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"alternatives-to-ngrok",children:"Alternatives to ngrok"}),"\n",(0,o.jsx)(n.h3,{id:"cloudflare-tunnel",children:"Cloudflare Tunnel"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Install cloudflared\nbrew install cloudflare/cloudflare/cloudflared\n\n# Login\ncloudflared tunnel login\n\n# Create tunnel\ncloudflared tunnel create ocapistaine\n\n# Run\ncloudflared tunnel --url http://localhost:8050\n"})}),"\n",(0,o.jsx)(n.h3,{id:"tailscale",children:"Tailscale"}),"\n",(0,o.jsx)(n.p,{children:"For team-wide access without public exposure:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Install Tailscale on both local machine and server\n# Access via Tailscale IP directly (no ngrok needed)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"ssh-reverse-tunnel",children:"SSH Reverse Tunnel"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# On local machine\nssh -R 8000:localhost:8000 user@your-server\n\n# On server, update .env:\nOCAPISTAINE_TARGET_URL=http://localhost:8050\n"})}),"\n",(0,o.jsx)(n.h2,{id:"advanced-production-cutover",children:"Advanced: Production Cutover"}),"\n",(0,o.jsx)(n.p,{children:"When ready to deploy real service to production:"}),"\n",(0,o.jsx)(n.h3,{id:"option-1-deploy-container",children:"Option 1: Deploy Container"}),"\n",(0,o.jsxs)(n.p,{children:["Add to ",(0,o.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  ocapistaine-prod:\n    image: ghcr.io/locki-io/ocapistaine:latest\n    restart: always\n    environment:\n      # ... service config\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Update ",(0,o.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"OCAPISTAINE_TARGET_URL=http://ocapistaine-prod:8000\n"})}),"\n",(0,o.jsx)(n.p,{children:"Restart:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose --profile proxy restart ocapistaine\n# Or remove proxy and use direct service\ndocker compose up -d ocapistaine-prod\n"})}),"\n",(0,o.jsx)(n.h3,{id:"option-2-direct-service",children:"Option 2: Direct Service"}),"\n",(0,o.jsx)(n.p,{children:"Remove proxy entirely:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  ocapistaine:\n    image: ghcr.io/locki-io/ocapistaine:latest\n    # Direct service, no proxy needed\n"})}),"\n",(0,o.jsxs)(n.p,{children:["n8n workflows remain unchanged: ",(0,o.jsx)(n.code,{children:"http://ocapistaine:8000"})]}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(n.p,{children:"The proxy pattern provides:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Seamless local \u2192 production integration"}),"\n",(0,o.jsx)(n.li,{children:"Zero workflow changes"}),"\n",(0,o.jsx)(n.li,{children:"Flexible switching between dev/prod"}),"\n",(0,o.jsx)(n.li,{children:"Scalable to multiple services"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Perfect for rapid development cycles!"}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/fr/docs/orchestration/WORKFLOWS",children:"Workflow Best Practices"})," - Build better workflows"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/fr/docs/orchestration/TROUBLESHOOTING",children:"Troubleshooting Guide"})," - Common issues"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/fr/docs/orchestration/ARCHITECTURE",children:"Architecture Overview"})," - How it all fits together"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>t});var s=r(6540);const o={},i=s.createContext(o);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);