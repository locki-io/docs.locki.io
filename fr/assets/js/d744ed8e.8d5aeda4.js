"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[7522],{8453(e,n,s){s.d(n,{R:()=>o,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}},9630(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"usage/troubleshooting","title":"Troubleshooting","description":"Common issues and solutions for OCapistaine.","source":"@site/docs/usage/troubleshooting.md","sourceDirName":"usage","slug":"/usage/troubleshooting","permalink":"/fr/docs/usage/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/usage/troubleshooting.md","tags":[],"version":"current","frontMatter":{},"sidebar":"usageSidebar","previous":{"title":"Frequent asked questions","permalink":"/fr/docs/usage/faq"}}');var r=s(4848),l=s(8453);const o={},t="Troubleshooting",c={},d=[{value:"LLM Provider Issues",id:"llm-provider-issues",level:2},{value:"Rate Limit Causing Opik Feedback Score of 0",id:"rate-limit-causing-opik-feedback-score-of-0",level:3},{value:"1. Enable Provider Failover (Recommended)",id:"1-enable-provider-failover-recommended",level:4},{value:"2. Switch to a Different Primary Provider",id:"2-switch-to-a-different-primary-provider",level:4},{value:"3. Reduce Request Volume",id:"3-reduce-request-volume",level:4},{value:"4. Add Rate Limiting Buffer",id:"4-add-rate-limiting-buffer",level:4},{value:"5. Use Local Models (Ollama)",id:"5-use-local-models-ollama",level:4},{value:"Provider Authentication Errors",id:"provider-authentication-errors",level:3},{value:"Ollama Connection Failed",id:"ollama-connection-failed",level:3},{value:"Scheduler Issues",id:"scheduler-issues",level:2},{value:"Task Shows &quot;already_completed&quot; After Clearing Key",id:"task-shows-already_completed-after-clearing-key",level:3},{value:"Task Stuck with Lock",id:"task-stuck-with-lock",level:3},{value:"Redis Issues",id:"redis-issues",level:2},{value:"No Contributions Found",id:"no-contributions-found",level:3},{value:"Opik Tracing Issues",id:"opik-tracing-issues",level:2},{value:"Traces Not Appearing",id:"traces-not-appearing",level:3},{value:"Wrong Project in Opik",id:"wrong-project-in-opik",level:3},{value:"Getting Help",id:"getting-help",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"troubleshooting",children:"Troubleshooting"})}),"\n",(0,r.jsx)(n.p,{children:"Common issues and solutions for OCapistaine."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"llm-provider-issues",children:"LLM Provider Issues"}),"\n",(0,r.jsx)(n.h3,{id:"rate-limit-causing-opik-feedback-score-of-0",children:"Rate Limit Causing Opik Feedback Score of 0"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Opik traces show feedback score of 0 for spans like ",(0,r.jsx)(n.code,{children:"category_classification"}),', with reasoning field containing error messages like "Gemini retries exhausted".']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example log"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"2026-02-03 14:23:00 | ERROR | provider=gemini | type=RATE_LIMIT | model=gemini-2.5-flash | retry_after=59.692838347s | Retrying after 59.692838347s (attempt 1/3)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Root Cause"}),":\nWhen the LLM provider (e.g., Gemini) hits rate limits and exhausts all retries, the Forseti agent returns a fallback response with:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Correct category (based on heuristics)"}),"\n",(0,r.jsxs)(n.li,{children:["Error message in the ",(0,r.jsx)(n.code,{children:"reasoning"}),' field: "Classification error: Gemini retries exhausted"']}),"\n",(0,r.jsx)(n.li,{children:"Low or zero confidence"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Opik's evaluation system scores this output as 0 because:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The output lacks proper contextual reasoning"}),"\n",(0,r.jsx)(n.li,{children:"The error message in the reasoning field doesn't address the input"}),"\n",(0,r.jsx)(n.li,{children:"Even though the category may be correct, the lack of explanation fails quality criteria"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Impact"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Opik traces show low scores despite correct classifications"}),"\n",(0,r.jsx)(n.li,{children:"Training data quality is degraded"}),"\n",(0,r.jsx)(n.li,{children:"Prompt optimization becomes unreliable"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsx)(n.h4,{id:"1-enable-provider-failover-recommended",children:"1. Enable Provider Failover (Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"The scheduler dashboard now supports automatic failover to other providers when rate limits are hit."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Via Dashboard"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Go to Admin tab"}),"\n",(0,r.jsxs)(n.li,{children:["In Manual Triggers for ",(0,r.jsx)(n.code,{children:"task_contributions_analysis"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Select primary provider (e.g., "gemini")'}),"\n",(0,r.jsx)(n.li,{children:'Enable "Auto Failover" checkbox'}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Failover order: gemini \u2192 claude \u2192 mistral \u2192 ollama"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Via Code"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from app.services.scheduler import run_task_now\n\nresult = run_task_now(\n    'task_contributions_analysis',\n    provider='gemini',\n    enable_failover=True,  # Try other providers if rate limited\n    limit=10,\n)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"2-switch-to-a-different-primary-provider",children:"2. Switch to a Different Primary Provider"}),"\n",(0,r.jsx)(n.p,{children:"If Gemini consistently hits rate limits, use a different provider:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Environment variable"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# .env\nDEFAULT_PROVIDER=claude  # or mistral, ollama\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Per-task override"})," (via dashboard):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Select "claude" or "mistral" in the Provider dropdown'}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"3-reduce-request-volume",children:"3. Reduce Request Volume"}),"\n",(0,r.jsx)(n.p,{children:"Limit contributions processed per run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"result = run_task_now(\n    'task_contributions_analysis',\n    limit=10,  # Process fewer contributions per run\n)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"4-add-rate-limiting-buffer",children:"4. Add Rate Limiting Buffer"}),"\n",(0,r.jsxs)(n.p,{children:["Increase the rate limit delay in ",(0,r.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"GEMINI_RATE_LIMIT=2.0  # 2 seconds between requests (default: 1.0)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"5-use-local-models-ollama",children:"5. Use Local Models (Ollama)"}),"\n",(0,r.jsx)(n.p,{children:"For development/testing, use local Ollama to avoid rate limits entirely:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# .env\nDEFAULT_PROVIDER=ollama\nOLLAMA_MODEL=deepseek-r1:7b  # Default, good balance\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Available Ollama models"})," (sorted by resource usage):"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Model"}),(0,r.jsx)(n.th,{children:"RAM"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"qwen3:4b"})}),(0,r.jsx)(n.td,{children:"~3GB"}),(0,r.jsx)(n.td,{children:"Ultra-light, simple classification"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"qwen3-vl:4b"})}),(0,r.jsx)(n.td,{children:"~3GB"}),(0,r.jsx)(n.td,{children:"Multimodal, document analysis"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"deepseek-r1:7b"})}),(0,r.jsx)(n.td,{children:"~5GB"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Default"})," - Efficient reasoning, low CPU"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mistral:7b"})}),(0,r.jsx)(n.td,{children:"~6GB"}),(0,r.jsx)(n.td,{children:"Balanced quality/speed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"llama3:8b"})}),(0,r.jsx)(n.td,{children:"~8GB"}),(0,r.jsx)(n.td,{children:"Higher quality, more resources"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"deepseek-r1:14b"})}),(0,r.jsx)(n.td,{children:"~10GB"}),(0,r.jsx)(n.td,{children:"Best reasoning, high resources"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pull models before use"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ollama pull deepseek-r1:7b\nollama pull qwen3:4b\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Via Dashboard"}),': When selecting "ollama" as provider, a model dropdown appears with all available options.']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"How to identify affected traces in Opik"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Go to Opik dashboard"}),"\n",(0,r.jsx)(n.li,{children:'Filter traces by project "ocapistaine-test"'}),"\n",(0,r.jsxs)(n.li,{children:["Look for spans with:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Score = 0"}),"\n",(0,r.jsx)(n.li,{children:'Reasoning containing "retries exhausted" or "error"'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Check the parent trace's ",(0,r.jsx)(n.code,{children:"providers_tried"})," field to see failover attempts"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prevention"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitor rate limits"}),": Check provider dashboards for quota usage"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stagger scheduled tasks"}),": Don't run multiple LLM-heavy tasks simultaneously"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use batch processing"}),": Reduce total API calls with batch validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache results"}),": Store validation results in Redis to avoid re-processing"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"provider-authentication-errors",children:"Provider Authentication Errors"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),': Task fails with "Authentication failed" or "401/403" errors.']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Verify API keys in ",(0,r.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Google Gemini\nGOOGLE_API_KEY=your-key-here\n# or\nGEMINI_API_KEY=your-key-here\n\n# Anthropic Claude\nANTHROPIC_API_KEY=your-key-here\n\n# Mistral\nMISTRAL_API_KEY=your-key-here\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"ollama-connection-failed",children:"Ollama Connection Failed"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Tasks using Ollama fail with connection errors."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Is Ollama running?\ncurl http://localhost:11434/api/tags\n\n# Is the model pulled?\nollama list\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Start Ollama\nollama serve\n\n# Pull required model\nollama pull mistral:latest\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"scheduler-issues",children:"Scheduler Issues"}),"\n",(0,r.jsx)(n.h3,{id:"task-shows-already_completed-after-clearing-key",children:'Task Shows "already_completed" After Clearing Key'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),': After using "Clear & Run", task still reports "already_completed".']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": All contributions have ",(0,r.jsx)(n.code,{children:"confidence > 0"})," (already validated). The task completes successfully with nothing to process, then sets the success key again."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),': Use "Force Revalidate" button which:']}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Resets ",(0,r.jsx)(n.code,{children:"confidence = 0"})," on all records (last 7 days)"]}),"\n",(0,r.jsx)(n.li,{children:"Clears the success key"}),"\n",(0,r.jsx)(n.li,{children:"Runs the task"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"task-stuck-with-lock",children:"Task Stuck with Lock"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),': Task shows "skipped: lock_held" but nothing is running.']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Previous task crashed without releasing lock."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check for stale locks\nredis-cli -n 6 KEYS "lock:*"\n\n# Delete stale lock\nredis-cli -n 6 DEL "lock:task_contributions_analysis:20260203"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"redis-issues",children:"Redis Issues"}),"\n",(0,r.jsx)(n.h3,{id:"no-contributions-found",children:"No Contributions Found"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),': Task reports "no contributions to process" but you have mockup data.']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": The ",(0,r.jsx)(n.code,{children:"latest"})," hash in Redis expires after 24h."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check latest hash\nredis-cli -n 5 HLEN "contribution_mockup:forseti461:charter:latest"\n\n# Check date indexes\nredis-cli -n 5 KEYS "contribution_mockup:forseti461:charter:index:*"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": The task now falls back to checking date indexes for the last 7 days. If you still see issues, create new mockup contributions via the Mockup tab."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"opik-tracing-issues",children:"Opik Tracing Issues"}),"\n",(0,r.jsx)(n.h3,{id:"traces-not-appearing",children:"Traces Not Appearing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Verify Opik configuration:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat ~/.opik.config\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Check environment:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo $OPIK_API_KEY\necho $OPIK_PROJECT_NAME\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Test connection:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from opik import Opik\nclient = Opik()\nprint(client.config)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wrong-project-in-opik",children:"Wrong Project in Opik"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),': Traces appear in "Default Project" instead of expected project.']}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Set project name in code:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from app.agents.tracing import get_tracer\ntracer = get_tracer()  # Uses OPIK_PROJECT_NAME from env\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Or in ",(0,r.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"OPIK_PROJECT_NAME=ocapistaine-test\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"getting-help",children:"Getting Help"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check this guide first"}),"\n",(0,r.jsxs)(n.li,{children:["Review logs: ",(0,r.jsx)(n.code,{children:"docker compose logs"})," or check terminal output"]}),"\n",(0,r.jsx)(n.li,{children:"Check Opik dashboard for trace details"}),"\n",(0,r.jsxs)(n.li,{children:["Open an issue on GitHub with:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Error message (full)"}),"\n",(0,r.jsx)(n.li,{children:"Steps to reproduce"}),"\n",(0,r.jsx)(n.li,{children:"Environment details (provider, model, OS)"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);