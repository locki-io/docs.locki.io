"use strict";(globalThis.webpackChunkdocs_locki_io=globalThis.webpackChunkdocs_locki_io||[]).push([[9581],{6874(e,n,r){r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"orchestration/PORTS","title":"Port Management","description":"Complete reference for all ports used in the Vaettir system.","source":"@site/docs/orchestration/PORTS.md","sourceDirName":"orchestration","slug":"/orchestration/PORTS","permalink":"/fr/docs/orchestration/PORTS","draft":false,"unlisted":false,"editUrl":"https://github.com/locki-io/docs.locki.io/tree/main/docs/orchestration/PORTS.md","tags":[],"version":"current","frontMatter":{}}');var s=r(4848),l=r(8453);const o={},c="Port Management",t={},d=[{value:"Port Overview",id:"port-overview",level:2},{value:"Production Configuration",id:"production-configuration",level:2},{value:"External Access (via Traefik)",id:"external-access-via-traefik",level:3},{value:"Internal Docker Network",id:"internal-docker-network",level:3},{value:"Workflow HTTP Calls",id:"workflow-http-calls",level:3},{value:"Development Configuration",id:"development-configuration",level:2},{value:"Local Services",id:"local-services",level:3},{value:"Ngrok Tunnel",id:"ngrok-tunnel",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Port Conflicts",id:"port-conflicts",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Checking Port Usage",id:"checking-port-usage",level:2},{value:"On Production Server",id:"on-production-server",level:3},{value:"On Local Machine",id:"on-local-machine",level:3},{value:"Firewall Configuration",id:"firewall-configuration",level:2},{value:"Production Server (vaettir.locki.io)",id:"production-server-vaettirlockiio",level:3},{value:"Typical UFW Configuration",id:"typical-ufw-configuration",level:3},{value:"Adding New Services",id:"adding-new-services",level:2},{value:"Example: Adding a new service on port 8060",id:"example-adding-a-new-service-on-port-8060",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Service not accessible",id:"service-not-accessible",level:3},{value:"Port conflict",id:"port-conflict",level:3},{value:"References",id:"references",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"port-management",children:"Port Management"})}),"\n",(0,s.jsx)(n.p,{children:"Complete reference for all ports used in the Vaettir system."}),"\n",(0,s.jsx)(n.h2,{id:"port-overview",children:"Port Overview"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Service"}),(0,s.jsx)(n.th,{children:"Internal Port"}),(0,s.jsx)(n.th,{children:"External Port"}),(0,s.jsx)(n.th,{children:"Protocol"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Traefik (HTTP)"}),(0,s.jsx)(n.td,{children:"80"}),(0,s.jsx)(n.td,{children:"80"}),(0,s.jsx)(n.td,{children:"HTTP"}),(0,s.jsx)(n.td,{children:"Redirects to HTTPS"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Traefik (HTTPS)"}),(0,s.jsx)(n.td,{children:"443"}),(0,s.jsx)(n.td,{children:"443"}),(0,s.jsx)(n.td,{children:"HTTPS"}),(0,s.jsx)(n.td,{children:"Main entry point"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"n8n Web UI"}),(0,s.jsx)(n.td,{children:"5678"}),(0,s.jsx)(n.td,{children:"via Traefik"}),(0,s.jsx)(n.td,{children:"HTTP"}),(0,s.jsx)(n.td,{children:"Internal only"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"n8n Task Broker"}),(0,s.jsx)(n.td,{children:"5679"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"HTTP"}),(0,s.jsx)(n.td,{children:"Task runner communication"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"PostgreSQL"}),(0,s.jsx)(n.td,{children:"5432"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"TCP"}),(0,s.jsx)(n.td,{children:"Database (internal only)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Redis"}),(0,s.jsx)(n.td,{children:"6379"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"TCP"}),(0,s.jsx)(n.td,{children:"Queue (internal only)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ocapistaine proxy"}),(0,s.jsx)(n.td,{children:"80"}),(0,s.jsx)(n.td,{children:"via Traefik"}),(0,s.jsx)(n.td,{children:"HTTP"}),(0,s.jsx)(n.td,{children:"Nginx proxy to ngrok/local"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ocapistaine (local)"}),(0,s.jsx)(n.td,{children:"8050"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"HTTP"}),(0,s.jsx)(n.td,{children:"Your local dev machine"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"production-configuration",children:"Production Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"external-access-via-traefik",children:"External Access (via Traefik)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"https://vaettir.locki.io \u2192 Traefik:443 \u2192 n8n:5678\nhttps://ocapistaine.vaettir.locki.io \u2192 Traefik:443 \u2192 ocapistaine:80 \u2192 ngrok (ocapistaine.ngrok-free.app) \u2192 localhost:8050\n"})}),"\n",(0,s.jsx)(n.h3,{id:"internal-docker-network",children:"Internal Docker Network"}),"\n",(0,s.jsx)(n.p,{children:"Services communicate via Docker DNS:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"n8n \u2192 postgres:5432\nn8n \u2192 redis:6379\nn8n \u2192 n8n-task-runner:5679 (task broker)\nn8n \u2192 ocapistaine:80 (proxy service)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"workflow-http-calls",children:"Workflow HTTP Calls"}),"\n",(0,s.jsx)(n.p,{children:"From n8n workflows, always use internal service names:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"http://ocapistaine:80/api/v1/validate\n"})}),"\n",(0,s.jsx)(n.h2,{id:"development-configuration",children:"Development Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"local-services",children:"Local Services"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"localhost:5678 \u2192 n8n (via docker-compose.override.yml)\nlocalhost:8050 \u2192 ocapistaine (your local machine)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ngrok-tunnel",children:"Ngrok Tunnel"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"With Custom Domain (Paid Plan)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ngrok http 8050 --domain=ocapistaine.ngrok-free.app\n# Creates tunnel: https://ocapistaine.ngrok-free.app \u2192 localhost:8050\n# URL stays constant - no need to update configuration\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Without Custom Domain (Free Plan)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ngrok http 8050\n# Creates tunnel: https://abc123.ngrok-free.app \u2192 localhost:8050\n# URL changes on restart - must update production config\n"})}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Production .env (with custom ngrok domain)\nOCAPISTAINE_TARGET_URL=https://ocapistaine.ngrok-free.app\n\n# Production .env (with free plan - update when ngrok URL changes)\nOCAPISTAINE_TARGET_URL=https://abc123.ngrok-free.app\n"})}),"\n",(0,s.jsx)(n.h2,{id:"port-conflicts",children:"Port Conflicts"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Port 8000 vs 8050"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Port 8000 is commonly used by Django, Python HTTP servers"}),"\n",(0,s.jsxs)(n.li,{children:["ocapistaine uses ",(0,s.jsx)(n.strong,{children:"port 8050"})," to avoid conflicts"]}),"\n",(0,s.jsx)(n.li,{children:"Always use 8050 for ocapistaine local development"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Port 5678 (n8n)"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only exposed locally via docker-compose.override.yml"}),"\n",(0,s.jsx)(n.li,{children:"Never exposed in production (Traefik handles routing)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Port 80/443 (Traefik)"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only used in production profile"}),"\n",(0,s.jsx)(n.li,{children:"Requires root or Docker to bind to privileged ports"}),"\n",(0,s.jsx)(n.li,{children:"Handles SSL certificates automatically"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"checking-port-usage",children:"Checking Port Usage"}),"\n",(0,s.jsx)(n.h3,{id:"on-production-server",children:"On Production Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check which ports are listening\nssh <user>@<server> 'sudo netstat -tulpn | grep LISTEN'\n\n# Check specific service\nssh <user>@<server> 'docker compose ps'\n\n# Check Traefik routing\nssh <user>@<server> 'docker compose logs traefik | grep -i router'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"on-local-machine",children:"On Local Machine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check what's listening on port 8050\nlsof -i :8050\n\n# Check what's listening on port 5678\nlsof -i :5678\n\n# Check ngrok tunnels\ncurl http://localhost:4040/api/tunnels\n"})}),"\n",(0,s.jsx)(n.h2,{id:"firewall-configuration",children:"Firewall Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"production-server-vaettirlockiio",children:"Production Server (vaettir.locki.io)"}),"\n",(0,s.jsx)(n.p,{children:"Required open ports:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"22"}),": SSH access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"80"}),": HTTP (Traefik - redirects to HTTPS)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"443"}),": HTTPS (Traefik - main entry)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Blocked ports (internal only):"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"5432 (PostgreSQL)"}),"\n",(0,s.jsx)(n.li,{children:"6379 (Redis)"}),"\n",(0,s.jsx)(n.li,{children:"5678 (n8n)"}),"\n",(0,s.jsx)(n.li,{children:"5679 (n8n task broker)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-ufw-configuration",children:"Typical UFW Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo ufw allow 22/tcp   # SSH\nsudo ufw allow 80/tcp   # HTTP\nsudo ufw allow 443/tcp  # HTTPS\nsudo ufw enable\n"})}),"\n",(0,s.jsx)(n.h2,{id:"adding-new-services",children:"Adding New Services"}),"\n",(0,s.jsx)(n.p,{children:"When adding a new proxy service:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Choose internal port"})," (avoid conflicts)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Update docker-compose.yml"})," with Traefik labels"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Add subdomain"})," to DNS (e.g., service.vaettir.locki.io)"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Document in this file"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example-adding-a-new-service-on-port-8060",children:"Example: Adding a new service on port 8060"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'myservice:\n  build:\n    context: .\n    dockerfile: Dockerfile.proxy-myservice\n  restart: always\n  environment:\n    - MYSERVICE_TARGET_URL=${MYSERVICE_TARGET_URL:-http://host.docker.internal:8060}\n  profiles: ["proxy"]\n  labels:\n    - "traefik.enable=true"\n    - "traefik.http.routers.myservice.rule=Host(`myservice.vaettir.locki.io`)"\n    - "traefik.http.routers.myservice.entrypoints=websecure"\n    - "traefik.http.routers.myservice.tls=true"\n    - "traefik.http.routers.myservice.tls.certresolver=myresolver"\n    - "traefik.http.services.myservice.loadbalancer.server.port=80"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"service-not-accessible",children:"Service not accessible"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Check container is running"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose ps myservice\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Check Traefik labels"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker inspect myservice | grep -A 10 Labels\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Check Traefik logs"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose logs traefik | grep myservice\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Check DNS"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nslookup myservice.vaettir.locki.io\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Check firewall"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo ufw status\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"port-conflict",children:"Port conflict"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Find what's using the port"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"lsof -i :8050\n# or\nsudo netstat -tulpn | grep 8050\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Stop the conflicting service"})," or ",(0,s.jsx)(n.strong,{children:"choose a different port"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Update configuration"})," in .env and restart"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://doc.traefik.io/traefik/",children:"Traefik Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.docker.com/network/",children:"Docker Networking"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.n8n.io/hosting/installation/docker/",children:"n8n Docker Setup"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/fr/docs/orchestration/ARCHITECTURE",children:"ARCHITECTURE.md"})," - System architecture"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/fr/docs/orchestration/DEVELOPMENT",children:"DEVELOPMENT.md"})," - Development workflow with ngrok"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>c});var i=r(6540);const s={},l=i.createContext(s);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);